var Xc=Object.defineProperty;var Yc=(n,e,t)=>e in n?Xc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ze=(n,e,t)=>Yc(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Zc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Pn={exports:{}},os;function el(){if(os)return Pn.exports;os=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(w,C,I){return Function.prototype.apply.call(w,C,I)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(w){return Object.getOwnPropertyNames(w).concat(Object.getOwnPropertySymbols(w))}:t=function(w){return Object.getOwnPropertyNames(w)};function r(T){console&&console.warn&&console.warn(T)}var i=Number.isNaN||function(w){return w!==w};function s(){s.init.call(this)}Pn.exports=s,Pn.exports.once=N,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function c(T){if(typeof T!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof T)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(T){if(typeof T!="number"||T<0||i(T))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+T+".");a=T}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(w){if(typeof w!="number"||w<0||i(w))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+w+".");return this._maxListeners=w,this};function l(T){return T._maxListeners===void 0?s.defaultMaxListeners:T._maxListeners}s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(w){for(var C=[],I=1;I<arguments.length;I++)C.push(arguments[I]);var x=w==="error",V=this._events;if(V!==void 0)x=x&&V.error===void 0;else if(!x)return!1;if(x){var F;if(C.length>0&&(F=C[0]),F instanceof Error)throw F;var se=new Error("Unhandled error."+(F?" ("+F.message+")":""));throw se.context=F,se}var xe=V[w];if(xe===void 0)return!1;if(typeof xe=="function")e(xe,this,C);else for(var qe=xe.length,gt=y(xe,qe),I=0;I<qe;++I)e(gt[I],this,C);return!0};function u(T,w,C,I){var x,V,F;if(c(C),V=T._events,V===void 0?(V=T._events=Object.create(null),T._eventsCount=0):(V.newListener!==void 0&&(T.emit("newListener",w,C.listener?C.listener:C),V=T._events),F=V[w]),F===void 0)F=V[w]=C,++T._eventsCount;else if(typeof F=="function"?F=V[w]=I?[C,F]:[F,C]:I?F.unshift(C):F.push(C),x=l(T),x>0&&F.length>x&&!F.warned){F.warned=!0;var se=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(w)+" listeners added. Use emitter.setMaxListeners() to increase limit");se.name="MaxListenersExceededWarning",se.emitter=T,se.type=w,se.count=F.length,r(se)}return T}s.prototype.addListener=function(w,C){return u(this,w,C,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(w,C){return u(this,w,C,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(T,w,C){var I={fired:!1,wrapFn:void 0,target:T,type:w,listener:C},x=h.bind(I);return x.listener=C,I.wrapFn=x,x}s.prototype.once=function(w,C){return c(C),this.on(w,m(this,w,C)),this},s.prototype.prependOnceListener=function(w,C){return c(C),this.prependListener(w,m(this,w,C)),this},s.prototype.removeListener=function(w,C){var I,x,V,F,se;if(c(C),x=this._events,x===void 0)return this;if(I=x[w],I===void 0)return this;if(I===C||I.listener===C)--this._eventsCount===0?this._events=Object.create(null):(delete x[w],x.removeListener&&this.emit("removeListener",w,I.listener||C));else if(typeof I!="function"){for(V=-1,F=I.length-1;F>=0;F--)if(I[F]===C||I[F].listener===C){se=I[F].listener,V=F;break}if(V<0)return this;V===0?I.shift():k(I,V),I.length===1&&(x[w]=I[0]),x.removeListener!==void 0&&this.emit("removeListener",w,se||C)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(w){var C,I,x;if(I=this._events,I===void 0)return this;if(I.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):I[w]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete I[w]),this;if(arguments.length===0){var V=Object.keys(I),F;for(x=0;x<V.length;++x)F=V[x],F!=="removeListener"&&this.removeAllListeners(F);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(C=I[w],typeof C=="function")this.removeListener(w,C);else if(C!==void 0)for(x=C.length-1;x>=0;x--)this.removeListener(w,C[x]);return this};function v(T,w,C){var I=T._events;if(I===void 0)return[];var x=I[w];return x===void 0?[]:typeof x=="function"?C?[x.listener||x]:[x]:C?P(x):y(x,x.length)}s.prototype.listeners=function(w){return v(this,w,!0)},s.prototype.rawListeners=function(w){return v(this,w,!1)},s.listenerCount=function(T,w){return typeof T.listenerCount=="function"?T.listenerCount(w):_.call(T,w)},s.prototype.listenerCount=_;function _(T){var w=this._events;if(w!==void 0){var C=w[T];if(typeof C=="function")return 1;if(C!==void 0)return C.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function y(T,w){for(var C=new Array(w),I=0;I<w;++I)C[I]=T[I];return C}function k(T,w){for(;w+1<T.length;w++)T[w]=T[w+1];T.pop()}function P(T){for(var w=new Array(T.length),C=0;C<w.length;++C)w[C]=T[C].listener||T[C];return w}function N(T,w){return new Promise(function(C,I){function x(F){T.removeListener(w,V),I(F)}function V(){typeof T.removeListener=="function"&&T.removeListener("error",x),C([].slice.call(arguments))}D(T,w,V,{once:!0}),w!=="error"&&B(T,x,{once:!0})})}function B(T,w,C){typeof T.on=="function"&&D(T,"error",w,C)}function D(T,w,C,I){if(typeof T.on=="function")I.once?T.once(w,C):T.on(w,C);else if(typeof T.addEventListener=="function")T.addEventListener(w,function x(V){I.once&&T.removeEventListener(w,x),C(V)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof T)}return Pn.exports}var Co=el();const tl=Zc(Co);var he=[];for(var Pr=0;Pr<256;++Pr)he.push((Pr+256).toString(16).slice(1));function nl(n,e=0){return(he[n[e+0]]+he[n[e+1]]+he[n[e+2]]+he[n[e+3]]+"-"+he[n[e+4]]+he[n[e+5]]+"-"+he[n[e+6]]+he[n[e+7]]+"-"+he[n[e+8]]+he[n[e+9]]+"-"+he[n[e+10]]+he[n[e+11]]+he[n[e+12]]+he[n[e+13]]+he[n[e+14]]+he[n[e+15]]).toLowerCase()}var In,rl=new Uint8Array(16);function il(){if(!In&&(In=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!In))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return In(rl)}var sl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const cs={randomUUID:sl};function al(n,e,t){if(cs.randomUUID&&!e&&!n)return cs.randomUUID();n=n||{};var r=n.random||(n.rng||il)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return nl(r)}const ol={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Oo={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},ae={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},ge={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ot={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class E{static getFirstMatch(e,t){const r=t.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,t){const r=t.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,t,r){if(e.test(t))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),t[0]===10)switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),!(t[0]===1&&t[1]<5)){if(t[0]===1&&t[1]<6)return"Cupcake";if(t[0]===1&&t[1]>=6)return"Donut";if(t[0]===2&&t[1]<2)return"Eclair";if(t[0]===2&&t[1]===2)return"Froyo";if(t[0]===2&&t[1]>2)return"Gingerbread";if(t[0]===3)return"Honeycomb";if(t[0]===4&&t[1]<1)return"Ice Cream Sandwich";if(t[0]===4&&t[1]<4)return"Jelly Bean";if(t[0]===4&&t[1]>=4)return"KitKat";if(t[0]===5)return"Lollipop";if(t[0]===6)return"Marshmallow";if(t[0]===7)return"Nougat";if(t[0]===8)return"Oreo";if(t[0]===9)return"Pie"}}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,t,r=!1){const i=E.getVersionPrecision(e),s=E.getVersionPrecision(t);let a=Math.max(i,s),c=0;const l=E.map([e,t],u=>{const h=a-E.getVersionPrecision(u),m=u+new Array(h+1).join(".0");return E.map(m.split("."),v=>new Array(20-v.length).join("0")+v).reverse()});for(r&&(c=a-Math.min(i,s)),a-=1;a>=c;){if(l[0][a]>l[1][a])return 1;if(l[0][a]===l[1][a]){if(a===c)return 0;a-=1}else if(l[0][a]<l[1][a])return-1}}static map(e,t){const r=[];let i;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i+=1)r.push(t(e[i]));return r}static find(e,t){let r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){const s=e[r];if(t(s,r))return s}}static assign(e,...t){const r=e;let i,s;if(Object.assign)return Object.assign(e,...t);for(i=0,s=t.length;i<s;i+=1){const a=t[i];typeof a=="object"&&a!==null&&Object.keys(a).forEach(l=>{r[l]=a[l]})}return e}static getBrowserAlias(e){return ol[e]}static getBrowserTypeByAlias(e){return Oo[e]||""}}const ee=/version\/(\d+(\.?_?\d+)+)/i,cl=[{test:[/googlebot/i],describe(n){const e={name:"Googlebot"},t=E.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/opera/i],describe(n){const e={name:"Opera"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe(n){const e={name:"Opera"},t=E.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe(n){const e={name:"Samsung Internet for Android"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/Whale/i],describe(n){const e={name:"NAVER Whale Browser"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe(n){const e={name:"MZ Browser"},t=E.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/focus/i],describe(n){const e={name:"Focus"},t=E.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/swing/i],describe(n){const e={name:"Swing"},t=E.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/coast/i],describe(n){const e={name:"Opera Coast"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const e={name:"Opera Touch"},t=E.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe(n){const e={name:"Yandex Browser"},t=E.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe(n){const e={name:"UC Browser"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe(n){const e={name:"Maxthon"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/epiphany/i],describe(n){const e={name:"Epiphany"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/puffin/i],describe(n){const e={name:"Puffin"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe(n){const e={name:"Sleipnir"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe(n){const e={name:"K-Meleon"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe(n){const e={name:"WeChat"},t=E.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe(n){const e={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},t=E.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe(n){const e={name:"Internet Explorer"},t=E.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe(n){const e={name:"Microsoft Edge"},t=E.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe(n){const e={name:"Microsoft Edge"},t=E.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe(n){const e={name:"Vivaldi"},t=E.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe(n){const e={name:"SeaMonkey"},t=E.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/sailfish/i],describe(n){const e={name:"Sailfish"},t=E.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return t&&(e.version=t),e}},{test:[/silk/i],describe(n){const e={name:"Amazon Silk"},t=E.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/phantom/i],describe(n){const e={name:"PhantomJS"},t=E.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe(n){const e={name:"SlimerJS"},t=E.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e={name:"BlackBerry"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe(n){const e={name:"WebOS Browser"},t=E.getFirstMatch(ee,n)||E.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/bada/i],describe(n){const e={name:"Bada"},t=E.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/tizen/i],describe(n){const e={name:"Tizen"},t=E.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe(n){const e={name:"QupZilla"},t=E.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe(n){const e={name:"Firefox"},t=E.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/electron/i],describe(n){const e={name:"Electron"},t=E.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/MiuiBrowser/i],describe(n){const e={name:"Miui"},t=E.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/chromium/i],describe(n){const e={name:"Chromium"},t=E.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe(n){const e={name:"Chrome"},t=E.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/GSA/i],describe(n){const e={name:"Google Search"},t=E.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){const e=!n.test(/like android/i),t=n.test(/android/i);return e&&t},describe(n){const e={name:"Android Browser"},t=E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe(n){const e={name:"PlayStation 4"},t=E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe(n){const e={name:"Safari"},t=E.getFirstMatch(ee,n);return t&&(e.version=t),e}},{test:[/.*/i],describe(n){const e=/^(.*)\/(.*) /,t=/^(.*)\/(.*)[ \t]\((.*)/,i=n.search("\\(")!==-1?t:e;return{name:E.getFirstMatch(i,n),version:E.getSecondMatch(i,n)}}}],ll=[{test:[/Roku\/DVP/],describe(n){const e=E.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return{name:ge.Roku,version:e}}},{test:[/windows phone/i],describe(n){const e=E.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return{name:ge.WindowsPhone,version:e}}},{test:[/windows /i],describe(n){const e=E.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),t=E.getWindowsVersionName(e);return{name:ge.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const e={name:ge.iOS},t=E.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return t&&(e.version=t),e}},{test:[/macintosh/i],describe(n){const e=E.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),t=E.getMacOSVersionName(e),r={name:ge.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe(n){const e=E.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return{name:ge.iOS,version:e}}},{test(n){const e=!n.test(/like android/i),t=n.test(/android/i);return e&&t},describe(n){const e=E.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),t=E.getAndroidVersionName(e),r={name:ge.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe(n){const e=E.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),t={name:ge.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e=E.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||E.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||E.getFirstMatch(/\bbb(\d+)/i,n);return{name:ge.BlackBerry,version:e}}},{test:[/bada/i],describe(n){const e=E.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return{name:ge.Bada,version:e}}},{test:[/tizen/i],describe(n){const e=E.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return{name:ge.Tizen,version:e}}},{test:[/linux/i],describe(){return{name:ge.Linux}}},{test:[/CrOS/],describe(){return{name:ge.ChromeOS}}},{test:[/PlayStation 4/],describe(n){const e=E.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return{name:ge.PlayStation4,version:e}}}],ul=[{test:[/googlebot/i],describe(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe(n){const e=E.getFirstMatch(/(can-l01)/i,n)&&"Nova",t={type:ae.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe(){return{type:ae.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe(){return{type:ae.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(){return{type:ae.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe(){return{type:ae.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe(){return{type:ae.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe(){return{type:ae.tablet}}},{test(n){const e=n.test(/ipod|iphone/i),t=n.test(/like (ipod|iphone)/i);return e&&!t},describe(n){const e=E.getFirstMatch(/(ipod|iphone)/i,n);return{type:ae.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe(){return{type:ae.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe(){return{type:ae.mobile}}},{test(n){return n.getBrowserName(!0)==="blackberry"},describe(){return{type:ae.mobile,vendor:"BlackBerry"}}},{test(n){return n.getBrowserName(!0)==="bada"},describe(){return{type:ae.mobile}}},{test(n){return n.getBrowserName()==="windows phone"},describe(){return{type:ae.mobile,vendor:"Microsoft"}}},{test(n){const e=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(!0)==="android"&&e>=3},describe(){return{type:ae.tablet}}},{test(n){return n.getOSName(!0)==="android"},describe(){return{type:ae.mobile}}},{test(n){return n.getOSName(!0)==="macos"},describe(){return{type:ae.desktop,vendor:"Apple"}}},{test(n){return n.getOSName(!0)==="windows"},describe(){return{type:ae.desktop}}},{test(n){return n.getOSName(!0)==="linux"},describe(){return{type:ae.desktop}}},{test(n){return n.getOSName(!0)==="playstation 4"},describe(){return{type:ae.tv}}},{test(n){return n.getOSName(!0)==="roku"},describe(){return{type:ae.tv}}}],dl=[{test(n){return n.getBrowserName(!0)==="microsoft edge"},describe(n){if(/\sedg\//i.test(n))return{name:ot.Blink};const t=E.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return{name:ot.EdgeHTML,version:t}}},{test:[/trident/i],describe(n){const e={name:ot.Trident},t=E.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){return n.test(/presto/i)},describe(n){const e={name:ot.Presto},t=E.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){const e=n.test(/gecko/i),t=n.test(/like gecko/i);return e&&!t},describe(n){const e={name:ot.Gecko},t=E.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe(){return{name:ot.Blink}}},{test:[/(apple)?webkit/i],describe(n){const e={name:ot.WebKit},t=E.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}}];class ls{constructor(e,t=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},t!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=E.find(cl,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=E.find(ll,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:t}=this.getOS();return e?String(t).toLowerCase()||"":t||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:t}=this.getPlatform();return e?String(t).toLowerCase()||"":t||""}parsePlatform(){this.parsedResult.platform={};const e=E.find(ul,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=E.find(dl,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return E.assign({},this.parsedResult)}satisfies(e){const t={};let r=0;const i={};let s=0;if(Object.keys(e).forEach(c=>{const l=e[c];typeof l=="string"?(i[c]=l,s+=1):typeof l=="object"&&(t[c]=l,r+=1)}),r>0){const c=Object.keys(t),l=E.find(c,h=>this.isOS(h));if(l){const h=this.satisfies(t[l]);if(h!==void 0)return h}const u=E.find(c,h=>this.isPlatform(h));if(u){const h=this.satisfies(t[u]);if(h!==void 0)return h}}if(s>0){const c=Object.keys(i),l=E.find(c,u=>this.isBrowser(u,!0));if(l!==void 0)return this.compareVersion(i[l])}}isBrowser(e,t=!1){const r=this.getBrowserName().toLowerCase();let i=e.toLowerCase();const s=E.getBrowserTypeByAlias(i);return t&&s&&(i=s.toLowerCase()),i===r}compareVersion(e){let t=[0],r=e,i=!1;const s=this.getBrowserVersion();if(typeof s=="string")return e[0]===">"||e[0]==="<"?(r=e.substr(1),e[1]==="="?(i=!0,r=e.substr(2)):t=[],e[0]===">"?t.push(1):t.push(-1)):e[0]==="="?r=e.substr(1):e[0]==="~"&&(i=!0,r=e.substr(1)),t.indexOf(E.compareVersions(s,r,i))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,t=!1){return this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(t=>this.is(t))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class fl{static getParser(e,t=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new ls(e,t)}static parse(e){return new ls(e).getResult()}static get BROWSER_MAP(){return Oo}static get ENGINE_MAP(){return ot}static get OS_MAP(){return ge}static get PLATFORMS_MAP(){return ae}}function mt(n,e){return Object.keys(e).forEach(function(t){t==="default"||t==="__esModule"||Object.prototype.hasOwnProperty.call(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:function(){return e[t]}})}),n}function hl(n){return n&&n.__esModule?n.default:n}function de(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}var gr={},Ao={};de(Ao,"PipecatClient",()=>nn);var Kt={};Kt=JSON.parse('{"name":"@pipecat-ai/client-js","version":"1.0.0","license":"BSD-2-Clause","main":"dist/index.js","module":"dist/index.module.js","types":"dist/index.d.ts","source":"index.ts","repository":{"type":"git","url":"git+https://github.com/pipecat-ai/pipecat-client-web.git"},"files":["dist","package.json","README.md"],"scripts":{"build":"jest --silent --passWithNoTests && parcel build --no-cache","dev":"parcel watch","lint":"eslint . --report-unused-disable-directives --max-warnings 0","test":"jest"},"jest":{"preset":"ts-jest","testEnvironment":"jsdom"},"devDependencies":{"@jest/globals":"^29.7.0","@types/clone-deep":"^4.0.4","@types/jest":"^29.5.12","@types/uuid":"^10.0.0","eslint":"^9.11.1","eslint-config-prettier":"^9.1.0","eslint-plugin-simple-import-sort":"^12.1.1","jest":"^29.7.0","jest-environment-jsdom":"^30.0.2","ts-jest":"^29.2.5"},"dependencies":{"@types/events":"^3.0.3","bowser":"^2.11.0","clone-deep":"^4.0.1","events":"^3.3.0","typed-emitter":"^2.1.0","uuid":"^10.0.0"}}');var vr={},pl={},jt={};de(jt,"RTVIError",()=>$e);de(jt,"ConnectionTimeoutError",()=>ml);de(jt,"StartBotError",()=>ti);de(jt,"TransportStartError",()=>ni);de(jt,"BotNotReadyError",()=>Po);de(jt,"UnsupportedFeatureError",()=>Qn);class $e extends Error{constructor(e,t){super(e),this.status=t}}class ml extends $e{constructor(e){super(e??"Bot did not enter ready state within the specified timeout period.")}}class ti extends $e{constructor(e,t){super(e??"Failed to connect / invalid auth bundle from base url",t??500),this.error="invalid-request-error"}}class ni extends $e{constructor(e){super(e??"Unable to connect to transport")}}class Po extends $e{constructor(e){super(e??"Attempt to call action on transport when not in 'ready' state.")}}class Qn extends $e{constructor(e,t,r){let i=`${e} not supported${r?`: ${r}`:""}`;t&&(i=`${t} does not support ${e}${r?`: ${r}`:""}`),super(i),this.feature=e}}var Io={};de(Io,"RTVIEvent",()=>U);var U;(function(n){n.Connected="connected",n.Disconnected="disconnected",n.TransportStateChanged="transportStateChanged",n.BotConnected="botConnected",n.BotReady="botReady",n.BotDisconnected="botDisconnected",n.Error="error",n.ServerMessage="serverMessage",n.ServerResponse="serverResponse",n.MessageError="messageError",n.Metrics="metrics",n.BotStartedSpeaking="botStartedSpeaking",n.BotStoppedSpeaking="botStoppedSpeaking",n.UserStartedSpeaking="userStartedSpeaking",n.UserStoppedSpeaking="userStoppedSpeaking",n.UserTranscript="userTranscript",n.BotTranscript="botTranscript",n.BotLlmText="botLlmText",n.BotLlmStarted="botLlmStarted",n.BotLlmStopped="botLlmStopped",n.LLMFunctionCall="llmFunctionCall",n.BotLlmSearchResponse="botLlmSearchResponse",n.BotTtsText="botTtsText",n.BotTtsStarted="botTtsStarted",n.BotTtsStopped="botTtsStopped",n.ParticipantConnected="participantConnected",n.ParticipantLeft="participantLeft",n.TrackStarted="trackStarted",n.TrackStopped="trackStopped",n.ScreenTrackStarted="screenTrackStarted",n.ScreenTrackStopped="screenTrackStopped",n.ScreenShareError="screenShareError",n.LocalAudioLevel="localAudioLevel",n.RemoteAudioLevel="remoteAudioLevel",n.AvailableCamsUpdated="availableCamsUpdated",n.AvailableMicsUpdated="availableMicsUpdated",n.AvailableSpeakersUpdated="availableSpeakersUpdated",n.CamUpdated="camUpdated",n.MicUpdated="micUpdated",n.SpeakerUpdated="speakerUpdated"})(U||(U={}));var tn={};de(tn,"RTVI_PROTOCOL_VERSION",()=>No);de(tn,"RTVI_MESSAGE_LABEL",()=>xo);de(tn,"RTVIMessageType",()=>z);de(tn,"setAboutClient",()=>Lo);de(tn,"RTVIMessage",()=>Ue);const No="1.0.0",xo="rtvi-ai";var z;(function(n){n.CLIENT_READY="client-ready",n.DISCONNECT_BOT="disconnect-bot",n.CLIENT_MESSAGE="client-message",n.APPEND_TO_CONTEXT="append-to-context",n.BOT_READY="bot-ready",n.ERROR="error",n.METRICS="metrics",n.SERVER_MESSAGE="server-message",n.SERVER_RESPONSE="server-response",n.ERROR_RESPONSE="error-response",n.APPEND_TO_CONTEXT_RESULT="append-to-context-result",n.USER_TRANSCRIPTION="user-transcription",n.BOT_TRANSCRIPTION="bot-transcription",n.USER_STARTED_SPEAKING="user-started-speaking",n.USER_STOPPED_SPEAKING="user-stopped-speaking",n.BOT_STARTED_SPEAKING="bot-started-speaking",n.BOT_STOPPED_SPEAKING="bot-stopped-speaking",n.USER_LLM_TEXT="user-llm-text",n.BOT_LLM_TEXT="bot-llm-text",n.BOT_LLM_STARTED="bot-llm-started",n.BOT_LLM_STOPPED="bot-llm-stopped",n.LLM_FUNCTION_CALL="llm-function-call",n.LLM_FUNCTION_CALL_RESULT="llm-function-call-result",n.BOT_LLM_SEARCH_RESPONSE="bot-llm-search-response",n.BOT_TTS_TEXT="bot-tts-text",n.BOT_TTS_STARTED="bot-tts-started",n.BOT_TTS_STOPPED="bot-tts-stopped"})(z||(z={}));let vn;function Lo(n){vn?vn={...vn,...n}:vn=n}class Ue{constructor(e,t,r){this.label=xo,this.type=e,this.data=t,this.id=r||al().slice(0,8)}static clientReady(){return new Ue(z.CLIENT_READY,{version:No,about:vn||{library:Kt.name,library_version:Kt.version}})}static disconnectBot(){return new Ue(z.DISCONNECT_BOT,{})}static error(e,t=!1){return new Ue(z.ERROR,{message:e,fatal:t})}}mt(vr,pl);mt(vr,jt);mt(vr,Io);mt(vr,tn);function yr(n,e,t){const r=t.value;return t.value=function(...i){if(this.state==="ready")return r.apply(this,i);throw new Po(`Attempt to call ${e.toString()} when transport not in ready state. Await connect() first.`)},t}var Ro={};de(Ro,"MessageDispatcher",()=>Do);var Ni={};de(Ni,"LogLevel",()=>ut);de(Ni,"logger",()=>Q);var ut;(function(n){n[n.NONE=0]="NONE",n[n.ERROR=1]="ERROR",n[n.WARN=2]="WARN",n[n.INFO=3]="INFO",n[n.DEBUG=4]="DEBUG"})(ut||(ut={}));class Vt{constructor(){this.level=ut.DEBUG}static getInstance(){return Vt.instance||(Vt.instance=new Vt),Vt.instance}setLevel(e){this.level=e}debug(...e){this.level>=ut.DEBUG&&console.debug(...e)}info(...e){this.level>=ut.INFO&&console.info(...e)}warn(...e){this.level>=ut.WARN&&console.warn(...e)}error(...e){this.level>=ut.ERROR&&console.error(...e)}}const Q=Vt.getInstance();class Do{constructor(e){this._queue=new Array,this._gcInterval=void 0,this._queue=[],this._sendMethod=e}disconnect(){this.clearQueue(),clearInterval(this._gcInterval),this._gcInterval=void 0}dispatch(e,t=z.CLIENT_MESSAGE,r=1e4){this._gcInterval||(this._gcInterval=setInterval(()=>{this._gc()},2e3));const i=new Ue(t,e),s=new Promise((a,c)=>{this._queue.push({message:i,timestamp:Date.now(),timeout:r,resolve:a,reject:c})});Q.debug("[MessageDispatcher] dispatch",i);try{this._sendMethod(i)}catch(a){return Q.error("[MessageDispatcher] Error sending message",a),Promise.reject(a)}return this._gc(),s}clearQueue(){this._queue=[]}_resolveReject(e,t=!0){const r=this._queue.find(i=>i.message.id===e.id);return r&&(t?(Q.debug("[MessageDispatcher] Resolve",e),r.resolve(e)):(Q.debug("[MessageDispatcher] Reject",e),r.reject(e)),this._queue=this._queue.filter(i=>i.message.id!==e.id),Q.debug("[MessageDispatcher] Queue",this._queue)),e}resolve(e){return this._resolveReject(e,!0)}reject(e){return this._resolveReject(e,!1)}_gc(){const e=[];this._queue=this._queue.filter(t=>{const r=Date.now()-t.timestamp<t.timeout;return r||e.push(t),r}),e.forEach(t=>{t.message.type===z.CLIENT_MESSAGE&&t.reject(new Ue(z.ERROR_RESPONSE,{error:"Timed out waiting for response",msgType:t.message.data.t,data:t.message.data.d,fatal:!1}))}),Q.debug("[MessageDispatcher] GC",this._queue)}}function gl(n){return typeof n=="object"&&n!==null&&Object.keys(n).includes("endpoint")?typeof n.endpoint=="string":!1}async function vl(n,e){e||(e=new AbortController);let t;return new Promise((r,i)=>{(async()=>(n.timeout&&(t=setTimeout(async()=>{e.abort(),i(new Error("Timed out"))},n.timeout)),Q.debug(`[Pipecat Client] Fetching connection params from ${n.endpoint}`),fetch(n.endpoint,{method:"POST",mode:"cors",headers:new Headers({"Content-Type":"application/json",...Object.fromEntries((n.headers??new Headers).entries())}),body:JSON.stringify(n.requestData),signal:e==null?void 0:e.signal}).then(s=>{if(Q.debug(`[Pipecat Client] Received response from ${n.endpoint}`,s),!s.ok)throw s;s.json().then(a=>r(a))}).catch(s=>{Q.error(`[Pipecat Client] Error fetching connection params: ${s}`),s instanceof Response?s.json().then(a=>{i(new ti(a.info??a.detail??s.statusText,s.status))}):i(new ti)}).finally(()=>{t&&clearTimeout(t)})))()})}var xi={};de(xi,"Transport",()=>Bo);de(xi,"TransportWrapper",()=>jo);class Bo{constructor(){this._state="disconnected"}connect(e){this._abortController=new AbortController;let t=e;try{t=this._validateConnectionParams(e)}catch(r){throw new $e(`Invalid connection params: ${r.message}. Please check your connection params and try again.`)}return this._connect(t)}disconnect(){return this._abortController&&this._abortController.abort(),this._disconnect()}}class jo{constructor(e){this._transport=e,this._proxy=new Proxy(this._transport,{get:(t,r,i)=>{if(typeof t[r]=="function"){let s;switch(String(r)){case"initialize":s="Direct calls to initialize() are disabled and used internally by the PipecatClient.";break;case"initDevices":s="Direct calls to initDevices() are disabled. Please use the PipecatClient.initDevices() wrapper or let PipecatClient.connect() call it for you.";break;case"sendReadyMessage":s="Direct calls to sendReadyMessage() are disabled and used internally by the PipecatClient.";break;case"connect":s="Direct calls to connect() are disabled. Please use the PipecatClient.connect() wrapper.";break;case"disconnect":s="Direct calls to disconnect() are disabled. Please use the PipecatClient.disconnect() wrapper.";break}return s?()=>{throw new Error(s)}:(...a)=>t[r](...a)}return Reflect.get(t,r,i)}})}get proxy(){return this._proxy}}function yl(){var t,r,i,s,a,c;let n={library:Kt.name,library_version:Kt.version,platform_details:{}},e=null;if((t=window==null?void 0:window.navigator)!=null&&t.userAgent)try{e=fl.parse(window.navigator.userAgent)}catch{}return(r=e==null?void 0:e.browser)!=null&&r.name&&(n.platform_details.browser=e.browser.name),((i=e==null?void 0:e.browser)==null?void 0:i.name)==="Safari"&&!e.browser.version?n.platform_details.browser_version="Web View":(s=e==null?void 0:e.browser)!=null&&s.version&&(n.platform_details.browser_version=e.browser.version),(a=e==null?void 0:e.platform)!=null&&a.type&&(n.platform_details.platform_type=e.platform.type),(c=e==null?void 0:e.engine)!=null&&c.name&&(n.platform_details.engine=e.engine.name),e!=null&&e.os&&(n.platform=e.os.name,n.platform_version=e.os.version),n}var br=function(n,e,t,r){var i=arguments.length,s=i<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,e,t,r);else for(var c=n.length-1;c>=0;c--)(a=n[c])&&(s=(i<3?a(s):i>3?a(e,t,s):a(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s};class bl extends tl{}class nn extends bl{constructor(e){super(),this._functionCallCallbacks={},Lo(yl()),this._transport=e.transport,this._transportWrapper=new jo(this._transport);const t={...e.callbacks,onMessageError:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onMessageError)==null||s.call(i,r),this.emit(U.MessageError,r)},onError:r=>{var s,a;(a=(s=e==null?void 0:e.callbacks)==null?void 0:s.onError)==null||a.call(s,r);try{this.emit(U.Error,r)}catch{Q.debug("Could not emit error",r)}const i=r.data;i!=null&&i.fatal&&(Q.error("Fatal error reported. Disconnecting..."),this.disconnect())},onConnected:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onConnected)==null||i.call(r),this.emit(U.Connected)},onDisconnected:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onDisconnected)==null||i.call(r),this.emit(U.Disconnected)},onTransportStateChanged:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onTransportStateChanged)==null||s.call(i,r),this.emit(U.TransportStateChanged,r)},onParticipantJoined:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onParticipantJoined)==null||s.call(i,r),this.emit(U.ParticipantConnected,r)},onParticipantLeft:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onParticipantLeft)==null||s.call(i,r),this.emit(U.ParticipantLeft,r)},onTrackStarted:(r,i)=>{var s,a;(a=(s=e==null?void 0:e.callbacks)==null?void 0:s.onTrackStarted)==null||a.call(s,r,i),this.emit(U.TrackStarted,r,i)},onTrackStopped:(r,i)=>{var s,a;(a=(s=e==null?void 0:e.callbacks)==null?void 0:s.onTrackStopped)==null||a.call(s,r,i),this.emit(U.TrackStopped,r,i)},onScreenTrackStarted:(r,i)=>{var s,a;(a=(s=e==null?void 0:e.callbacks)==null?void 0:s.onScreenTrackStarted)==null||a.call(s,r,i),this.emit(U.ScreenTrackStarted,r,i)},onScreenTrackStopped:(r,i)=>{var s,a;(a=(s=e==null?void 0:e.callbacks)==null?void 0:s.onScreenTrackStopped)==null||a.call(s,r,i),this.emit(U.ScreenTrackStopped,r,i)},onScreenShareError:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onScreenShareError)==null||s.call(i,r),this.emit(U.ScreenShareError,r)},onAvailableCamsUpdated:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableCamsUpdated)==null||s.call(i,r),this.emit(U.AvailableCamsUpdated,r)},onAvailableMicsUpdated:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableMicsUpdated)==null||s.call(i,r),this.emit(U.AvailableMicsUpdated,r)},onAvailableSpeakersUpdated:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onAvailableSpeakersUpdated)==null||s.call(i,r),this.emit(U.AvailableSpeakersUpdated,r)},onCamUpdated:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onCamUpdated)==null||s.call(i,r),this.emit(U.CamUpdated,r)},onMicUpdated:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onMicUpdated)==null||s.call(i,r),this.emit(U.MicUpdated,r)},onSpeakerUpdated:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onSpeakerUpdated)==null||s.call(i,r),this.emit(U.SpeakerUpdated,r)},onBotConnected:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotConnected)==null||s.call(i,r),this.emit(U.BotConnected,r)},onBotReady:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotReady)==null||s.call(i,r),this.emit(U.BotReady,r)},onBotDisconnected:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotDisconnected)==null||s.call(i,r),this.emit(U.BotDisconnected,r)},onBotStartedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotStartedSpeaking)==null||i.call(r),this.emit(U.BotStartedSpeaking)},onBotStoppedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotStoppedSpeaking)==null||i.call(r),this.emit(U.BotStoppedSpeaking)},onRemoteAudioLevel:(r,i)=>{var s,a;(a=(s=e==null?void 0:e.callbacks)==null?void 0:s.onRemoteAudioLevel)==null||a.call(s,r,i),this.emit(U.RemoteAudioLevel,r,i)},onUserStartedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onUserStartedSpeaking)==null||i.call(r),this.emit(U.UserStartedSpeaking)},onUserStoppedSpeaking:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onUserStoppedSpeaking)==null||i.call(r),this.emit(U.UserStoppedSpeaking)},onLocalAudioLevel:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onLocalAudioLevel)==null||s.call(i,r),this.emit(U.LocalAudioLevel,r)},onUserTranscript:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onUserTranscript)==null||s.call(i,r),this.emit(U.UserTranscript,r)},onBotTranscript:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotTranscript)==null||s.call(i,r),this.emit(U.BotTranscript,r)},onBotLlmText:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotLlmText)==null||s.call(i,r),this.emit(U.BotLlmText,r)},onBotLlmStarted:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotLlmStarted)==null||i.call(r),this.emit(U.BotLlmStarted)},onBotLlmStopped:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotLlmStopped)==null||i.call(r),this.emit(U.BotLlmStopped)},onBotTtsText:r=>{var i,s;(s=(i=e==null?void 0:e.callbacks)==null?void 0:i.onBotTtsText)==null||s.call(i,r),this.emit(U.BotTtsText,r)},onBotTtsStarted:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotTtsStarted)==null||i.call(r),this.emit(U.BotTtsStarted)},onBotTtsStopped:()=>{var r,i;(i=(r=e==null?void 0:e.callbacks)==null?void 0:r.onBotTtsStopped)==null||i.call(r),this.emit(U.BotTtsStopped)}};this._options={...e,callbacks:t,enableMic:e.enableMic??!0,enableCam:e.enableCam??!1,enableScreenShare:e.enableScreenShare??!1},this._initialize(),Q.debug("[Pipecat Client] Initialized",this.version)}setLogLevel(e){Q.setLevel(e)}async initDevices(){Q.debug("[Pipecat Client] Initializing devices..."),await this._transport.initDevices()}async connect(e){if(["authenticating","connecting","connected","ready"].includes(this._transport.state))throw new $e("Voice client has already been started. Please call disconnect() before starting again.");return new Promise((t,r)=>{(async()=>{var i;this._startResolve=t,this._transport.state==="disconnected"&&await this._transport.initDevices();try{let s;if(e)if(gl(e)){if(this._transport.state="authenticating",this._abortController=new AbortController,s=await vl(e,this._abortController),(i=this._abortController)!=null&&i.signal.aborted)return;this._transport.state="authenticated"}else s=e;await this._transport.connect(s),await this._transport.sendReadyMessage()}catch(s){this.disconnect(),r(s);return}})()})}async disconnect(){await this._transport.disconnect(),this._messageDispatcher.disconnect()}_initialize(){this._transport.initialize(this._options,this.handleMessage.bind(this)),this._messageDispatcher=new Do(this._transport.sendMessage.bind(this._transport))}get connected(){return["connected","ready"].includes(this._transport.state)}get transport(){return this._transportWrapper.proxy}get state(){return this._transport.state}get version(){return hl(Kt).version}async getAllMics(){return await this._transport.getAllMics()}async getAllCams(){return await this._transport.getAllCams()}async getAllSpeakers(){return await this._transport.getAllSpeakers()}get selectedMic(){return this._transport.selectedMic}get selectedCam(){return this._transport.selectedCam}get selectedSpeaker(){return this._transport.selectedSpeaker}updateMic(e){this._transport.updateMic(e)}updateCam(e){this._transport.updateCam(e)}updateSpeaker(e){this._transport.updateSpeaker(e)}enableMic(e){this._transport.enableMic(e)}get isMicEnabled(){return this._transport.isMicEnabled}enableCam(e){this._transport.enableCam(e)}get isCamEnabled(){return this._transport.isCamEnabled}tracks(){return this._transport.tracks()}enableScreenShare(e){return this._transport.enableScreenShare(e)}get isSharingScreen(){return this._transport.isSharingScreen}sendClientMessage(e,t){this._transport.sendMessage(new Ue(z.CLIENT_MESSAGE,{t:e,d:t}))}async sendClientRequest(e,t,r){const i={t:e,d:t};return(await this._messageDispatcher.dispatch(i,z.CLIENT_MESSAGE,r)).data.d}registerFunctionCallHandler(e,t){this._functionCallCallbacks[e]=t}async appendToContext(e){return!!(await this._messageDispatcher.dispatch({role:e.role,content:e.content,run_immediately:e.run_immediately},z.APPEND_TO_CONTEXT)).data.result}disconnectBot(){this._transport.sendMessage(new Ue(z.DISCONNECT_BOT,{}))}handleMessage(e){var t,r,i,s,a,c,l,u,h,m,v,_,y,k,P,N,B,D,T,w,C,I,x,V,F,se,xe,qe,gt,vt,an,yt,on,bt,cn,_t,ln;switch(Q.debug("[RTVI Message]",e),e.type){case z.BOT_READY:{const o=e.data,f=o.version?o.version.split(".").map(Number):[0,0,0];Q.debug(`[Pipecat Client] Bot is ready. Version: ${o.version}`),f[0]<1&&Q.warn("[Pipecat Client] Bot version is less than 1.0.0, which may not be compatible with this client."),(t=this._startResolve)==null||t.call(this,e.data),(i=(r=this._options.callbacks)==null?void 0:r.onBotReady)==null||i.call(r,e.data);break}case z.ERROR:(a=(s=this._options.callbacks)==null?void 0:s.onError)==null||a.call(s,e);break;case z.SERVER_RESPONSE:this._messageDispatcher.resolve(e);break;case z.ERROR_RESPONSE:{const o=this._messageDispatcher.reject(e);(l=(c=this._options.callbacks)==null?void 0:c.onMessageError)==null||l.call(c,o);break}case z.USER_STARTED_SPEAKING:(h=(u=this._options.callbacks)==null?void 0:u.onUserStartedSpeaking)==null||h.call(u);break;case z.USER_STOPPED_SPEAKING:(v=(m=this._options.callbacks)==null?void 0:m.onUserStoppedSpeaking)==null||v.call(m);break;case z.BOT_STARTED_SPEAKING:(y=(_=this._options.callbacks)==null?void 0:_.onBotStartedSpeaking)==null||y.call(_);break;case z.BOT_STOPPED_SPEAKING:(P=(k=this._options.callbacks)==null?void 0:k.onBotStoppedSpeaking)==null||P.call(k);break;case z.USER_TRANSCRIPTION:{const o=e.data;(B=(N=this._options.callbacks)==null?void 0:N.onUserTranscript)==null||B.call(N,o);break}case z.BOT_TRANSCRIPTION:(T=(D=this._options.callbacks)==null?void 0:D.onBotTranscript)==null||T.call(D,e.data);break;case z.BOT_LLM_TEXT:(C=(w=this._options.callbacks)==null?void 0:w.onBotLlmText)==null||C.call(w,e.data);break;case z.BOT_LLM_STARTED:(x=(I=this._options.callbacks)==null?void 0:I.onBotLlmStarted)==null||x.call(I);break;case z.BOT_LLM_STOPPED:(F=(V=this._options.callbacks)==null?void 0:V.onBotLlmStopped)==null||F.call(V);break;case z.BOT_TTS_TEXT:(xe=(se=this._options.callbacks)==null?void 0:se.onBotTtsText)==null||xe.call(se,e.data);break;case z.BOT_TTS_STARTED:(gt=(qe=this._options.callbacks)==null?void 0:qe.onBotTtsStarted)==null||gt.call(qe);break;case z.BOT_TTS_STOPPED:(an=(vt=this._options.callbacks)==null?void 0:vt.onBotTtsStopped)==null||an.call(vt);break;case z.METRICS:(on=(yt=this._options.callbacks)==null?void 0:yt.onMetrics)==null||on.call(yt,e.data),this.emit(U.Metrics,e.data);break;case z.APPEND_TO_CONTEXT_RESULT:case z.SERVER_MESSAGE:(cn=(bt=this._options.callbacks)==null?void 0:bt.onServerMessage)==null||cn.call(bt,e.data),this.emit(U.ServerMessage,e.data);break;case z.LLM_FUNCTION_CALL:{const o=e.data,f=this._functionCallCallbacks[o.function_name];if(f){const d={functionName:o.function_name,arguments:o.args};f(d).then(p=>{this._transport.sendMessage(new Ue(z.LLM_FUNCTION_CALL_RESULT,{function_name:o.function_name,tool_call_id:o.tool_call_id,arguments:o.args,result:p}))})}break}case z.BOT_LLM_SEARCH_RESPONSE:{const o=e.data;(ln=(_t=this._options.callbacks)==null?void 0:_t.onBotLlmSearchResponse)==null||ln.call(_t,o),this.emit(U.BotLlmSearchResponse,o);break}default:Q.debug("[Pipecat Client] Unrecognized message type",e.type);break}}}br([yr],nn.prototype,"sendClientMessage",null);br([yr],nn.prototype,"sendClientRequest",null);br([yr],nn.prototype,"appendToContext",null);br([yr],nn.prototype,"disconnectBot",null);mt(gr,Ao);mt(gr,Ro);mt(gr,Ni);mt(gr,xi);function us(n,e){if(n==null)return{};var t,r,i=function(a,c){if(a==null)return{};var l={};for(var u in a)if({}.hasOwnProperty.call(a,u)){if(c.indexOf(u)!==-1)continue;l[u]=a[u]}return l}(n,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(r=0;r<s.length;r++)t=s[r],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}function Te(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function H(n){return H=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(n)}function Fo(n){var e=function(t,r){if(H(t)!="object"||!t)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var s=i.call(t,r);if(H(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n,"string");return H(e)=="symbol"?e:e+""}function ds(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,Fo(r.key),r)}}function Ce(n,e,t){return e&&ds(n.prototype,e),t&&ds(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function _r(n,e){if(e&&(H(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n)}function We(n){return We=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},We(n)}function Sn(n,e){return Sn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Sn(n,e)}function wr(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Sn(n,e)}function Qe(n,e,t){return(e=Fo(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function fs(n,e,t,r,i,s,a){try{var c=n[s](a),l=c.value}catch(u){return void t(u)}c.done?e(l):Promise.resolve(l).then(r,i)}function j(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function a(l){fs(s,r,i,a,c,"next",l)}function c(l){fs(s,r,i,a,c,"throw",l)}a(void 0)})}}function hs(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function we(n,e){return function(t){if(Array.isArray(t))return t}(n)||function(t,r){var i=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i!=null){var s,a,c,l,u=[],h=!0,m=!1;try{if(c=(i=i.call(t)).next,r===0){if(Object(i)!==i)return;h=!1}else for(;!(h=(s=c.call(i)).done)&&(u.push(s.value),u.length!==r);h=!0);}catch(v){m=!0,a=v}finally{try{if(!h&&i.return!=null&&(l=i.return(),Object(l)!==l))return}finally{if(m)throw a}}return u}}(n,e)||function(t,r){if(t){if(typeof t=="string")return hs(t,r);var i={}.toString.call(t).slice(8,-1);return i==="Object"&&t.constructor&&(i=t.constructor.name),i==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?hs(t,r):void 0}}(n,e)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function _l(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var $o,ri={exports:{}},Jt=typeof Reflect=="object"?Reflect:null,ps=Jt&&typeof Jt.apply=="function"?Jt.apply:function(n,e,t){return Function.prototype.apply.call(n,e,t)};$o=Jt&&typeof Jt.ownKeys=="function"?Jt.ownKeys:Object.getOwnPropertySymbols?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:function(n){return Object.getOwnPropertyNames(n)};var ms=Number.isNaN||function(n){return n!=n};function Z(){Z.init.call(this)}ri.exports=Z,ri.exports.once=function(n,e){return new Promise(function(t,r){function i(a){n.removeListener(e,s),r(a)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",i),t([].slice.call(arguments))}ws(n,e,s,{once:!0}),e!=="error"&&function(a,c,l){typeof a.on=="function"&&ws(a,"error",c,l)}(n,i,{once:!0})})},Z.EventEmitter=Z,Z.prototype._events=void 0,Z.prototype._eventsCount=0,Z.prototype._maxListeners=void 0;var gs=10;function Hn(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}function Uo(n){return n._maxListeners===void 0?Z.defaultMaxListeners:n._maxListeners}function vs(n,e,t,r){var i,s,a,c;if(Hn(t),(s=n._events)===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),a=s[e]),a===void 0)a=s[e]=t,++n._eventsCount;else if(typeof a=="function"?a=s[e]=r?[t,a]:[a,t]:r?a.unshift(t):a.push(t),(i=Uo(n))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=n,l.type=e,l.count=a.length,c=l,console&&console.warn&&console.warn(c)}return n}function wl(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ys(n,e,t){var r={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},i=wl.bind(r);return i.listener=t,r.wrapFn=i,i}function bs(n,e,t){var r=n._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?function(s){for(var a=new Array(s.length),c=0;c<a.length;++c)a[c]=s[c].listener||s[c];return a}(i):Vo(i,i.length)}function _s(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}function Vo(n,e){for(var t=new Array(e),r=0;r<e;++r)t[r]=n[r];return t}function ws(n,e,t,r){if(typeof n.on=="function")r.once?n.once(e,t):n.on(e,t);else{if(typeof n.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n);n.addEventListener(e,function i(s){r.once&&n.removeEventListener(e,i),t(s)})}}Object.defineProperty(Z,"defaultMaxListeners",{enumerable:!0,get:function(){return gs},set:function(n){if(typeof n!="number"||n<0||ms(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");gs=n}}),Z.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Z.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||ms(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this},Z.prototype.getMaxListeners=function(){return Uo(this)},Z.prototype.emit=function(n){for(var e=[],t=1;t<arguments.length;t++)e.push(arguments[t]);var r=n==="error",i=this._events;if(i!==void 0)r=r&&i.error===void 0;else if(!r)return!1;if(r){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[n];if(c===void 0)return!1;if(typeof c=="function")ps(c,this,e);else{var l=c.length,u=Vo(c,l);for(t=0;t<l;++t)ps(u[t],this,e)}return!0},Z.prototype.addListener=function(n,e){return vs(this,n,e,!1)},Z.prototype.on=Z.prototype.addListener,Z.prototype.prependListener=function(n,e){return vs(this,n,e,!0)},Z.prototype.once=function(n,e){return Hn(e),this.on(n,ys(this,n,e)),this},Z.prototype.prependOnceListener=function(n,e){return Hn(e),this.prependListener(n,ys(this,n,e)),this},Z.prototype.removeListener=function(n,e){var t,r,i,s,a;if(Hn(e),(r=this._events)===void 0)return this;if((t=r[n])===void 0)return this;if(t===e||t.listener===e)--this._eventsCount==0?this._events=Object.create(null):(delete r[n],r.removeListener&&this.emit("removeListener",n,t.listener||e));else if(typeof t!="function"){for(i=-1,s=t.length-1;s>=0;s--)if(t[s]===e||t[s].listener===e){a=t[s].listener,i=s;break}if(i<0)return this;i===0?t.shift():function(c,l){for(;l+1<c.length;l++)c[l]=c[l+1];c.pop()}(t,i),t.length===1&&(r[n]=t[0]),r.removeListener!==void 0&&this.emit("removeListener",n,a||e)}return this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.removeAllListeners=function(n){var e,t,r;if((t=this._events)===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[n]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete t[n]),this;if(arguments.length===0){var i,s=Object.keys(t);for(r=0;r<s.length;++r)(i=s[r])!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(e=t[n])=="function")this.removeListener(n,e);else if(e!==void 0)for(r=e.length-1;r>=0;r--)this.removeListener(n,e[r]);return this},Z.prototype.listeners=function(n){return bs(this,n,!0)},Z.prototype.rawListeners=function(n){return bs(this,n,!1)},Z.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):_s.call(n,e)},Z.prototype.listenerCount=_s,Z.prototype.eventNames=function(){return this._eventsCount>0?$o(this._events):[]};var ii=ri.exports,Nn=_l(ii),ks=Object.prototype.hasOwnProperty;function Ss(n,e,t){for(t of n.keys())if(be(t,e))return t}function be(n,e){var t,r,i;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((r=n.length)===e.length)for(;r--&&be(n[r],e[r]););return r===-1}if(t===Set){if(n.size!==e.size)return!1;for(r of n)if((i=r)&&typeof i=="object"&&!(i=Ss(e,i))||!e.has(i))return!1;return!0}if(t===Map){if(n.size!==e.size)return!1;for(r of n)if((i=r[0])&&typeof i=="object"&&!(i=Ss(e,i))||!be(r[1],e.get(i)))return!1;return!0}if(t===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(t===DataView){if((r=n.byteLength)===e.byteLength)for(;r--&&n.getInt8(r)===e.getInt8(r););return r===-1}if(ArrayBuffer.isView(n)){if((r=n.byteLength)===e.byteLength)for(;r--&&n[r]===e[r];);return r===-1}if(!t||typeof n=="object"){for(t in r=0,n)if(ks.call(n,t)&&++r&&!ks.call(e,t)||!(t in e)||!be(n[t],e[t]))return!1;return Object.keys(e).length===r}}return n!=n&&e!=e}const kl={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Wo={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},oe={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},ve={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ct={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class M{static getFirstMatch(e,t){const r=t.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,t){const r=t.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,t,r){if(e.test(t))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),t[0]===10)switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const t=e.split(".").splice(0,2).map(r=>parseInt(r,10)||0);if(t.push(0),!(t[0]===1&&t[1]<5))return t[0]===1&&t[1]<6?"Cupcake":t[0]===1&&t[1]>=6?"Donut":t[0]===2&&t[1]<2?"Eclair":t[0]===2&&t[1]===2?"Froyo":t[0]===2&&t[1]>2?"Gingerbread":t[0]===3?"Honeycomb":t[0]===4&&t[1]<1?"Ice Cream Sandwich":t[0]===4&&t[1]<4?"Jelly Bean":t[0]===4&&t[1]>=4?"KitKat":t[0]===5?"Lollipop":t[0]===6?"Marshmallow":t[0]===7?"Nougat":t[0]===8?"Oreo":t[0]===9?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,t,r=!1){const i=M.getVersionPrecision(e),s=M.getVersionPrecision(t);let a=Math.max(i,s),c=0;const l=M.map([e,t],u=>{const h=a-M.getVersionPrecision(u),m=u+new Array(h+1).join(".0");return M.map(m.split("."),v=>new Array(20-v.length).join("0")+v).reverse()});for(r&&(c=a-Math.min(i,s)),a-=1;a>=c;){if(l[0][a]>l[1][a])return 1;if(l[0][a]===l[1][a]){if(a===c)return 0;a-=1}else if(l[0][a]<l[1][a])return-1}}static map(e,t){const r=[];let i;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(i=0;i<e.length;i+=1)r.push(t(e[i]));return r}static find(e,t){let r,i;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,i=e.length;r<i;r+=1){const s=e[r];if(t(s,r))return s}}static assign(e,...t){const r=e;let i,s;if(Object.assign)return Object.assign(e,...t);for(i=0,s=t.length;i<s;i+=1){const a=t[i];typeof a=="object"&&a!==null&&Object.keys(a).forEach(c=>{r[c]=a[c]})}return e}static getBrowserAlias(e){return kl[e]}static getBrowserTypeByAlias(e){return Wo[e]||""}}const te=/version\/(\d+(\.?_?\d+)+)/i,Sl=[{test:[/googlebot/i],describe(n){const e={name:"Googlebot"},t=M.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/opera/i],describe(n){const e={name:"Opera"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/opr\/|opios/i],describe(n){const e={name:"Opera"},t=M.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/SamsungBrowser/i],describe(n){const e={name:"Samsung Internet for Android"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/Whale/i],describe(n){const e={name:"NAVER Whale Browser"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/MZBrowser/i],describe(n){const e={name:"MZ Browser"},t=M.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/focus/i],describe(n){const e={name:"Focus"},t=M.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/swing/i],describe(n){const e={name:"Swing"},t=M.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/coast/i],describe(n){const e={name:"Opera Coast"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const e={name:"Opera Touch"},t=M.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/yabrowser/i],describe(n){const e={name:"Yandex Browser"},t=M.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/ucbrowser/i],describe(n){const e={name:"UC Browser"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/Maxthon|mxios/i],describe(n){const e={name:"Maxthon"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/epiphany/i],describe(n){const e={name:"Epiphany"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/puffin/i],describe(n){const e={name:"Puffin"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/sleipnir/i],describe(n){const e={name:"Sleipnir"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/k-meleon/i],describe(n){const e={name:"K-Meleon"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/micromessenger/i],describe(n){const e={name:"WeChat"},t=M.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/qqbrowser/i],describe(n){const e={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},t=M.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/msie|trident/i],describe(n){const e={name:"Internet Explorer"},t=M.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/\sedg\//i],describe(n){const e={name:"Microsoft Edge"},t=M.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/edg([ea]|ios)/i],describe(n){const e={name:"Microsoft Edge"},t=M.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/vivaldi/i],describe(n){const e={name:"Vivaldi"},t=M.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/seamonkey/i],describe(n){const e={name:"SeaMonkey"},t=M.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/sailfish/i],describe(n){const e={name:"Sailfish"},t=M.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return t&&(e.version=t),e}},{test:[/silk/i],describe(n){const e={name:"Amazon Silk"},t=M.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/phantom/i],describe(n){const e={name:"PhantomJS"},t=M.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/slimerjs/i],describe(n){const e={name:"SlimerJS"},t=M.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e={name:"BlackBerry"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/(web|hpw)[o0]s/i],describe(n){const e={name:"WebOS Browser"},t=M.getFirstMatch(te,n)||M.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/bada/i],describe(n){const e={name:"Bada"},t=M.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/tizen/i],describe(n){const e={name:"Tizen"},t=M.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/qupzilla/i],describe(n){const e={name:"QupZilla"},t=M.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/firefox|iceweasel|fxios/i],describe(n){const e={name:"Firefox"},t=M.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/electron/i],describe(n){const e={name:"Electron"},t=M.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/MiuiBrowser/i],describe(n){const e={name:"Miui"},t=M.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/chromium/i],describe(n){const e={name:"Chromium"},t=M.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/chrome|crios|crmo/i],describe(n){const e={name:"Chrome"},t=M.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/GSA/i],describe(n){const e={name:"Google Search"},t=M.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){const e=!n.test(/like android/i),t=n.test(/android/i);return e&&t},describe(n){const e={name:"Android Browser"},t=M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/playstation 4/i],describe(n){const e={name:"PlayStation 4"},t=M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/safari|applewebkit/i],describe(n){const e={name:"Safari"},t=M.getFirstMatch(te,n);return t&&(e.version=t),e}},{test:[/.*/i],describe(n){const e=n.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:M.getFirstMatch(e,n),version:M.getSecondMatch(e,n)}}}];var El=[{test:[/Roku\/DVP/],describe(n){const e=M.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return{name:ve.Roku,version:e}}},{test:[/windows phone/i],describe(n){const e=M.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return{name:ve.WindowsPhone,version:e}}},{test:[/windows /i],describe(n){const e=M.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),t=M.getWindowsVersionName(e);return{name:ve.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const e={name:ve.iOS},t=M.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return t&&(e.version=t),e}},{test:[/macintosh/i],describe(n){const e=M.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),t=M.getMacOSVersionName(e),r={name:ve.MacOS,version:e};return t&&(r.versionName=t),r}},{test:[/(ipod|iphone|ipad)/i],describe(n){const e=M.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return{name:ve.iOS,version:e}}},{test(n){const e=!n.test(/like android/i),t=n.test(/android/i);return e&&t},describe(n){const e=M.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),t=M.getAndroidVersionName(e),r={name:ve.Android,version:e};return t&&(r.versionName=t),r}},{test:[/(web|hpw)[o0]s/i],describe(n){const e=M.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),t={name:ve.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e=M.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||M.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||M.getFirstMatch(/\bbb(\d+)/i,n);return{name:ve.BlackBerry,version:e}}},{test:[/bada/i],describe(n){const e=M.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return{name:ve.Bada,version:e}}},{test:[/tizen/i],describe(n){const e=M.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return{name:ve.Tizen,version:e}}},{test:[/linux/i],describe:()=>({name:ve.Linux})},{test:[/CrOS/],describe:()=>({name:ve.ChromeOS})},{test:[/PlayStation 4/],describe(n){const e=M.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return{name:ve.PlayStation4,version:e}}}],Ml=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(n){const e=M.getFirstMatch(/(can-l01)/i,n)&&"Nova",t={type:oe.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:oe.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:oe.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:oe.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:oe.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:oe.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:oe.tablet})},{test(n){const e=n.test(/ipod|iphone/i),t=n.test(/like (ipod|iphone)/i);return e&&!t},describe(n){const e=M.getFirstMatch(/(ipod|iphone)/i,n);return{type:oe.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:oe.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:oe.mobile})},{test:n=>n.getBrowserName(!0)==="blackberry",describe:()=>({type:oe.mobile,vendor:"BlackBerry"})},{test:n=>n.getBrowserName(!0)==="bada",describe:()=>({type:oe.mobile})},{test:n=>n.getBrowserName()==="windows phone",describe:()=>({type:oe.mobile,vendor:"Microsoft"})},{test(n){const e=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(!0)==="android"&&e>=3},describe:()=>({type:oe.tablet})},{test:n=>n.getOSName(!0)==="android",describe:()=>({type:oe.mobile})},{test:n=>n.getOSName(!0)==="macos",describe:()=>({type:oe.desktop,vendor:"Apple"})},{test:n=>n.getOSName(!0)==="windows",describe:()=>({type:oe.desktop})},{test:n=>n.getOSName(!0)==="linux",describe:()=>({type:oe.desktop})},{test:n=>n.getOSName(!0)==="playstation 4",describe:()=>({type:oe.tv})},{test:n=>n.getOSName(!0)==="roku",describe:()=>({type:oe.tv})}],Tl=[{test:n=>n.getBrowserName(!0)==="microsoft edge",describe(n){if(/\sedg\//i.test(n))return{name:ct.Blink};const e=M.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return{name:ct.EdgeHTML,version:e}}},{test:[/trident/i],describe(n){const e={name:ct.Trident},t=M.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:n=>n.test(/presto/i),describe(n){const e={name:ct.Presto},t=M.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test(n){const e=n.test(/gecko/i),t=n.test(/like gecko/i);return e&&!t},describe(n){const e={name:ct.Gecko},t=M.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:ct.Blink})},{test:[/(apple)?webkit/i],describe(n){const e={name:ct.WebKit},t=M.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return t&&(e.version=t),e}}];class Es{constructor(e,t=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},t!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=M.find(Sl,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=M.find(El,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:t}=this.getOS();return e?String(t).toLowerCase()||"":t||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:t}=this.getPlatform();return e?String(t).toLowerCase()||"":t||""}parsePlatform(){this.parsedResult.platform={};const e=M.find(Ml,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=M.find(Tl,t=>{if(typeof t.test=="function")return t.test(this);if(t.test instanceof Array)return t.test.some(r=>this.test(r));throw new Error("Browser's test function is not valid")});return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return M.assign({},this.parsedResult)}satisfies(e){const t={};let r=0;const i={};let s=0;if(Object.keys(e).forEach(a=>{const c=e[a];typeof c=="string"?(i[a]=c,s+=1):typeof c=="object"&&(t[a]=c,r+=1)}),r>0){const a=Object.keys(t),c=M.find(a,u=>this.isOS(u));if(c){const u=this.satisfies(t[c]);if(u!==void 0)return u}const l=M.find(a,u=>this.isPlatform(u));if(l){const u=this.satisfies(t[l]);if(u!==void 0)return u}}if(s>0){const a=Object.keys(i),c=M.find(a,l=>this.isBrowser(l,!0));if(c!==void 0)return this.compareVersion(i[c])}}isBrowser(e,t=!1){const r=this.getBrowserName().toLowerCase();let i=e.toLowerCase();const s=M.getBrowserTypeByAlias(i);return t&&s&&(i=s.toLowerCase()),i===r}compareVersion(e){let t=[0],r=e,i=!1;const s=this.getBrowserVersion();if(typeof s=="string")return e[0]===">"||e[0]==="<"?(r=e.substr(1),e[1]==="="?(i=!0,r=e.substr(2)):t=[],e[0]===">"?t.push(1):t.push(-1)):e[0]==="="?r=e.substr(1):e[0]==="~"&&(i=!0,r=e.substr(1)),t.indexOf(M.compareVersions(s,r,i))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,t=!1){return this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some(t=>this.is(t))}}/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class Cl{static getParser(e,t=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new Es(e,t)}static parse(e){return new Es(e).getResult()}static get BROWSER_MAP(){return Wo}static get ENGINE_MAP(){return ct}static get OS_MAP(){return ve}static get PLATFORMS_MAP(){return oe}}function kr(){return Date.now()+Math.random().toString()}function pn(){throw new Error("Method must be implemented in subclass")}function qo(n,e){return e!=null&&e.proxyUrl?e.proxyUrl+(e.proxyUrl.slice(-1)==="/"?"":"/")+n.substring(8):n}function nr(n){return n!=null&&n.callObjectBundleUrlOverride?n.callObjectBundleUrlOverride:qo("https://c.daily.co/call-machine/versioned/".concat("0.79.0","/static/call-machine-object-bundle.js"),n)}function rr(n){try{new URL(n)}catch{return!1}return!0}const ie=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,It="8.55.0",Y=globalThis;function ir(n,e,t){const r=Y,i=r.__SENTRY__=r.__SENTRY__||{},s=i[It]=i[It]||{};return s[n]||(s[n]=e())}const Ft=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,si=["debug","info","warn","error","log","assert","trace"],sr={};function Mn(n){if(!("console"in Y))return n();const e=Y.console,t={},r=Object.keys(sr);r.forEach(i=>{const s=sr[i];t[i]=e[i],e[i]=s});try{return n()}finally{r.forEach(i=>{e[i]=t[i]})}}const $=ir("logger",function(){let n=!1;const e={enable:()=>{n=!0},disable:()=>{n=!1},isEnabled:()=>n};return Ft?si.forEach(t=>{e[t]=(...r)=>{n&&Mn(()=>{Y.console[t](`Sentry Logger [${t}]:`,...r)})}}):si.forEach(t=>{e[t]=()=>{}}),e}),Pt="?",Ms=/\(error: (.*)\)/,Ts=/captureMessage|captureException/;function xn(n){return n[n.length-1]||{}}const Cs="<anonymous>";function ht(n){try{return n&&typeof n=="function"&&n.name||Cs}catch{return Cs}}function Os(n){const e=n.exception;if(e){const t=[];try{return e.values.forEach(r=>{r.stacktrace.frames&&t.push(...r.stacktrace.frames)}),t}catch{return}}}const Xn={},As={};function Nt(n,e){Xn[n]=Xn[n]||[],Xn[n].push(e)}function xt(n,e){if(!As[n]){As[n]=!0;try{e()}catch(t){Ft&&$.error(`Error while instrumenting ${n}`,t)}}}function Ve(n,e){const t=n&&Xn[n];if(t)for(const r of t)try{r(e)}catch(i){Ft&&$.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${ht(r)}
Error:`,i)}}let Ir=null;function Ol(){Ir=Y.onerror,Y.onerror=function(n,e,t,r,i){return Ve("error",{column:r,error:i,line:t,msg:n,url:e}),!!Ir&&Ir.apply(this,arguments)},Y.onerror.__SENTRY_INSTRUMENTED__=!0}let Nr=null;function Al(){Nr=Y.onunhandledrejection,Y.onunhandledrejection=function(n){return Ve("unhandledrejection",n),!Nr||Nr.apply(this,arguments)},Y.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function Sr(){return Li(Y),Y}function Li(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||It,e[It]=e[It]||{}}const Jo=Object.prototype.toString;function Ri(n){switch(Jo.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return Lt(n,Error)}}function rn(n,e){return Jo.call(n)===`[object ${e}]`}function zo(n){return rn(n,"ErrorEvent")}function Ps(n){return rn(n,"DOMError")}function et(n){return rn(n,"String")}function Di(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function ai(n){return n===null||Di(n)||typeof n!="object"&&typeof n!="function"}function Qt(n){return rn(n,"Object")}function Er(n){return typeof Event<"u"&&Lt(n,Event)}function Mr(n){return!!(n&&n.then&&typeof n.then=="function")}function Lt(n,e){try{return n instanceof e}catch{return!1}}function Go(n){return!(typeof n!="object"||n===null||!n.__isVue&&!n._isVue)}const Bi=Y;function Ko(n,e={}){if(!n)return"<unknown>";try{let t=n;const r=5,i=[];let s=0,a=0;const c=" > ",l=c.length;let u;const h=Array.isArray(e)?e:e.keyAttrs,m=!Array.isArray(e)&&e.maxStringLength||80;for(;t&&s++<r&&(u=Pl(t,h),!(u==="html"||s>1&&a+i.length*l+u.length>=m));)i.push(u),a+=u.length,t=t.parentNode;return i.reverse().join(c)}catch{return"<unknown>"}}function Pl(n,e){const t=n,r=[];if(!t||!t.tagName)return"";if(Bi.HTMLElement&&t instanceof HTMLElement&&t.dataset){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}r.push(t.tagName.toLowerCase());const i=e&&e.length?e.filter(a=>t.getAttribute(a)).map(a=>[a,t.getAttribute(a)]):null;if(i&&i.length)i.forEach(a=>{r.push(`[${a[0]}="${a[1]}"]`)});else{t.id&&r.push(`#${t.id}`);const a=t.className;if(a&&et(a)){const c=a.split(/\s+/);for(const l of c)r.push(`.${l}`)}}const s=["aria-label","type","name","title","alt"];for(const a of s){const c=t.getAttribute(a);c&&r.push(`[${a}="${c}"]`)}return r.join("")}function zt(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function Is(n,e){if(!Array.isArray(n))return"";const t=[];for(let r=0;r<n.length;r++){const i=n[r];try{Go(i)?t.push("[VueViewModel]"):t.push(String(i))}catch{t.push("[value cannot be serialized]")}}return t.join(e)}function Il(n,e,t=!1){return!!et(n)&&(rn(e,"RegExp")?e.test(n):!!et(e)&&(t?n===e:n.includes(e)))}function Ln(n,e=[],t=!1){return e.some(r=>Il(n,r,t))}function Me(n,e,t){if(!(e in n))return;const r=n[e],i=t(r);typeof i=="function"&&Qo(i,r);try{n[e]=i}catch{Ft&&$.log(`Failed to replace method "${e}" in object`,n)}}function Rt(n,e,t){try{Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0})}catch{Ft&&$.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function Qo(n,e){try{const t=e.prototype||{};n.prototype=e.prototype=t,Rt(n,"__sentry_original__",e)}catch{}}function ji(n){return n.__sentry_original__}function Ho(n){if(Ri(n))return{message:n.message,name:n.name,stack:n.stack,...xs(n)};if(Er(n)){const e={type:n.type,target:Ns(n.target),currentTarget:Ns(n.currentTarget),...xs(n)};return typeof CustomEvent<"u"&&Lt(n,CustomEvent)&&(e.detail=n.detail),e}return n}function Ns(n){try{return e=n,typeof Element<"u"&&Lt(e,Element)?Ko(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}var e}function xs(n){if(typeof n=="object"&&n!==null){const e={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}return{}}function Pe(n){return oi(n,new Map)}function oi(n,e){if(function(t){if(!Qt(t))return!1;try{const r=Object.getPrototypeOf(t).constructor.name;return!r||r==="Object"}catch{return!0}}(n)){const t=e.get(n);if(t!==void 0)return t;const r={};e.set(n,r);for(const i of Object.getOwnPropertyNames(n))n[i]!==void 0&&(r[i]=oi(n[i],e));return r}if(Array.isArray(n)){const t=e.get(n);if(t!==void 0)return t;const r=[];return e.set(n,r),n.forEach(i=>{r.push(oi(i,e))}),r}return n}function Tn(){return Date.now()/1e3}const nt=function(){const{performance:n}=Y;if(!n||!n.now)return Tn;const e=Date.now()-n.now(),t=n.timeOrigin==null?e:n.timeOrigin;return()=>(t+n.now())/1e3}();function Ie(){const n=Y,e=n.crypto||n.msCrypto;let t=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(t=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,r=>(r^(15&t())>>r/4).toString(16))}function Xo(n){return n.exception&&n.exception.values?n.exception.values[0]:void 0}function lt(n){const{message:e,event_id:t}=n;if(e)return e;const r=Xo(n);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||t||"<unknown>":t||"<unknown>"}function ci(n,e,t){const r=n.exception=n.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type="Error")}function Ht(n,e){const t=Xo(n);if(!t)return;const r=t.mechanism;if(t.mechanism={type:"generic",handled:!0,...r,...e},e&&"data"in e){const i={...r&&r.data,...e.data};t.mechanism.data=i}}function Ls(n){if(function(e){try{return e.__sentry_captured__}catch{}}(n))return!0;try{Rt(n,"__sentry_captured__",!0)}catch{}return!1}var Xe;function Dt(n){return new Ae(e=>{e(n)})}function ar(n){return new Ae((e,t)=>{t(n)})}(()=>{const{performance:n}=Y;!n||!n.now||(n.now(),n.timing&&n.timing.navigationStart)})(),function(n){n[n.PENDING=0]="PENDING",n[n.RESOLVED=1]="RESOLVED",n[n.REJECTED=2]="REJECTED"}(Xe||(Xe={}));class Ae{constructor(e){Ae.prototype.__init.call(this),Ae.prototype.__init2.call(this),Ae.prototype.__init3.call(this),Ae.prototype.__init4.call(this),this._state=Xe.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(t){this._reject(t)}}then(e,t){return new Ae((r,i)=>{this._handlers.push([!1,s=>{if(e)try{r(e(s))}catch(a){i(a)}else r(s)},s=>{if(t)try{r(t(s))}catch(a){i(a)}else i(s)}]),this._executeHandlers()})}catch(e){return this.then(t=>t,e)}finally(e){return new Ae((t,r)=>{let i,s;return this.then(a=>{s=!1,i=a,e&&e()},a=>{s=!0,i=a,e&&e()}).then(()=>{s?r(i):t(i)})})}__init(){this._resolve=e=>{this._setResult(Xe.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Xe.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{this._state===Xe.PENDING&&(Mr(t)?t.then(this._resolve,this._reject):(this._state=e,this._value=t,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===Xe.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(t=>{t[0]||(this._state===Xe.RESOLVED&&t[1](this._value),this._state===Xe.REJECTED&&t[2](this._value),t[0]=!0)})}}}function Nl(n){const e=nt(),t={sid:Ie(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(r){return Pe({sid:`${r.sid}`,init:r.init,started:new Date(1e3*r.started).toISOString(),timestamp:new Date(1e3*r.timestamp).toISOString(),status:r.status,errors:r.errors,did:typeof r.did=="number"||typeof r.did=="string"?`${r.did}`:void 0,duration:r.duration,abnormal_mechanism:r.abnormal_mechanism,attrs:{release:r.release,environment:r.environment,ip_address:r.ipAddress,user_agent:r.userAgent}})}(t)};return n&&Xt(t,n),t}function Xt(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),n.did||e.did||(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||nt(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:Ie()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const t=n.timestamp-n.started;n.duration=t>=0?t:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function Rs(){return Ie()}function li(){return Ie().substring(16)}function Tr(n,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(n&&e&&Object.keys(e).length===0)return n;const r={...n};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=Tr(r[i],e[i],t-1));return r}const ui="_sentrySpan";function Ds(n,e){e?Rt(n,ui,e):delete n[ui]}function Bs(n){return n[ui]}class Fi{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Rs(),spanId:li()}}clone(){const e=new Fi;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Ds(e,Bs(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Xt(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,[r,i]=t instanceof pt?[t.getScopeData(),t.getRequestSession()]:Qt(t)?[e,e.requestSession]:[],{tags:s,extra:a,user:c,contexts:l,level:u,fingerprint:h=[],propagationContext:m}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...a},this._contexts={...this._contexts,...l},c&&Object.keys(c).length&&(this._user=c),u&&(this._level=u),h.length&&(this._fingerprint=h),m&&(this._propagationContext=m),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Ds(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Rs()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const r=typeof t=="number"?t:100;if(r<=0)return this;const i={timestamp:Tn(),...e};return this._breadcrumbs.push(i),this._breadcrumbs.length>r&&(this._breadcrumbs=this._breadcrumbs.slice(-r),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Bs(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Tr(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:li(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,t){const r=t&&t.event_id?t.event_id:Ie();if(!this._client)return $.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...t,event_id:r},this),r}captureMessage(e,t,r){const i=r&&r.event_id?r.event_id:Ie();if(!this._client)return $.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,t){const r=t&&t.event_id?t.event_id:Ie();return this._client?(this._client.captureEvent(e,{...t,event_id:r},this),r):($.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const pt=Fi;class xl{constructor(e,t){let r,i;r=e||new pt,i=t||new pt,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const t=this._pushScope();let r;try{r=e(t)}catch(i){throw this._popScope(),i}return Mr(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function Yt(){const n=Li(Sr());return n.stack=n.stack||new xl(ir("defaultCurrentScope",()=>new pt),ir("defaultIsolationScope",()=>new pt))}function Ll(n){return Yt().withScope(n)}function Rl(n,e){const t=Yt();return t.withScope(()=>(t.getStackTop().scope=n,e(n)))}function js(n){return Yt().withScope(()=>n(Yt().getIsolationScope()))}function $i(n){const e=Li(n);return e.acs?e.acs:{withIsolationScope:js,withScope:Ll,withSetScope:Rl,withSetIsolationScope:(t,r)=>js(r),getCurrentScope:()=>Yt().getScope(),getIsolationScope:()=>Yt().getIsolationScope()}}function $t(){return $i(Sr()).getCurrentScope()}function Cn(){return $i(Sr()).getIsolationScope()}function pe(){return $t().getClient()}function Dl(n){const e=n.getPropagationContext(),{traceId:t,spanId:r,parentSpanId:i}=e;return Pe({trace_id:t,span_id:r,parent_span_id:i})}function Bl(n){const e=n._sentryMetrics;if(!e)return;const t={};for(const[,[r,i]]of e)(t[r]||(t[r]=[])).push(Pe(i));return t}const jl=/^sentry-/;function Fl(n){const e=function(r){if(!(!r||!et(r)&&!Array.isArray(r)))return Array.isArray(r)?r.reduce((i,s)=>{const a=Fs(s);return Object.entries(a).forEach(([c,l])=>{i[c]=l}),i},{}):Fs(r)}(n);if(!e)return;const t=Object.entries(e).reduce((r,[i,s])=>(i.match(jl)&&(r[i.slice(7)]=s),r),{});return Object.keys(t).length>0?t:void 0}function Fs(n){return n.split(",").map(e=>e.split("=").map(t=>decodeURIComponent(t.trim()))).reduce((e,[t,r])=>(t&&r&&(e[t]=r),e),{})}let $s=!1;function $l(n){const{spanId:e,traceId:t,isRemote:r}=n.spanContext();return Pe({parent_span_id:r?e:Ui(n).parent_span_id,span_id:r?li():e,trace_id:t})}function Us(n){return typeof n=="number"?Vs(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?Vs(n.getTime()):nt()}function Vs(n){return n>9999999999?n/1e3:n}function Ui(n){if(function(e){return typeof e.getSpanJSON=="function"}(n))return n.getSpanJSON();try{const{spanId:e,traceId:t}=n.spanContext();if(function(r){const i=r;return!!(i.attributes&&i.startTime&&i.name&&i.endTime&&i.status)}(n)){const{attributes:r,startTime:i,name:s,endTime:a,parentSpanId:c,status:l}=n;return Pe({span_id:e,trace_id:t,data:r,description:s,parent_span_id:c,start_timestamp:Us(i),timestamp:Us(a)||void 0,status:Ul(l),op:r["sentry.op"],origin:r["sentry.origin"],_metrics_summary:Bl(n)})}return{span_id:e,trace_id:t}}catch{return{}}}function Ul(n){if(n&&n.code!==0)return n.code===1?"ok":n.message||"unknown_error"}function Yo(n){return n._sentryRootSpan||n}function Vl(){$s||(Mn(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),$s=!0)}const Vi="production";function Zo(n,e){const t=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=Pe({environment:t.environment||Vi,release:t.release,public_key:r,trace_id:n});return e.emit("createDsc",i),i}function Wl(n){const e=pe();if(!e)return{};const t=Yo(n),r=t._frozenDsc;if(r)return r;const i=t.spanContext().traceState,s=i&&i.get("sentry.dsc"),a=s&&Fl(s);if(a)return a;const c=Zo(n.spanContext().traceId,e),l=Ui(t),u=l.data||{},h=u["sentry.sample_rate"];h!=null&&(c.sample_rate=`${h}`);const m=u["sentry.source"],v=l.description;return m!=="url"&&v&&(c.transaction=v),function(_){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const y=pe(),k=y&&y.getOptions();return!!k&&(k.enableTracing||"tracesSampleRate"in k||"tracesSampler"in k)}()&&(c.sampled=String(function(_){const{traceFlags:y}=_.spanContext();return y===1}(t))),e.emit("createDsc",c,t),c}const ql=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function or(n,e=!1){const{host:t,path:r,pass:i,port:s,projectId:a,protocol:c,publicKey:l}=n;return`${c}://${l}${e&&i?`:${i}`:""}@${t}${s?`:${s}`:""}/${r&&`${r}/`}${a}`}function Ws(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function Jl(n){const e=typeof n=="string"?function(t){const r=ql.exec(t);if(!r)return void Mn(()=>{console.error(`Invalid Sentry Dsn: ${t}`)});const[i,s,a="",c="",l="",u=""]=r.slice(1);let h="",m=u;const v=m.split("/");if(v.length>1&&(h=v.slice(0,-1).join("/"),m=v.pop()),m){const _=m.match(/^\d+/);_&&(m=_[0])}return Ws({host:c,pass:a,path:h,projectId:m,port:l,protocol:i,publicKey:s})}(n):Ws(n);if(e&&function(t){if(!Ft)return!0;const{port:r,projectId:i,protocol:s}=t;return!(["protocol","publicKey","host","projectId"].find(a=>!t[a]&&($.error(`Invalid Sentry Dsn: ${a} missing`),!0))||(i.match(/^\d+$/)?function(a){return a==="http"||a==="https"}(s)?r&&isNaN(parseInt(r,10))&&($.error(`Invalid Sentry Dsn: Invalid port ${r}`),1):($.error(`Invalid Sentry Dsn: Invalid protocol ${s}`),1):($.error(`Invalid Sentry Dsn: Invalid projectId ${i}`),1)))}(e))return e}function Ye(n,e=100,t=1/0){try{return di("",n,e,t)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function ec(n,e=3,t=102400){const r=Ye(n,e);return i=r,function(s){return~-encodeURI(s).split(/%..|./).length}(JSON.stringify(i))>t?ec(n,e-1,t):r;var i}function di(n,e,t=1/0,r=1/0,i=function(){const s=typeof WeakSet=="function",a=s?new WeakSet:[];return[function(c){if(s)return!!a.has(c)||(a.add(c),!1);for(let l=0;l<a.length;l++)if(a[l]===c)return!0;return a.push(c),!1},function(c){if(s)a.delete(c);else for(let l=0;l<a.length;l++)if(a[l]===c){a.splice(l,1);break}}]}()){const[s,a]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const c=function(_,y){try{if(_==="domain"&&y&&typeof y=="object"&&y._events)return"[Domain]";if(_==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&y===global)return"[Global]";if(typeof window<"u"&&y===window)return"[Window]";if(typeof document<"u"&&y===document)return"[Document]";if(Go(y))return"[VueViewModel]";if(Qt(k=y)&&"nativeEvent"in k&&"preventDefault"in k&&"stopPropagation"in k)return"[SyntheticEvent]";if(typeof y=="number"&&!Number.isFinite(y))return`[${y}]`;if(typeof y=="function")return`[Function: ${ht(y)}]`;if(typeof y=="symbol")return`[${String(y)}]`;if(typeof y=="bigint")return`[BigInt: ${String(y)}]`;const P=function(N){const B=Object.getPrototypeOf(N);return B?B.constructor.name:"null prototype"}(y);return/^HTML(\w*)Element$/.test(P)?`[HTMLElement: ${P}]`:`[object ${P}]`}catch(P){return`**non-serializable** (${P})`}var k}(n,e);if(!c.startsWith("[object "))return c;if(e.__sentry_skip_normalization__)return e;const l=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:t;if(l===0)return c.replace("object ","");if(s(e))return"[Circular ~]";const u=e;if(u&&typeof u.toJSON=="function")try{return di("",u.toJSON(),l-1,r,i)}catch{}const h=Array.isArray(e)?[]:{};let m=0;const v=Ho(e);for(const _ in v){if(!Object.prototype.hasOwnProperty.call(v,_))continue;if(m>=r){h[_]="[MaxProperties ~]";break}const y=v[_];h[_]=di(_,y,l-1,r,i),m++}return a(e),h}function En(n,e=[]){return[n,e]}function zl(n,e){const[t,r]=n;return[t,[...r,e]]}function qs(n,e){const t=n[1];for(const r of t)if(e(r,r[0].type))return!0;return!1}function fi(n){return Y.__SENTRY__&&Y.__SENTRY__.encodePolyfill?Y.__SENTRY__.encodePolyfill(n):new TextEncoder().encode(n)}function Gl(n){const[e,t]=n;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[fi(r),s]:r.push(typeof s=="string"?fi(s):s)}for(const s of t){const[a,c]=s;if(i(`
${JSON.stringify(a)}
`),typeof c=="string"||c instanceof Uint8Array)i(c);else{let l;try{l=JSON.stringify(c)}catch{l=JSON.stringify(Ye(c))}i(l)}}return typeof r=="string"?r:function(s){const a=s.reduce((u,h)=>u+h.length,0),c=new Uint8Array(a);let l=0;for(const u of s)c.set(u,l),l+=u.length;return c}(r)}function Kl(n){const e=typeof n.data=="string"?fi(n.data):n.data;return[Pe({type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType}),e]}const Ql={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function Js(n){return Ql[n]}function tc(n){if(!n||!n.sdk)return;const{name:e,version:t}=n.sdk;return{name:e,version:t}}function Hl(n,e,t,r){const i=tc(t),s=n.type&&n.type!=="replay_event"?n.type:"event";(function(c,l){l&&(c.sdk=c.sdk||{},c.sdk.name=c.sdk.name||l.name,c.sdk.version=c.sdk.version||l.version,c.sdk.integrations=[...c.sdk.integrations||[],...l.integrations||[]],c.sdk.packages=[...c.sdk.packages||[],...l.packages||[]])})(n,t&&t.sdk);const a=function(c,l,u,h){const m=c.sdkProcessingMetadata&&c.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:c.event_id,sent_at:new Date().toISOString(),...l&&{sdk:l},...!!u&&h&&{dsn:or(h)},...m&&{trace:Pe({...m})}}}(n,i,r,e);return delete n.sdkProcessingMetadata,En(a,[[{type:s},n]])}function hi(n,e,t,r=0){return new Ae((i,s)=>{const a=n[r];if(e===null||typeof a!="function")i(e);else{const c=a({...e},t);ie&&a.id&&c===null&&$.log(`Event processor "${a.id}" dropped event`),Mr(c)?c.then(l=>hi(n,l,t,r+1).then(i)).then(null,s):hi(n,c,t,r+1).then(i).then(null,s)}})}let Rn,zs,xr;function Xl(n,e){const{fingerprint:t,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;(function(a,c){const{extra:l,tags:u,user:h,contexts:m,level:v,transactionName:_}=c,y=Pe(l);y&&Object.keys(y).length&&(a.extra={...y,...a.extra});const k=Pe(u);k&&Object.keys(k).length&&(a.tags={...k,...a.tags});const P=Pe(h);P&&Object.keys(P).length&&(a.user={...P,...a.user});const N=Pe(m);N&&Object.keys(N).length&&(a.contexts={...N,...a.contexts}),v&&(a.level=v),_&&a.type!=="transaction"&&(a.transaction=_)})(n,e),r&&function(a,c){a.contexts={trace:$l(c),...a.contexts},a.sdkProcessingMetadata={dynamicSamplingContext:Wl(c),...a.sdkProcessingMetadata};const l=Yo(c),u=Ui(l).description;u&&!a.transaction&&a.type==="transaction"&&(a.transaction=u)}(n,r),function(a,c){a.fingerprint=a.fingerprint?Array.isArray(a.fingerprint)?a.fingerprint:[a.fingerprint]:[],c&&(a.fingerprint=a.fingerprint.concat(c)),a.fingerprint&&!a.fingerprint.length&&delete a.fingerprint}(n,t),function(a,c){const l=[...a.breadcrumbs||[],...c];a.breadcrumbs=l.length?l:void 0}(n,i),function(a,c){a.sdkProcessingMetadata={...a.sdkProcessingMetadata,...c}}(n,s)}function Gs(n,e){const{extra:t,tags:r,user:i,contexts:s,level:a,sdkProcessingMetadata:c,breadcrumbs:l,fingerprint:u,eventProcessors:h,attachments:m,propagationContext:v,transactionName:_,span:y}=e;Dn(n,"extra",t),Dn(n,"tags",r),Dn(n,"user",i),Dn(n,"contexts",s),n.sdkProcessingMetadata=Tr(n.sdkProcessingMetadata,c,2),a&&(n.level=a),_&&(n.transactionName=_),y&&(n.span=y),l.length&&(n.breadcrumbs=[...n.breadcrumbs,...l]),u.length&&(n.fingerprint=[...n.fingerprint,...u]),h.length&&(n.eventProcessors=[...n.eventProcessors,...h]),m.length&&(n.attachments=[...n.attachments,...m]),n.propagationContext={...n.propagationContext,...v}}function Dn(n,e,t){n[e]=Tr(n[e],t,1)}function Yl(n,e,t,r,i,s){const{normalizeDepth:a=3,normalizeMaxBreadth:c=1e3}=n,l={...e,event_id:e.event_id||t.event_id||Ie(),timestamp:e.timestamp||Tn()},u=t.integrations||n.integrations.map(y=>y.name);(function(y,k){const{environment:P,release:N,dist:B,maxValueLength:D=250}=k;y.environment=y.environment||P||Vi,!y.release&&N&&(y.release=N),!y.dist&&B&&(y.dist=B),y.message&&(y.message=zt(y.message,D));const T=y.exception&&y.exception.values&&y.exception.values[0];T&&T.value&&(T.value=zt(T.value,D));const w=y.request;w&&w.url&&(w.url=zt(w.url,D))})(l,n),function(y,k){k.length>0&&(y.sdk=y.sdk||{},y.sdk.integrations=[...y.sdk.integrations||[],...k])}(l,u),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&function(y,k){const P=function(N){const B=Y._sentryDebugIds;if(!B)return{};const D=Object.keys(B);return xr&&D.length===zs||(zs=D.length,xr=D.reduce((T,w)=>{Rn||(Rn={});const C=Rn[w];if(C)T[C[0]]=C[1];else{const I=N(w);for(let x=I.length-1;x>=0;x--){const V=I[x],F=V&&V.filename,se=B[w];if(F&&se){T[F]=se,Rn[w]=[F,se];break}}}return T},{})),xr}(k);try{y.exception.values.forEach(N=>{N.stacktrace.frames.forEach(B=>{P&&B.filename&&(B.debug_id=P[B.filename])})})}catch{}}(l,n.stackParser);const h=function(y,k){if(!k)return y;const P=y?y.clone():new pt;return P.update(k),P}(r,t.captureContext);t.mechanism&&Ht(l,t.mechanism);const m=i?i.getEventProcessors():[],v=ir("globalScope",()=>new pt).getScopeData();s&&Gs(v,s.getScopeData()),h&&Gs(v,h.getScopeData());const _=[...t.attachments||[],...v.attachments];return _.length&&(t.attachments=_),Xl(l,v),hi([...m,...v.eventProcessors],l,t).then(y=>(y&&function(k){const P={};try{k.exception.values.forEach(B=>{B.stacktrace.frames.forEach(D=>{D.debug_id&&(D.abs_path?P[D.abs_path]=D.debug_id:D.filename&&(P[D.filename]=D.debug_id),delete D.debug_id)})})}catch{}if(Object.keys(P).length===0)return;k.debug_meta=k.debug_meta||{},k.debug_meta.images=k.debug_meta.images||[];const N=k.debug_meta.images;Object.entries(P).forEach(([B,D])=>{N.push({type:"sourcemap",code_file:B,debug_id:D})})}(y),typeof a=="number"&&a>0?function(k,P,N){if(!k)return null;const B={...k,...k.breadcrumbs&&{breadcrumbs:k.breadcrumbs.map(D=>({...D,...D.data&&{data:Ye(D.data,P,N)}}))},...k.user&&{user:Ye(k.user,P,N)},...k.contexts&&{contexts:Ye(k.contexts,P,N)},...k.extra&&{extra:Ye(k.extra,P,N)}};return k.contexts&&k.contexts.trace&&B.contexts&&(B.contexts.trace=k.contexts.trace,k.contexts.trace.data&&(B.contexts.trace.data=Ye(k.contexts.trace.data,P,N))),k.spans&&(B.spans=k.spans.map(D=>({...D,...D.data&&{data:Ye(D.data,P,N)}}))),k.contexts&&k.contexts.flags&&B.contexts&&(B.contexts.flags=Ye(k.contexts.flags,3,N)),B}(y,a,c):y))}function Ks(n,e){return $t().captureEvent(n,e)}function Qs(n){const e=pe(),t=Cn(),r=$t(),{release:i,environment:s=Vi}=e&&e.getOptions()||{},{userAgent:a}=Y.navigator||{},c=Nl({release:i,environment:s,user:r.getUser()||t.getUser(),...a&&{userAgent:a},...n}),l=t.getSession();return l&&l.status==="ok"&&Xt(l,{status:"exited"}),nc(),t.setSession(c),r.setSession(c),c}function nc(){const n=Cn(),e=$t(),t=e.getSession()||n.getSession();t&&function(r,i){let s={};r.status==="ok"&&(s={status:"exited"}),Xt(r,s)}(t),rc(),n.setSession(),e.setSession()}function rc(){const n=Cn(),e=$t(),t=pe(),r=e.getSession()||n.getSession();r&&t&&t.captureSession(r)}function Hs(n=!1){n?nc():rc()}function Zl(n,e,t){return e||`${function(r){return`${function(i){const s=i.protocol?`${i.protocol}:`:"",a=i.port?`:${i.port}`:"";return`${s}//${i.host}${a}${i.path?`/${i.path}`:""}/api/`}(r)}${r.projectId}/envelope/`}(n)}?${function(r,i){const s={sentry_version:"7"};return r.publicKey&&(s.sentry_key=r.publicKey),i&&(s.sentry_client=`${i.name}/${i.version}`),new URLSearchParams(s).toString()}(n,t)}`}const Xs=[];function Ys(n,e){for(const t of e)t&&t.afterAllSetup&&t.afterAllSetup(n)}function Zs(n,e,t){if(t[e.name])ie&&$.log(`Integration skipped because it was already installed: ${e.name}`);else{if(t[e.name]=e,Xs.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Xs.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);n.on("preprocessEvent",(i,s)=>r(i,s,n))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,a)=>r(s,a,n),{id:e.name});n.addEventProcessor(i)}ie&&$.log(`Integration installed: ${e.name}`)}}class Be extends Error{constructor(e,t="warn"){super(e),this.message=e,this.logLevel=t}}const ea="Not capturing exception because it's already been captured.";class eu{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Jl(e.dsn):ie&&$.warn("No DSN provided, client will not send events."),this._dsn){const r=Zl(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:r})}const t=["enableTracing","tracesSampleRate","tracesSampler"].find(r=>r in e&&e[r]==null);t&&Mn(()=>{console.warn(`[Sentry] Deprecation warning: \`${t}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,t,r){const i=Ie();if(Ls(e))return ie&&$.log(ea),i;const s={event_id:i,...t};return this._process(this.eventFromException(e,s).then(a=>this._captureEvent(a,s,r))),s.event_id}captureMessage(e,t,r,i){const s={event_id:Ie(),...r},a=Di(e)?e:String(e),c=ai(e)?this.eventFromMessage(a,t,s):this.eventFromException(e,s);return this._process(c.then(l=>this._captureEvent(l,s,i))),s.event_id}captureEvent(e,t,r){const i=Ie();if(t&&t.originalException&&Ls(t.originalException))return ie&&$.log(ea),i;const s={event_id:i,...t},a=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,a||r)),s.event_id}captureSession(e){typeof e.release!="string"?ie&&$.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),Xt(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>t.flush(e).then(i=>r&&i))):Dt(!0)}close(e){return this.flush(e).then(t=>(this.getOptions().enabled=!1,this.emit("close"),t))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Zs(this,e,this._integrations),t||Ys(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let r=Hl(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of t.attachments||[])r=zl(r,Kl(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const t=function(r,i,s,a){const c=tc(s);return En({sent_at:new Date().toISOString(),...c&&{sdk:c},...!!a&&i&&{dsn:or(i)}},["aggregates"in r?[{type:"sessions"},r]:[{type:"session"},r.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${t}`;ie&&$.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,t){const r=this._hooks[e]=this._hooks[e]||[];return r.push(t),()=>{const i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){const r=this._hooks[e];r&&r.forEach(i=>i(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,t=>(ie&&$.error("Error while sending envelope:",t),t)):(ie&&$.error("Transport disabled"),Dt({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(t,r){const i={};return r.forEach(s=>{s&&Zs(t,s,i)}),i}(this,e),Ys(this,e)}_updateSessionFromEvent(e,t){let r=t.level==="fatal",i=!1;const s=t.exception&&t.exception.values;if(s){i=!0;for(const c of s){const l=c.mechanism;if(l&&l.handled===!1){r=!0;break}}}const a=e.status==="ok";(a&&e.errors===0||a&&r)&&(Xt(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Ae(t=>{let r=0;const i=setInterval(()=>{this._numProcessing==0?(clearInterval(i),t(!0)):(r+=1,e&&r>=e&&(clearInterval(i),t(!1)))},1)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,t,r=$t(),i=Cn()){const s=this.getOptions(),a=Object.keys(this._integrations);return!t.integrations&&a.length>0&&(t.integrations=a),this.emit("preprocessEvent",e,t),e.type||i.setLastEventId(e.event_id||t.event_id),Yl(s,e,t,r,this,i).then(c=>{if(c===null)return c;c.contexts={trace:Dl(r),...c.contexts};const l=function(u,h){const m=h.getPropagationContext();return m.dsc||Zo(m.traceId,u)}(this,r);return c.sdkProcessingMetadata={dynamicSamplingContext:l,...c.sdkProcessingMetadata},c})}_captureEvent(e,t={},r){return this._processEvent(e,t,r).then(i=>i.event_id,i=>{ie&&(i instanceof Be&&i.logLevel==="log"?$.log(i.message):$.warn(i))})}_processEvent(e,t,r){const i=this.getOptions(),{sampleRate:s}=i,a=na(e),c=ta(e),l=e.type||"error",u=`before send for type \`${l}\``,h=s===void 0?void 0:function(_){if(typeof _=="boolean")return Number(_);const y=typeof _=="string"?parseFloat(_):_;if(!(typeof y!="number"||isNaN(y)||y<0||y>1))return y;ie&&$.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(_)} of type ${JSON.stringify(typeof _)}.`)}(s);if(c&&typeof h=="number"&&Math.random()>h)return this.recordDroppedEvent("sample_rate","error",e),ar(new Be(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const m=l==="replay_event"?"replay":l,v=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,r,v).then(_=>{if(_===null)throw this.recordDroppedEvent("event_processor",m,e),new Be("An event processor returned `null`, will not send event.","log");if(t.data&&t.data.__sentry__===!0)return _;const y=function(k,P,N,B){const{beforeSend:D,beforeSendTransaction:T,beforeSendSpan:w}=P;if(ta(N)&&D)return D(N,B);if(na(N)){if(N.spans&&w){const C=[];for(const I of N.spans){const x=w(I);x?C.push(x):(Vl(),k.recordDroppedEvent("before_send","span"))}N.spans=C}if(T){if(N.spans){const C=N.spans.length;N.sdkProcessingMetadata={...N.sdkProcessingMetadata,spanCountBeforeProcessing:C}}return T(N,B)}}return N}(this,i,_,t);return function(k,P){const N=`${P} must return \`null\` or a valid event.`;if(Mr(k))return k.then(B=>{if(!Qt(B)&&B!==null)throw new Be(N);return B},B=>{throw new Be(`${P} rejected with ${B}`)});if(!Qt(k)&&k!==null)throw new Be(N);return k}(y,u)}).then(_=>{if(_===null){if(this.recordDroppedEvent("before_send",m,e),a){const P=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",P)}throw new Be(`${u} returned \`null\`, will not send event.`,"log")}const y=r&&r.getSession();if(!a&&y&&this._updateSessionFromEvent(y,_),a){const P=(_.sdkProcessingMetadata&&_.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(_.spans?_.spans.length:0);P>0&&this.recordDroppedEvent("before_send","span",P)}const k=_.transaction_info;if(a&&k&&_.transaction!==e.transaction){const P="custom";_.transaction_info={...k,source:P}}return this.sendEvent(_,t),_}).then(null,_=>{throw _ instanceof Be?_:(this.captureException(_,{data:{__sentry__:!0},originalException:_}),new Be(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${_}`))})}_process(e){this._numProcessing++,e.then(t=>(this._numProcessing--,t),t=>(this._numProcessing--,t))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([t,r])=>{const[i,s]=t.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){ie&&$.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0)return void(ie&&$.log("No outcomes to send"));if(!this._dsn)return void(ie&&$.log("No dsn provided, will not send outcomes"));ie&&$.log("Sending outcomes:",e);const t=(r=e,En((i=this._options.tunnel&&or(this._dsn))?{dsn:i}:{},[[{type:"client_report"},{timestamp:s||Tn(),discarded_events:r}]]));var r,i,s;this.sendEnvelope(t)}}function ta(n){return n.type===void 0}function na(n){return n.type==="transaction"}function tu(n){const e=[];function t(r){return e.splice(e.indexOf(r),1)[0]||Promise.resolve(void 0)}return{$:e,add:function(r){if(!(n===void 0||e.length<n))return ar(new Be("Not adding Promise because buffer limit was reached."));const i=r();return e.indexOf(i)===-1&&e.push(i),i.then(()=>t(i)).then(null,()=>t(i).then(null,()=>{})),i},drain:function(r){return new Ae((i,s)=>{let a=e.length;if(!a)return i(!0);const c=setTimeout(()=>{r&&r>0&&i(!1)},r);e.forEach(l=>{Dt(l).then(()=>{--a||(clearTimeout(c),i(!0))},s)})})}}}function nu(n,{statusCode:e,headers:t},r=Date.now()){const i={...n},s=t&&t["x-sentry-rate-limits"],a=t&&t["retry-after"];if(s)for(const c of s.trim().split(",")){const[l,u,,,h]=c.split(":",5),m=parseInt(l,10),v=1e3*(isNaN(m)?60:m);if(u)for(const _ of u.split(";"))_==="metric_bucket"&&h&&!h.split(";").includes("custom")||(i[_]=r+v);else i.all=r+v}else a?i.all=r+function(c,l=Date.now()){const u=parseInt(`${c}`,10);if(!isNaN(u))return 1e3*u;const h=Date.parse(`${c}`);return isNaN(h)?6e4:h-l}(a,r):e===429&&(i.all=r+6e4);return i}function ru(n,e,t=tu(n.bufferSize||64)){let r={};return{send:function(i){const s=[];if(qs(i,(l,u)=>{const h=Js(u);if(function(m,v,_=Date.now()){return function(y,k){return y[k]||y.all||0}(m,v)>_}(r,h)){const m=ra(l,u);n.recordDroppedEvent("ratelimit_backoff",h,m)}else s.push(l)}),s.length===0)return Dt({});const a=En(i[0],s),c=l=>{qs(a,(u,h)=>{const m=ra(u,h);n.recordDroppedEvent(l,Js(h),m)})};return t.add(()=>e({body:Gl(a)}).then(l=>(l.statusCode!==void 0&&(l.statusCode<200||l.statusCode>=300)&&ie&&$.warn(`Sentry responded with status code ${l.statusCode} to sent event.`),r=nu(r,l),l),l=>{throw c("network_error"),l})).then(l=>l,l=>{if(l instanceof Be)return ie&&$.error("Skipped sending event because buffer is full."),c("queue_overflow"),Dt({});throw l})},flush:i=>t.drain(i)}}function ra(n,e){if(e==="event"||e==="transaction")return Array.isArray(n)?n[1]:void 0}const iu=100;function St(n,e){const t=pe(),r=Cn();if(!t)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=iu}=t.getOptions();if(s<=0)return;const a={timestamp:Tn(),...n},c=i?Mn(()=>i(a,e)):a;c!==null&&(t.emit&&t.emit("beforeAddBreadcrumb",c,e),r.addBreadcrumb(c,s))}let ia;const sa=new WeakMap,su=()=>({name:"FunctionToString",setupOnce(){ia=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=ji(this),t=sa.has(pe())&&e!==void 0?e:this;return ia.apply(t,n)}}catch{}},setup(n){sa.set(n,!0)}}),au=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],ou=(n={})=>({name:"InboundFilters",processEvent(e,t,r){const i=r.getOptions(),s=function(a={},c={}){return{allowUrls:[...a.allowUrls||[],...c.allowUrls||[]],denyUrls:[...a.denyUrls||[],...c.denyUrls||[]],ignoreErrors:[...a.ignoreErrors||[],...c.ignoreErrors||[],...a.disableErrorDefaults?[]:au],ignoreTransactions:[...a.ignoreTransactions||[],...c.ignoreTransactions||[]],ignoreInternal:a.ignoreInternal===void 0||a.ignoreInternal}}(n,i);return function(a,c){return c.ignoreInternal&&function(l){try{return l.exception.values[0].type==="SentryError"}catch{}return!1}(a)?(ie&&$.warn(`Event dropped due to being internal Sentry Error.
Event: ${lt(a)}`),!0):function(l,u){return l.type||!u||!u.length?!1:function(h){const m=[];h.message&&m.push(h.message);let v;try{v=h.exception.values[h.exception.values.length-1]}catch{}return v&&v.value&&(m.push(v.value),v.type&&m.push(`${v.type}: ${v.value}`)),m}(l).some(h=>Ln(h,u))}(a,c.ignoreErrors)?(ie&&$.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${lt(a)}`),!0):function(l){return l.type||!l.exception||!l.exception.values||l.exception.values.length===0?!1:!l.message&&!l.exception.values.some(u=>u.stacktrace||u.type&&u.type!=="Error"||u.value)}(a)?(ie&&$.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${lt(a)}`),!0):function(l,u){if(l.type!=="transaction"||!u||!u.length)return!1;const h=l.transaction;return!!h&&Ln(h,u)}(a,c.ignoreTransactions)?(ie&&$.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${lt(a)}`),!0):function(l,u){if(!u||!u.length)return!1;const h=Bn(l);return!!h&&Ln(h,u)}(a,c.denyUrls)?(ie&&$.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${lt(a)}.
Url: ${Bn(a)}`),!0):function(l,u){if(!u||!u.length)return!0;const h=Bn(l);return!h||Ln(h,u)}(a,c.allowUrls)?!1:(ie&&$.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${lt(a)}.
Url: ${Bn(a)}`),!0)}(e,s)?null:e}});function Bn(n){try{let e;try{e=n.exception.values[0].stacktrace.frames}catch{}return e?function(t=[]){for(let r=t.length-1;r>=0;r--){const i=t[r];if(i&&i.filename!=="<anonymous>"&&i.filename!=="[native code]")return i.filename||null}return null}(e):null}catch{return ie&&$.error(`Cannot extract url for event ${lt(n)}`),null}}function cu(n,e,t=250,r,i,s,a){if(!(s.exception&&s.exception.values&&a&&Lt(a.originalException,Error)))return;const c=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;var l,u;c&&(s.exception.values=(l=pi(n,e,i,a.originalException,r,s.exception.values,c,0),u=t,l.map(h=>(h.value&&(h.value=zt(h.value,u)),h))))}function pi(n,e,t,r,i,s,a,c){if(s.length>=t+1)return s;let l=[...s];if(Lt(r[i],Error)){aa(a,c);const u=n(e,r[i]),h=l.length;oa(u,i,h,c),l=pi(n,e,t,r[i],i,[u,...l],u,h)}return Array.isArray(r.errors)&&r.errors.forEach((u,h)=>{if(Lt(u,Error)){aa(a,c);const m=n(e,u),v=l.length;oa(m,`errors[${h}]`,v,c),l=pi(n,e,t,u,i,[m,...l],m,v)}}),l}function aa(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function oa(n,e,t,r){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:t,parent_id:r}}function Lr(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const t=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:t,hash:r,relative:e[5]+t+r}}function lu(){"console"in Y&&si.forEach(function(n){n in Y.console&&Me(Y.console,n,function(e){return sr[n]=e,function(...t){Ve("console",{args:t,level:n});const r=sr[n];r&&r.apply(Y.console,t)}})})}function uu(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const du=()=>{let n;return{name:"Dedupe",processEvent(e){if(e.type)return e;try{if(function(t,r){return r?!!(function(i,s){const a=i.message,c=s.message;return!(!a&&!c||a&&!c||!a&&c||a!==c||!la(i,s)||!ca(i,s))}(t,r)||function(i,s){const a=ua(s),c=ua(i);return!(!a||!c||a.type!==c.type||a.value!==c.value||!la(i,s)||!ca(i,s))}(t,r)):!1}(e,n))return ie&&$.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return n=e}}};function ca(n,e){let t=Os(n),r=Os(e);if(!t&&!r)return!0;if(t&&!r||!t&&r||r.length!==t.length)return!1;for(let i=0;i<r.length;i++){const s=r[i],a=t[i];if(s.filename!==a.filename||s.lineno!==a.lineno||s.colno!==a.colno||s.function!==a.function)return!1}return!0}function la(n,e){let t=n.fingerprint,r=e.fingerprint;if(!t&&!r)return!0;if(t&&!r||!t&&r)return!1;try{return t.join("")===r.join("")}catch{return!1}}function ua(n){return n.exception&&n.exception.values&&n.exception.values[0]}function da(n){return n===void 0?void 0:n>=400&&n<500?"warning":n>=500?"error":void 0}const Rr=Y;function mi(n){return n&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(n.toString())}function fu(){if(typeof EdgeRuntime=="string")return!0;if(!function(){if(!("fetch"in Rr))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}}())return!1;if(mi(Rr.fetch))return!0;let n=!1;const e=Rr.document;if(e&&typeof e.createElement=="function")try{const t=e.createElement("iframe");t.hidden=!0,e.head.appendChild(t),t.contentWindow&&t.contentWindow.fetch&&(n=mi(t.contentWindow.fetch)),e.head.removeChild(t)}catch(t){Ft&&$.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return n}function hu(n,e){const t="fetch";Nt(t,n),xt(t,()=>function(r,i=!1){i&&!fu()||Me(Y,"fetch",function(s){return function(...a){const c=new Error,{method:l,url:u}=function(m){if(m.length===0)return{method:"GET",url:""};if(m.length===2){const[_,y]=m;return{url:fa(_),method:gi(y,"method")?String(y.method).toUpperCase():"GET"}}const v=m[0];return{url:fa(v),method:gi(v,"method")?String(v.method).toUpperCase():"GET"}}(a),h={args:a,fetchData:{method:l,url:u},startTimestamp:1e3*nt(),virtualError:c};return r||Ve("fetch",{...h}),s.apply(Y,a).then(async m=>(r?r(m):Ve("fetch",{...h,endTimestamp:1e3*nt(),response:m}),m),m=>{throw Ve("fetch",{...h,endTimestamp:1e3*nt(),error:m}),Ri(m)&&m.stack===void 0&&(m.stack=c.stack,Rt(m,"framesToPop",1)),m})}})}(void 0,e))}function gi(n,e){return!!n&&typeof n=="object"&&!!n[e]}function fa(n){return typeof n=="string"?n:n?gi(n,"url")?n.url:n.toString?n.toString():"":""}const jn=Y,ue=Y;let vi=0;function ha(){return vi>0}function Zt(n,e={}){if(!function(r){return typeof r=="function"}(n))return n;try{const r=n.__sentry_wrapped__;if(r)return typeof r=="function"?r:n;if(ji(n))return n}catch{return n}const t=function(...r){try{const i=r.map(s=>Zt(s,e));return n.apply(this,i)}catch(i){throw vi++,setTimeout(()=>{vi--}),function(...s){const a=$i(Sr());if(s.length===2){const[c,l]=s;return c?a.withSetScope(c,l):a.withScope(l)}a.withScope(s[0])}(s=>{var a;s.addEventProcessor(c=>(e.mechanism&&(ci(c,void 0),Ht(c,e.mechanism)),c.extra={...c.extra,arguments:r},c)),a=i,$t().captureException(a,void 0)}),i}};try{for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}catch{}Qo(t,n),Rt(n,"__sentry_wrapped__",t);try{Object.getOwnPropertyDescriptor(t,"name").configurable&&Object.defineProperty(t,"name",{get:()=>n.name})}catch{}return t}const Cr=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Wi(n,e){const t=qi(n,e),r={type:gu(e),value:vu(e)};return t.length&&(r.stacktrace={frames:t}),r.type===void 0&&r.value===""&&(r.value="Unrecoverable error caught"),r}function pu(n,e,t,r){const i=pe(),s=i&&i.getOptions().normalizeDepth,a=function(u){for(const h in u)if(Object.prototype.hasOwnProperty.call(u,h)){const m=u[h];if(m instanceof Error)return m}}(e),c={__serialized__:ec(e,s)};if(a)return{exception:{values:[Wi(n,a)]},extra:c};const l={exception:{values:[{type:Er(e)?e.constructor.name:r?"UnhandledRejection":"Error",value:yu(e,{isUnhandledRejection:r})}]},extra:c};if(t){const u=qi(n,t);u.length&&(l.exception.values[0].stacktrace={frames:u})}return l}function Dr(n,e){return{exception:{values:[Wi(n,e)]}}}function qi(n,e){const t=e.stacktrace||e.stack||"",r=function(s){return s&&mu.test(s.message)?1:0}(e),i=function(s){return typeof s.framesToPop=="number"?s.framesToPop:0}(e);try{return n(t,r,i)}catch{}return[]}const mu=/Minified React error #\d+;/i;function ic(n){return typeof WebAssembly<"u"&&WebAssembly.Exception!==void 0&&n instanceof WebAssembly.Exception}function gu(n){const e=n&&n.name;return!e&&ic(n)?n.message&&Array.isArray(n.message)&&n.message.length==2?n.message[0]:"WebAssembly.Exception":e}function vu(n){const e=n&&n.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:ic(n)&&Array.isArray(n.message)&&n.message.length==2?n.message[1]:e:"No error message"}function yi(n,e,t,r,i){let s;if(zo(e)&&e.error)return Dr(n,e.error);if(Ps(e)||rn(e,"DOMException")){const a=e;if("stack"in e)s=Dr(n,e);else{const c=a.name||(Ps(a)?"DOMError":"DOMException"),l=a.message?`${c}: ${a.message}`:c;s=bi(n,l,t,r),ci(s,l)}return"code"in a&&(s.tags={...s.tags,"DOMException.code":`${a.code}`}),s}return Ri(e)?Dr(n,e):Qt(e)||Er(e)?(s=pu(n,e,t,i),Ht(s,{synthetic:!0}),s):(s=bi(n,e,t,r),ci(s,`${e}`),Ht(s,{synthetic:!0}),s)}function bi(n,e,t,r){const i={};if(r&&t){const s=qi(n,t);s.length&&(i.exception={values:[{value:e,stacktrace:{frames:s}}]}),Ht(i,{synthetic:!0})}if(Di(e)){const{__sentry_template_string__:s,__sentry_template_values__:a}=e;return i.logentry={message:s,params:a},i}return i.message=e,i}function yu(n,{isUnhandledRejection:e}){const t=function(i,s=40){const a=Object.keys(Ho(i));a.sort();const c=a[0];if(!c)return"[object has no keys]";if(c.length>=s)return zt(c,s);for(let l=a.length;l>0;l--){const u=a.slice(0,l).join(", ");if(!(u.length>s))return l===a.length?u:zt(u,s)}return""}(n),r=e?"promise rejection":"exception";return zo(n)?`Event \`ErrorEvent\` captured as ${r} with message \`${n.message}\``:Er(n)?`Event \`${function(i){try{const s=Object.getPrototypeOf(i);return s?s.constructor.name:void 0}catch{}}(n)}\` (type=${n.type}) captured as ${r}`:`Object captured as ${r} with keys: ${t}`}class bu extends eu{constructor(e){const t={parentSpanIsAlwaysRootSpan:!0,...e};(function(r,i,s=[i],a="npm"){const c=r._metadata||{};c.sdk||(c.sdk={name:`sentry.javascript.${i}`,packages:s.map(l=>({name:`${a}:@sentry/${l}`,version:It})),version:It}),r._metadata=c})(t,"browser",["browser"],ue.SENTRY_SDK_SOURCE||"npm"),super(t),t.sendClientReports&&ue.document&&ue.document.addEventListener("visibilitychange",()=>{ue.document.visibilityState==="hidden"&&this._flushOutcomes()})}eventFromException(e,t){return function(r,i,s,a){const c=yi(r,i,s&&s.syntheticException||void 0,a);return Ht(c),c.level="error",s&&s.event_id&&(c.event_id=s.event_id),Dt(c)}(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",r){return function(i,s,a="info",c,l){const u=bi(i,s,c&&c.syntheticException||void 0,l);return u.level=a,c&&c.event_id&&(u.event_id=c.event_id),Dt(u)}(this._options.stackParser,e,t,r,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(Cr&&$.warn("SDK not enabled, will not capture user feedback."));const t=function(r,{metadata:i,tunnel:s,dsn:a}){const c={event_id:r.event_id,sent_at:new Date().toISOString(),...i&&i.sdk&&{sdk:{name:i.sdk.name,version:i.sdk.version}},...!!s&&!!a&&{dsn:or(a)}};return En(c,[function(u){return[{type:"user_report"},u]}(r)])}(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(t)}_prepareEvent(e,t,r){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,r)}}const _u=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,_e=Y;let pa,Br,jr,Fn;function wu(){if(!_e.document)return;const n=Ve.bind(null,"dom"),e=ma(n,!0);_e.document.addEventListener("click",e,!1),_e.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach(t=>{const r=_e[t],i=r&&r.prototype;i&&i.hasOwnProperty&&i.hasOwnProperty("addEventListener")&&(Me(i,"addEventListener",function(s){return function(a,c,l){if(a==="click"||a=="keypress")try{const u=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},h=u[a]=u[a]||{refCount:0};if(!h.handler){const m=ma(n);h.handler=m,s.call(this,a,m,l)}h.refCount++}catch{}return s.call(this,a,c,l)}}),Me(i,"removeEventListener",function(s){return function(a,c,l){if(a==="click"||a=="keypress")try{const u=this.__sentry_instrumentation_handlers__||{},h=u[a];h&&(h.refCount--,h.refCount<=0&&(s.call(this,a,h.handler,l),h.handler=void 0,delete u[a]),Object.keys(u).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return s.call(this,a,c,l)}}))})}function ma(n,e=!1){return t=>{if(!t||t._sentryCaptured)return;const r=function(s){try{return s.target}catch{return null}}(t);if(function(s,a){return s==="keypress"&&(!a||!a.tagName||a.tagName!=="INPUT"&&a.tagName!=="TEXTAREA"&&!a.isContentEditable)}(t.type,r))return;Rt(t,"_sentryCaptured",!0),r&&!r._sentryId&&Rt(r,"_sentryId",Ie());const i=t.type==="keypress"?"input":t.type;(function(s){if(s.type!==Br)return!1;try{if(!s.target||s.target._sentryId!==jr)return!1}catch{}return!0})(t)||(n({event:t,name:i,global:e}),Br=t.type,jr=r?r._sentryId:void 0),clearTimeout(pa),pa=_e.setTimeout(()=>{jr=void 0,Br=void 0},1e3)}}function sc(n){const e="history";Nt(e,n),xt(e,ku)}function ku(){if(!function(){const t=jn.chrome,r=t&&t.app&&t.app.runtime,i="history"in jn&&!!jn.history.pushState&&!!jn.history.replaceState;return!r&&i}())return;const n=_e.onpopstate;function e(t){return function(...r){const i=r.length>2?r[2]:void 0;if(i){const s=Fn,a=String(i);Fn=a,Ve("history",{from:s,to:a})}return t.apply(this,r)}}_e.onpopstate=function(...t){const r=_e.location.href,i=Fn;if(Fn=r,Ve("history",{from:i,to:r}),n)try{return n.apply(this,t)}catch{}},Me(_e.history,"pushState",e),Me(_e.history,"replaceState",e)}const Yn={};function ga(n){Yn[n]=void 0}const yn="__sentry_xhr_v3__";function Su(){if(!_e.XMLHttpRequest)return;const n=XMLHttpRequest.prototype;n.open=new Proxy(n.open,{apply(e,t,r){const i=new Error,s=1e3*nt(),a=et(r[0])?r[0].toUpperCase():void 0,c=function(u){if(et(u))return u;try{return u.toString()}catch{}}(r[1]);if(!a||!c)return e.apply(t,r);t[yn]={method:a,url:c,request_headers:{}},a==="POST"&&c.match(/sentry_key/)&&(t.__sentry_own_request__=!0);const l=()=>{const u=t[yn];if(u&&t.readyState===4){try{u.status_code=t.status}catch{}Ve("xhr",{endTimestamp:1e3*nt(),startTimestamp:s,xhr:t,virtualError:i})}};return"onreadystatechange"in t&&typeof t.onreadystatechange=="function"?t.onreadystatechange=new Proxy(t.onreadystatechange,{apply:(u,h,m)=>(l(),u.apply(h,m))}):t.addEventListener("readystatechange",l),t.setRequestHeader=new Proxy(t.setRequestHeader,{apply(u,h,m){const[v,_]=m,y=h[yn];return y&&et(v)&&et(_)&&(y.request_headers[v.toLowerCase()]=_),u.apply(h,m)}}),e.apply(t,r)}}),n.send=new Proxy(n.send,{apply(e,t,r){const i=t[yn];return i?(r[0]!==void 0&&(i.body=r[0]),Ve("xhr",{startTimestamp:1e3*nt(),xhr:t}),e.apply(t,r)):e.apply(t,r)}})}function Eu(n,e=function(t){const r=Yn[t];if(r)return r;let i=_e[t];if(mi(i))return Yn[t]=i.bind(_e);const s=_e.document;if(s&&typeof s.createElement=="function")try{const a=s.createElement("iframe");a.hidden=!0,s.head.appendChild(a);const c=a.contentWindow;c&&c[t]&&(i=c[t]),s.head.removeChild(a)}catch(a){_u&&$.warn(`Could not create sandbox iframe for ${t} check, bailing to window.${t}: `,a)}return i&&(Yn[t]=i.bind(_e))}("fetch")){let t=0,r=0;return ru(n,function(i){const s=i.body.length;t+=s,r++;const a={body:i.body,method:"POST",referrerPolicy:"origin",headers:n.headers,keepalive:t<=6e4&&r<15,...n.fetchOptions};if(!e)return ga("fetch"),ar("No fetch implementation available");try{return e(n.url,a).then(c=>(t-=s,r--,{statusCode:c.status,headers:{"x-sentry-rate-limits":c.headers.get("X-Sentry-Rate-Limits"),"retry-after":c.headers.get("Retry-After")}}))}catch(c){return ga("fetch"),t-=s,r--,ar(c)}})}function Fr(n,e,t,r){const i={filename:n,function:e==="<anonymous>"?Pt:e,in_app:!0};return t!==void 0&&(i.lineno=t),r!==void 0&&(i.colno=r),i}const Mu=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Tu=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Cu=/\((\S*)(?::(\d+))(?::(\d+))\)/,Ou=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Au=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Pu=function(...n){const e=n.sort((t,r)=>t[0]-r[0]).map(t=>t[1]);return(t,r=0,i=0)=>{const s=[],a=t.split(`
`);for(let c=r;c<a.length;c++){const l=a[c];if(l.length>1024)continue;const u=Ms.test(l)?l.replace(Ms,"$1"):l;if(!u.match(/\S*Error: /)){for(const h of e){const m=h(u);if(m){s.push(m);break}}if(s.length>=50+i)break}}return function(c){if(!c.length)return[];const l=Array.from(c);return/sentryWrapped/.test(xn(l).function||"")&&l.pop(),l.reverse(),Ts.test(xn(l).function||"")&&(l.pop(),Ts.test(xn(l).function||"")&&l.pop()),l.slice(0,50).map(u=>({...u,filename:u.filename||xn(l).filename,function:u.function||Pt}))}(s.slice(i))}}([30,n=>{const e=Mu.exec(n);if(e){const[,r,i,s]=e;return Fr(r,Pt,+i,+s)}const t=Tu.exec(n);if(t){if(t[2]&&t[2].indexOf("eval")===0){const s=Cu.exec(t[2]);s&&(t[2]=s[1],t[3]=s[2],t[4]=s[3])}const[r,i]=va(t[1]||Pt,t[2]);return Fr(i,r,t[3]?+t[3]:void 0,t[4]?+t[4]:void 0)}}],[50,n=>{const e=Ou.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const i=Au.exec(e[3]);i&&(e[1]=e[1]||"eval",e[3]=i[1],e[4]=i[2],e[5]="")}let t=e[3],r=e[1]||Pt;return[r,t]=va(r,t),Fr(t,r,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]),va=(n,e)=>{const t=n.indexOf("safari-extension")!==-1,r=n.indexOf("safari-web-extension")!==-1;return t||r?[n.indexOf("@")!==-1?n.split("@")[0]:Pt,t?`safari-extension:${e}`:`safari-web-extension:${e}`]:[n,e]},ya=1024,Iu=(n={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...n};return{name:"Breadcrumbs",setup(t){var r;e.console&&function(i){const s="console";Nt(s,i),xt(s,lu)}(function(i){return function(s){if(pe()!==i)return;const a={category:"console",data:{arguments:s.args,logger:"console"},level:uu(s.level),message:Is(s.args," ")};if(s.level==="assert"){if(s.args[0]!==!1)return;a.message=`Assertion failed: ${Is(s.args.slice(1)," ")||"console.assert"}`,a.data.arguments=s.args.slice(1)}St(a,{input:s.args,level:s.level})}}(t)),e.dom&&(r=function(i,s){return function(a){if(pe()!==i)return;let c,l,u=typeof s=="object"?s.serializeAttribute:void 0,h=typeof s=="object"&&typeof s.maxStringLength=="number"?s.maxStringLength:void 0;h&&h>ya&&(Cr&&$.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${h} was configured. Sentry will use 1024 instead.`),h=ya),typeof u=="string"&&(u=[u]);try{const v=a.event,_=function(y){return!!y&&!!y.target}(v)?v.target:v;c=Ko(_,{keyAttrs:u,maxStringLength:h}),l=function(y){if(!Bi.HTMLElement)return null;let k=y;for(let P=0;P<5;P++){if(!k)return null;if(k instanceof HTMLElement){if(k.dataset.sentryComponent)return k.dataset.sentryComponent;if(k.dataset.sentryElement)return k.dataset.sentryElement}k=k.parentNode}return null}(_)}catch{c="<unknown>"}if(c.length===0)return;const m={category:`ui.${a.name}`,message:c};l&&(m.data={"ui.component_name":l}),St(m,{event:a.event,name:a.name,global:a.global})}}(t,e.dom),Nt("dom",r),xt("dom",wu)),e.xhr&&function(i){Nt("xhr",i),xt("xhr",Su)}(function(i){return function(s){if(pe()!==i)return;const{startTimestamp:a,endTimestamp:c}=s,l=s.xhr[yn];if(!a||!c||!l)return;const{method:u,url:h,status_code:m,body:v}=l,_={method:u,url:h,status_code:m},y={xhr:s.xhr,input:v,startTimestamp:a,endTimestamp:c};St({category:"xhr",data:_,type:"http",level:da(m)},y)}}(t)),e.fetch&&hu(function(i){return function(s){if(pe()!==i)return;const{startTimestamp:a,endTimestamp:c}=s;if(c&&(!s.fetchData.url.match(/sentry_key/)||s.fetchData.method!=="POST"))if(s.error)St({category:"fetch",data:s.fetchData,level:"error",type:"http"},{data:s.error,input:s.args,startTimestamp:a,endTimestamp:c});else{const l=s.response,u={...s.fetchData,status_code:l&&l.status},h={input:s.args,response:l,startTimestamp:a,endTimestamp:c};St({category:"fetch",data:u,type:"http",level:da(u.status_code)},h)}}}(t)),e.history&&sc(function(i){return function(s){if(pe()!==i)return;let a=s.from,c=s.to;const l=Lr(ue.location.href);let u=a?Lr(a):void 0;const h=Lr(c);u&&u.path||(u=l),l.protocol===h.protocol&&l.host===h.host&&(c=h.relative),l.protocol===u.protocol&&l.host===u.host&&(a=u.relative),St({category:"navigation",data:{from:a,to:c}})}}(t)),e.sentry&&t.on("beforeSendEvent",function(i){return function(s){pe()===i&&St({category:"sentry."+(s.type==="transaction"?"transaction":"event"),event_id:s.event_id,level:s.level,message:lt(s)},{event:s})}}(t))}}},Nu=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],xu=(n={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...n};return{name:"BrowserApiErrors",setupOnce(){e.setTimeout&&Me(ue,"setTimeout",ba),e.setInterval&&Me(ue,"setInterval",ba),e.requestAnimationFrame&&Me(ue,"requestAnimationFrame",Lu),e.XMLHttpRequest&&"XMLHttpRequest"in ue&&Me(XMLHttpRequest.prototype,"send",Ru);const t=e.eventTarget;t&&(Array.isArray(t)?t:Nu).forEach(Du)}}};function ba(n){return function(...e){const t=e[0];return e[0]=Zt(t,{mechanism:{data:{function:ht(n)},handled:!1,type:"instrument"}}),n.apply(this,e)}}function Lu(n){return function(e){return n.apply(this,[Zt(e,{mechanism:{data:{function:"requestAnimationFrame",handler:ht(n)},handled:!1,type:"instrument"}})])}}function Ru(n){return function(...e){const t=this;return["onload","onerror","onprogress","onreadystatechange"].forEach(r=>{r in t&&typeof t[r]=="function"&&Me(t,r,function(i){const s={mechanism:{data:{function:r,handler:ht(i)},handled:!1,type:"instrument"}},a=ji(i);return a&&(s.mechanism.data.handler=ht(a)),Zt(i,s)})}),n.apply(this,e)}}function Du(n){const e=ue[n],t=e&&e.prototype;t&&t.hasOwnProperty&&t.hasOwnProperty("addEventListener")&&(Me(t,"addEventListener",function(r){return function(i,s,a){try{typeof s.handleEvent=="function"&&(s.handleEvent=Zt(s.handleEvent,{mechanism:{data:{function:"handleEvent",handler:ht(s),target:n},handled:!1,type:"instrument"}}))}catch{}return r.apply(this,[i,Zt(s,{mechanism:{data:{function:"addEventListener",handler:ht(s),target:n},handled:!1,type:"instrument"}}),a])}}),Me(t,"removeEventListener",function(r){return function(i,s,a){try{const c=s.__sentry_wrapped__;c&&r.call(this,i,c,a)}catch{}return r.call(this,i,s,a)}}))}const Bu=()=>({name:"BrowserSession",setupOnce(){ue.document!==void 0?(Qs({ignoreDuration:!0}),Hs(),sc(({from:n,to:e})=>{n!==void 0&&n!==e&&(Qs({ignoreDuration:!0}),Hs())})):Cr&&$.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.")}}),ju=(n={})=>{const e={onerror:!0,onunhandledrejection:!0,...n};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(t){e.onerror&&(function(r){(function(i){const s="error";Nt(s,i),xt(s,Ol)})(i=>{const{stackParser:s,attachStacktrace:a}=wa();if(pe()!==r||ha())return;const{msg:c,url:l,line:u,column:h,error:m}=i,v=function(_,y,k,P){const N=_.exception=_.exception||{},B=N.values=N.values||[],D=B[0]=B[0]||{},T=D.stacktrace=D.stacktrace||{},w=T.frames=T.frames||[],C=P,I=k,x=et(y)&&y.length>0?y:function(){try{return Bi.document.location.href}catch{return""}}();return w.length===0&&w.push({colno:C,filename:x,function:Pt,in_app:!0,lineno:I}),_}(yi(s,m||c,void 0,a,!1),l,u,h);v.level="error",Ks(v,{originalException:m,mechanism:{handled:!1,type:"onerror"}})})}(t),_a("onerror")),e.onunhandledrejection&&(function(r){(function(i){const s="unhandledrejection";Nt(s,i),xt(s,Al)})(i=>{const{stackParser:s,attachStacktrace:a}=wa();if(pe()!==r||ha())return;const c=function(u){if(ai(u))return u;try{if("reason"in u)return u.reason;if("detail"in u&&"reason"in u.detail)return u.detail.reason}catch{}return u}(i),l=ai(c)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(c)}`}]}}:yi(s,c,void 0,a,!0);l.level="error",Ks(l,{originalException:c,mechanism:{handled:!1,type:"onunhandledrejection"}})})}(t),_a("onunhandledrejection"))}}};function _a(n){Cr&&$.log(`Global Handler attached: ${n}`)}function wa(){const n=pe();return n&&n.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const Fu=()=>({name:"HttpContext",preprocessEvent(n){if(!ue.navigator&&!ue.location&&!ue.document)return;const e=n.request&&n.request.url||ue.location&&ue.location.href,{referrer:t}=ue.document||{},{userAgent:r}=ue.navigator||{},i={...n.request&&n.request.headers,...t&&{Referer:t},...r&&{"User-Agent":r}},s={...n.request,...e&&{url:e},headers:i};n.request=s}}),$u=(n={})=>{const e=n.limit||5,t=n.key||"cause";return{name:"LinkedErrors",preprocessEvent(r,i,s){const a=s.getOptions();cu(Wi,a.stackParser,a.maxValueLength,t,e,r,i)}}};var ka="new",Sa="loading",Ea="loaded",_i="joining-meeting",At="joined-meeting",Et="left-meeting",rt="error",Uu="playable",$r="unknown",Vu="full",Wu="base",Ma="no-room",qu="end-of-life",Ju="connection-error",zu="iframe-ready-for-launch-config",Gu="iframe-launch-config",Ku="theme-updated",Qu="loading",Hu="load-attempt-failed",Ta="loaded",Xu="started-camera",Yu="camera-error",Zu="joining-meeting",ed="joined-meeting",td="left-meeting",nd="participant-joined",rd="participant-updated",id="participant-left",sd="participant-counts-updated",ad="access-state-updated",od="meeting-session-summary-updated",cd="meeting-session-state-updated",ld="waiting-participant-added",ud="waiting-participant-updated",dd="waiting-participant-removed",fd="track-started",hd="track-stopped",pd="transcription-started",md="transcription-stopped",gd="transcription-error",Ca="recording-started",Oa="recording-stopped",vd="recording-stats",yd="recording-error",bd="recording-upload-completed",_d="recording-data",wd="app-message",kd="transcription-message",Sd="remote-media-player-started",Ed="remote-media-player-updated",Md="remote-media-player-stopped",Td="local-screen-share-started",Cd="local-screen-share-stopped",Od="local-screen-share-canceled",Ad="active-speaker-change",Pd="active-speaker-mode-change",Id="network-quality-change",Nd="network-connection",xd="cpu-load-change",Ld="face-counts-updated",$n="fullscreen",Un="exited-fullscreen",Rd="live-streaming-started",Dd="live-streaming-updated",Bd="live-streaming-stopped",jd="live-streaming-error",Fd="lang-updated",$d="receive-settings-updated",Aa="input-settings-updated",Pa="nonfatal-error",Ia="error",Ur=4096,Na=102400,Vr="iframe-call-message",xa="local-screen-start",La="daily-method-update-live-streaming-endpoints",Vn="transmit-log",tt="daily-custom-track",Zn={NONE:"none",BGBLUR:"background-blur",BGIMAGE:"background-image",FACE_DETECTION:"face-detection"},ac={NONE:"none",NOISE_CANCELLATION:"noise-cancellation"},wi={PLAY:"play",PAUSE:"pause"},Wr=["jpg","png","jpeg"],Ud="add-endpoints",Vd="remove-endpoints",Ra="sip-call-transfer";function Ne(){return!K()&&typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""}function K(){return typeof navigator<"u"&&navigator.product&&navigator.product==="ReactNative"}function oc(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function Wd(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&(function(n,e){if(!n||!e)return!0;switch(n){case"Chrome":return e.major>=75;case"Safari":return RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")&&!(e.major===13&&e.minor===0&&e.point===0);case"Firefox":return e.major>=67}return!0}(Bt(),cr())||K())}function Da(){if(K()||!document)return!1;var n=document.createElement("iframe");return!!n.requestFullscreen||!!n.webkitRequestFullscreen}var ki="none",qd="software",Jd="hardware",zd=function(){try{var n,e=document.createElement("canvas"),t=!1;(n=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0}))||(t=!0,n=e.getContext("webgl2"));var r=n!=null;return e.remove(),r?t?qd:Jd:ki}catch{return ki}}();function cc(){var n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!K()&&zd!==ki&&(n?function(){return ja()?!1:["Chrome","Firefox"].includes(Bt())}():function(){if(ja())return!1;var e=Bt();if(e==="Safari"){var t=zi();if(t.major<15||t.major===15&&t.minor<4)return!1}return e==="Chrome"?Ji().major>=77:e==="Firefox"?Gi().major>=97:["Chrome","Firefox","Safari"].includes(e)}())}function lc(){if(K()||uc()||typeof AudioWorkletNode>"u")return!1;switch(Bt()){case"Chrome":case"Firefox":return!0;case"Safari":var n=cr();return n.major>17||n.major===17&&n.minor>=4}return!1}function Ba(){return oc()&&!function(){var n,e=Bt();if(!Ne())return!0;switch(e){case"Chrome":return(n=Ji()).major&&n.major>0&&n.major<75;case"Firefox":return(n=Gi()).major<91;case"Safari":return(n=zi()).major<13||n.major===13&&n.minor<1;default:return!0}}()}function uc(){return Ne().match(/Linux; Android/)}function ja(){var n,e=Ne(),t=e.match(/Mac/)&&(!K()&&typeof window<"u"&&(n=window)!==null&&n!==void 0&&(n=n.navigator)!==null&&n!==void 0&&n.maxTouchPoints?window.navigator.maxTouchPoints:0)>=5;return!!(e.match(/Mobi/)||e.match(/Android/)||t)||!!Ne().match(/DailyAnd\//)||void 0}function Bt(){if(typeof window<"u"){var n=Ne();return dc()?"Safari":n.indexOf("Edge")>-1?"Edge":n.match(/Chrome\//)?"Chrome":n.indexOf("Safari")>-1||fc()?"Safari":n.indexOf("Firefox")>-1?"Firefox":n.indexOf("MSIE")>-1||n.indexOf(".NET")>-1?"IE":"Unknown Browser"}}function cr(){switch(Bt()){case"Chrome":return Ji();case"Safari":return zi();case"Firefox":return Gi();case"Edge":return function(){var n=0,e=0;if(typeof window<"u"){var t=Ne().match(/Edge\/(\d+).(\d+)/);if(t)try{n=parseInt(t[1]),e=parseInt(t[2])}catch{}}return{major:n,minor:e}}()}}function Ji(){var n=0,e=0,t=0,r=0,i=!1;if(typeof window<"u"){var s=Ne(),a=s.match(/Chrome\/(\d+).(\d+).(\d+).(\d+)/);if(a)try{n=parseInt(a[1]),e=parseInt(a[2]),t=parseInt(a[3]),r=parseInt(a[4]),i=s.indexOf("OPR/")>-1}catch{}}return{major:n,minor:e,build:t,patch:r,opera:i}}function dc(){return!!Ne().match(/iPad|iPhone|iPod/i)&&oc()}function fc(){return Ne().indexOf("AppleWebKit/605.1.15")>-1}function zi(){var n=0,e=0,t=0;if(typeof window<"u"){var r=Ne().match(/Version\/(\d+).(\d+)(.(\d+))?/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2]),t=parseInt(r[4])}catch{}else(dc()||fc())&&(n=14,e=0,t=3)}return{major:n,minor:e,point:t}}function Gi(){var n=0,e=0;if(typeof window<"u"){var t=Ne().match(/Firefox\/(\d+).(\d+)/);if(t)try{n=parseInt(t[1]),e=parseInt(t[2])}catch{}}return{major:n,minor:e}}var hc=function(){return Ce(function n(){Te(this,n)},[{key:"addListenerForMessagesFromCallMachine",value:function(n,e,t){pn()}},{key:"addListenerForMessagesFromDailyJs",value:function(n,e,t){pn()}},{key:"sendMessageToCallMachine",value:function(n,e,t,r){pn()}},{key:"sendMessageToDailyJs",value:function(n,e){pn()}},{key:"removeListener",value:function(n){pn()}}])}();function Fa(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function qr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Fa(Object(t),!0).forEach(function(r){Qe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Fa(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function pc(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pc=function(){return!!n})()}var Gd=function(){function n(){var e,t,r,i;return Te(this,n),t=this,r=We(r=n),(e=_r(t,pc()?Reflect.construct(r,[],We(t).constructor):r.apply(t,i)))._wrappedListeners={},e._messageCallbacks={},e}return wr(n,hc),Ce(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,t,r){var i=this,s=function(a){if(a.data&&a.data.what==="iframe-call-message"&&(!a.data.callClientId||a.data.callClientId===t)&&(!a.data.from||a.data.from!=="module")){var c=qr({},a.data);if(delete c.from,c.callbackStamp&&i._messageCallbacks[c.callbackStamp]){var l=c.callbackStamp;i._messageCallbacks[l].call(r,c),delete i._messageCallbacks[l]}delete c.what,delete c.callbackStamp,e.call(r,c)}};this._wrappedListeners[e]=s,window.addEventListener("message",s)}},{key:"addListenerForMessagesFromDailyJs",value:function(e,t,r){var i=function(s){var a;if(!(!s.data||s.data.what!==Vr||!s.data.action||s.data.from&&s.data.from!=="module"||s.data.callClientId&&t&&s.data.callClientId!==t||s!=null&&(a=s.data)!==null&&a!==void 0&&a.callFrameId)){var c=s.data;e.call(r,c)}};this._wrappedListeners[e]=i,window.addEventListener("message",i)}},{key:"sendMessageToCallMachine",value:function(e,t,r,i){if(!r)throw new Error("undefined callClientId. Are you trying to use a DailyCall instance previously destroyed?");var s=qr({},e);if(s.what=Vr,s.from="module",s.callClientId=r,t){var a=kr();this._messageCallbacks[a]=t,s.callbackStamp=a}var c=i?i.contentWindow:window,l=this._callMachineTargetOrigin(i);l&&c.postMessage(s,l)}},{key:"sendMessageToDailyJs",value:function(e,t){e.what=Vr,e.callClientId=t,e.from="embedded",window.postMessage(e,this._targetOriginFromWindowLocation())}},{key:"removeListener",value:function(e){var t=this._wrappedListeners[e];t&&(window.removeEventListener("message",t),delete this._wrappedListeners[e])}},{key:"forwardPackagedMessageToCallMachine",value:function(e,t,r){var i=qr({},e);i.callClientId=r;var s=t?t.contentWindow:window,a=this._callMachineTargetOrigin(t);a&&s.postMessage(i,a)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(e,t){var r=function(i){if(i.data&&i.data.what==="iframe-call-message"&&(!i.data.callClientId||i.data.callClientId===t)&&(!i.data.from||i.data.from!=="module")){var s=i.data;e(s)}};return this._wrappedListeners[e]=r,window.addEventListener("message",r),e}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(e){var t=this._wrappedListeners[e];t&&(window.removeEventListener("message",t),delete this._wrappedListeners[e])}},{key:"_callMachineTargetOrigin",value:function(e){return e?e.src?new URL(e.src).origin:void 0:this._targetOriginFromWindowLocation()}},{key:"_targetOriginFromWindowLocation",value:function(){return window.location.protocol==="file:"?"*":window.location.origin}}])}();function $a(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function mc(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mc=function(){return!!n})()}var Kd=function(){function n(){var e,t,r,i;return Te(this,n),t=this,r=We(r=n),e=_r(t,mc()?Reflect.construct(r,[],We(t).constructor):r.apply(t,i)),global.callMachineToDailyJsEmitter=global.callMachineToDailyJsEmitter||new ii.EventEmitter,global.dailyJsToCallMachineEmitter=global.dailyJsToCallMachineEmitter||new ii.EventEmitter,e._wrappedListeners={},e._messageCallbacks={},e}return wr(n,hc),Ce(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,t,r){this._addListener(e,global.callMachineToDailyJsEmitter,t,r,"received call machine message")}},{key:"addListenerForMessagesFromDailyJs",value:function(e,t,r){this._addListener(e,global.dailyJsToCallMachineEmitter,t,r,"received daily-js message")}},{key:"sendMessageToCallMachine",value:function(e,t,r){this._sendMessage(e,global.dailyJsToCallMachineEmitter,r,t,"sending message to call machine")}},{key:"sendMessageToDailyJs",value:function(e,t){this._sendMessage(e,global.callMachineToDailyJsEmitter,t,null,"sending message to daily-js")}},{key:"removeListener",value:function(e){var t=this._wrappedListeners[e];t&&(global.callMachineToDailyJsEmitter.removeListener("message",t),global.dailyJsToCallMachineEmitter.removeListener("message",t),delete this._wrappedListeners[e])}},{key:"_addListener",value:function(e,t,r,i,s){var a=this,c=function(l){if(l.callClientId===r){if(l.callbackStamp&&a._messageCallbacks[l.callbackStamp]){var u=l.callbackStamp;a._messageCallbacks[u].call(i,l),delete a._messageCallbacks[u]}e.call(i,l)}};this._wrappedListeners[e]=c,t.addListener("message",c)}},{key:"_sendMessage",value:function(e,t,r,i,s){var a=function(l){for(var u=1;u<arguments.length;u++){var h=arguments[u]!=null?arguments[u]:{};u%2?$a(Object(h),!0).forEach(function(m){Qe(l,m,h[m])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(h)):$a(Object(h)).forEach(function(m){Object.defineProperty(l,m,Object.getOwnPropertyDescriptor(h,m))})}return l}({},e);if(a.callClientId=r,i){var c=kr();this._messageCallbacks[c]=i,a.callbackStamp=c}t.emit("message",a)}}])}(),Si="replace",Ei="shallow-merge",Ua=[Si,Ei],Qd=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.data,r=e.mergeStrategy,i=r===void 0?Si:r;Te(this,n),n._validateMergeStrategy(i),n._validateData(t,i),this.mergeStrategy=i,this.data=t}return Ce(n,[{key:"isNoOp",value:function(){return n.isNoOpUpdate(this.data,this.mergeStrategy)}}],[{key:"isNoOpUpdate",value:function(e,t){return Object.keys(e).length===0&&t===Ei}},{key:"_validateMergeStrategy",value:function(e){if(!Ua.includes(e))throw Error("Unrecognized mergeStrategy provided. Options are: [".concat(Ua,"]"))}},{key:"_validateData",value:function(e,t){if(!function(c){if(c==null||H(c)!=="object")return!1;var l=Object.getPrototypeOf(c);return l==null||l===Object.prototype}(e))throw Error("Meeting session data must be a plain (map-like) object");var r;try{if(r=JSON.stringify(e),t===Si){var i=JSON.parse(r);be(i,e)||console.warn("The meeting session data provided will be modified when serialized.",i,e)}else if(t===Ei){for(var s in e)if(Object.hasOwnProperty.call(e,s)&&e[s]!==void 0){var a=JSON.parse(JSON.stringify(e[s]));be(e[s],a)||console.warn("At least one key in the meeting session data provided will be modified when serialized.",a,e[s])}}}catch(c){throw Error("Meeting session data must be serializable to JSON: ".concat(c))}if(r.length>Na)throw Error("Meeting session data is too large (".concat(r.length," characters). Maximum size suppported is ").concat(Na,"."))}}])}();function gc(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gc=function(){return!!n})()}function Mi(n){var e=typeof Map=="function"?new Map:void 0;return Mi=function(t){if(t===null||!function(i){try{return Function.toString.call(i).indexOf("[native code]")!==-1}catch{return typeof i=="function"}}(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return function(i,s,a){if(gc())return Reflect.construct.apply(null,arguments);var c=[null];c.push.apply(c,s);var l=new(i.bind.apply(i,c));return a&&Sn(l,a.prototype),l}(t,arguments,We(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Sn(r,t)},Mi(n)}function vc(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vc=function(){return!!n})()}function Va(n){var e,t=(e=window._daily)===null||e===void 0?void 0:e.pendings;if(t){var r=t.indexOf(n);r!==-1&&t.splice(r,1)}}var Hd=function(){return Ce(function n(e){Te(this,n),this._currentLoad=null,this._callClientId=e},[{key:"load",value:function(){var n,e=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;if(this.loaded)return window._daily.instances[this._callClientId].callMachine.reset(),void r(!0);n=this._callClientId,window._daily.pendings.push(n),this._currentLoad&&this._currentLoad.cancel(),this._currentLoad=new Xd(t,function(){r(!1)},function(s,a){a||Va(e._callClientId),i(s,a)}),this._currentLoad.start()}},{key:"cancel",value:function(){this._currentLoad&&this._currentLoad.cancel(),Va(this._callClientId)}},{key:"loaded",get:function(){return this._currentLoad&&this._currentLoad.succeeded}}])}(),Xd=function(){return Ce(function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0;Te(this,n),this._attemptsRemaining=3,this._currentAttempt=null,this._dailyConfig=e,this._successCallback=t,this._failureCallback=r},[{key:"start",value:function(){var n=this;if(!this._currentAttempt){var e=function(t){n._currentAttempt.cancelled||(n._attemptsRemaining--,n._failureCallback(t,n._attemptsRemaining>0),n._attemptsRemaining<=0||setTimeout(function(){n._currentAttempt.cancelled||(n._currentAttempt=new Wa(n._dailyConfig,n._successCallback,e),n._currentAttempt.start())},3e3))};this._currentAttempt=new Wa(this._dailyConfig,this._successCallback,e),this._currentAttempt.start()}}},{key:"cancel",value:function(){this._currentAttempt&&this._currentAttempt.cancel()}},{key:"cancelled",get:function(){return this._currentAttempt&&this._currentAttempt.cancelled}},{key:"succeeded",get:function(){return this._currentAttempt&&this._currentAttempt.succeeded}}])}(),Jr=function(){function n(){return Te(this,n),e=this,r=arguments,t=We(t=n),_r(e,vc()?Reflect.construct(t,r||[],We(e).constructor):t.apply(e,r));var e,t,r}return wr(n,Mi(Error)),Ce(n)}(),lr=2e4,Wa=function(){return Ce(function e(t,r,i){Te(this,e),this._loadAttemptImpl=K()||!t.avoidEval?new Yd(t,r,i):new Zd(t,r,i)},[{key:"start",value:(n=j(function*(){return this._loadAttemptImpl.start()}),function(){return n.apply(this,arguments)})},{key:"cancel",value:function(){this._loadAttemptImpl.cancel()}},{key:"cancelled",get:function(){return this._loadAttemptImpl.cancelled}},{key:"succeeded",get:function(){return this._loadAttemptImpl.succeeded}}]);var n}(),Yd=function(){return Ce(function i(s,a,c){Te(this,i),this.cancelled=!1,this.succeeded=!1,this._networkTimedOut=!1,this._networkTimeout=null,this._iosCache=typeof iOSCallObjectBundleCache<"u"&&iOSCallObjectBundleCache,this._refetchHeaders=null,this._dailyConfig=s,this._successCallback=a,this._failureCallback=c},[{key:"start",value:(r=j(function*(){var i=nr(this._dailyConfig);!(yield this._tryLoadFromIOSCache(i))&&this._loadFromNetwork(i)}),function(){return r.apply(this,arguments)})},{key:"cancel",value:function(){clearTimeout(this._networkTimeout),this.cancelled=!0}},{key:"_tryLoadFromIOSCache",value:(t=j(function*(i){if(!this._iosCache)return!1;try{var s=yield this._iosCache.get(i);return!!this.cancelled||!!s&&(s.code?(Function('"use strict";'+s.code)(),this.succeeded=!0,this._successCallback(),!0):(this._refetchHeaders=s.refetchHeaders,!1))}catch{return!1}}),function(i){return t.apply(this,arguments)})},{key:"_loadFromNetwork",value:(e=j(function*(i){var s=this;this._networkTimeout=setTimeout(function(){s._networkTimedOut=!0,s._failureCallback({msg:"Timed out (>".concat(lr," ms) when loading call object bundle ").concat(i),type:"timeout"})},lr);try{var a=this._refetchHeaders?{headers:this._refetchHeaders}:{},c=yield fetch(i,a);if(clearTimeout(this._networkTimeout),this.cancelled||this._networkTimedOut)throw new Jr;var l=yield this._getBundleCodeFromResponse(i,c);if(this.cancelled)throw new Jr;Function('"use strict";'+l)(),this._iosCache&&this._iosCache.set(i,l,c.headers),this.succeeded=!0,this._successCallback()}catch(u){if(clearTimeout(this._networkTimeout),u instanceof Jr||this.cancelled||this._networkTimedOut)return;this._failureCallback({msg:"Failed to load call object bundle ".concat(i,": ").concat(u),type:u.message})}}),function(i){return e.apply(this,arguments)})},{key:"_getBundleCodeFromResponse",value:(n=j(function*(i,s){if(s.ok)return yield s.text();if(this._iosCache&&s.status===304)return(yield this._iosCache.renew(i,s.headers)).code;throw new Error("Received ".concat(s.status," response"))}),function(i,s){return n.apply(this,arguments)})}]);var n,e,t,r}(),Zd=function(){return Ce(function n(e,t,r){Te(this,n),this.cancelled=!1,this.succeeded=!1,this._dailyConfig=e,this._successCallback=t,this._failureCallback=r,this._attemptId=kr(),this._networkTimeout=null,this._scriptElement=null},[{key:"start",value:function(){window._dailyCallMachineLoadWaitlist||(window._dailyCallMachineLoadWaitlist=new Set);var n=nr(this._dailyConfig);(typeof document>"u"?"undefined":H(document))==="object"?this._startLoading(n):this._failureCallback({msg:"Call object bundle must be loaded in a DOM/web context",type:"missing context"})}},{key:"cancel",value:function(){this._stopLoading(),this.cancelled=!0}},{key:"_startLoading",value:function(n){var e=this;this._signUpForCallMachineLoadWaitlist(),this._networkTimeout=setTimeout(function(){e._stopLoading(),e._failureCallback({msg:"Timed out (>".concat(lr," ms) when loading call object bundle ").concat(n),type:"timeout"})},lr);var t=document.getElementsByTagName("head")[0],r=document.createElement("script");this._scriptElement=r,r.onload=function(){e._stopLoading(),e.succeeded=!0,e._successCallback()},r.onerror=function(i){e._stopLoading(),e._failureCallback({msg:"Failed to load call object bundle ".concat(i.target.src),type:i.message})},r.src=n,t.appendChild(r)}},{key:"_stopLoading",value:function(){this._withdrawFromCallMachineLoadWaitlist(),clearTimeout(this._networkTimeout),this._scriptElement&&(this._scriptElement.onload=null,this._scriptElement.onerror=null)}},{key:"_signUpForCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.add(this._attemptId)}},{key:"_withdrawFromCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.delete(this._attemptId)}}])}(),Wn=function(n,e,t){return tf(n.local,e,t)===!0},ef=function(n,e,t){return n.local.streams&&n.local.streams[e]&&n.local.streams[e].stream&&n.local.streams[e].stream["get".concat(t==="video"?"Video":"Audio","Tracks")]()[0]},Wt=function(n,e,t,r){var i=nf(n,e,t,r);return i&&i.pendingTrack},tf=function(n,e,t){if(!n)return!1;var r=function(s){switch(s){case"avatar":return!0;case"staged":return s;default:return!!s}},i=n.public.subscribedTracks;return i&&i[e]?["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo"].indexOf(t)===-1&&i[e].custom?[!0,"staged"].includes(i[e].custom)?r(i[e].custom):r(i[e].custom[t]):r(i[e][t]):!i||r(i.ALL)},nf=function(n,e,t,r){var i=Object.values(n.streams||{}).filter(function(s){return s.participantId===e&&s.type===t&&s.pendingTrack&&s.pendingTrack.kind===r}).sort(function(s,a){return new Date(a.starttime)-new Date(s.starttime)});return i&&i[0]},rf=function(n,e){var t=n.local.public.customTracks;if(t&&t[e])return t[e].track};function qa(n,e){for(var t=e.getState(),r=0,i=["cam","screen"];r<i.length;r++)for(var s=i[r],a=0,c=["video","audio"];a<c.length;a++){var l=c[a],u=s==="cam"?l:"screen".concat(l.charAt(0).toUpperCase()+l.slice(1)),h=n.tracks[u];if(h){var m=n.local?ef(t,s,l):Wt(t,n.session_id,s,l);h.state==="playable"&&(h.track=m),h.persistentTrack=m}}}function Ja(n,e){try{var t=e.getState();for(var r in n.tracks)if(!sf(r)){var i=n.tracks[r].kind;if(i){var s=n.tracks[r];if(s){var a=n.local?rf(t,r):Wt(t,n.session_id,r,i);s.state==="playable"&&(n.tracks[r].track=a),s.persistentTrack=a}}else console.error("unknown type for custom track")}}catch(c){console.error(c)}}function sf(n){return["video","audio","screenVideo","screenAudio"].includes(n)}function za(n,e,t){var r=t.getState();if(n.local){if(n.audio)try{n.audioTrack=r.local.streams.cam.stream.getAudioTracks()[0],n.audioTrack||(n.audio=!1)}catch{}if(n.video)try{n.videoTrack=r.local.streams.cam.stream.getVideoTracks()[0],n.videoTrack||(n.video=!1)}catch{}if(n.screen)try{n.screenVideoTrack=r.local.streams.screen.stream.getVideoTracks()[0],n.screenAudioTrack=r.local.streams.screen.stream.getAudioTracks()[0],n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch{}}else{var i=!0;try{var s=r.participants[n.session_id];s&&s.public&&s.public.rtcType&&s.public.rtcType.impl==="peer-to-peer"&&s.private&&!["connected","completed"].includes(s.private.peeringState)&&(i=!1)}catch(h){console.error(h)}if(!i)return n.audio=!1,n.audioTrack=!1,n.video=!1,n.videoTrack=!1,n.screen=!1,void(n.screenTrack=!1);try{if(r.streams,n.audio&&Wn(r,n.session_id,"cam-audio")){var a=Wt(r,n.session_id,"cam","audio");a&&(e&&e.audioTrack&&e.audioTrack.id===a.id?n.audioTrack=a:a.muted||(n.audioTrack=a)),n.audioTrack||(n.audio=!1)}if(n.video&&Wn(r,n.session_id,"cam-video")){var c=Wt(r,n.session_id,"cam","video");c&&(e&&e.videoTrack&&e.videoTrack.id===c.id?n.videoTrack=c:c.muted||(n.videoTrack=c)),n.videoTrack||(n.video=!1)}if(n.screen&&Wn(r,n.session_id,"screen-audio")){var l=Wt(r,n.session_id,"screen","audio");l&&(e&&e.screenAudioTrack&&e.screenAudioTrack.id===l.id?n.screenAudioTrack=l:l.muted||(n.screenAudioTrack=l))}if(n.screen&&Wn(r,n.session_id,"screen-video")){var u=Wt(r,n.session_id,"screen","video");u&&(e&&e.screenVideoTrack&&e.screenVideoTrack.id===u.id?n.screenVideoTrack=u:u.muted||(n.screenVideoTrack=u))}n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch(h){console.error("unexpected error matching up tracks",h)}}}function af(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(l,u){if(l){if(typeof l=="string")return Ga(l,u);var h={}.toString.call(l).slice(8,-1);return h==="Object"&&l.constructor&&(h=l.constructor.name),h==="Map"||h==="Set"?Array.from(l):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?Ga(l,u):void 0}}(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,c=!1;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return a=l.done,l},e:function(l){c=!0,s=l},f:function(){try{a||t.return==null||t.return()}finally{if(c)throw s}}}}function Ga(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}var Ge=new Map,Gt=null;function of(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(l,u){if(l){if(typeof l=="string")return Ka(l,u);var h={}.toString.call(l).slice(8,-1);return h==="Object"&&l.constructor&&(h=l.constructor.name),h==="Map"||h==="Set"?Array.from(l):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?Ka(l,u):void 0}}(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,c=!1;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return a=l.done,l},e:function(l){c=!0,s=l},f:function(){try{a||t.return==null||t.return()}finally{if(c)throw s}}}}function Ka(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}var Ke=new Map,_n=null;function cf(n){yc()?function(e){Ge.has(e)||(Ge.set(e,{}),navigator.mediaDevices.enumerateDevices().then(function(t){Ge.has(e)&&(Ge.get(e).lastDevicesString=JSON.stringify(t),Gt||(Gt=function(){var r=j(function*(){var i,s=yield navigator.mediaDevices.enumerateDevices(),a=af(Ge.keys());try{for(a.s();!(i=a.n()).done;){var c=i.value,l=JSON.stringify(s);l!==Ge.get(c).lastDevicesString&&(Ge.get(c).lastDevicesString=l,c(s))}}catch(u){a.e(u)}finally{a.f()}});return function(){return r.apply(this,arguments)}}(),navigator.mediaDevices.addEventListener("devicechange",Gt)))}).catch(function(){}))}(n):function(e){Ke.has(e)||(Ke.set(e,{}),navigator.mediaDevices.enumerateDevices().then(function(t){Ke.has(e)&&(Ke.get(e).lastDevicesString=JSON.stringify(t),_n||(_n=setInterval(j(function*(){var r,i=yield navigator.mediaDevices.enumerateDevices(),s=of(Ke.keys());try{for(s.s();!(r=s.n()).done;){var a=r.value,c=JSON.stringify(i);c!==Ke.get(a).lastDevicesString&&(Ke.get(a).lastDevicesString=c,a(i))}}catch(l){s.e(l)}finally{s.f()}}),3e3)))}))}(n)}function lf(n){yc()?function(e){Ge.has(e)&&(Ge.delete(e),Ge.size===0&&Gt&&(navigator.mediaDevices.removeEventListener("devicechange",Gt),Gt=null))}(n):function(e){Ke.has(e)&&(Ke.delete(e),Ke.size===0&&_n&&(clearInterval(_n),_n=null))}(n)}function yc(){var n;return K()||((n=navigator.mediaDevices)===null||n===void 0?void 0:n.ondevicechange)!==void 0}var uf=new Set;function df(n,e){return n&&n.readyState==="live"&&!function(t,r){return t.muted&&!uf.has(t.id)}(n)}function Qa(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function it(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Qa(Object(t),!0).forEach(function(r){Qe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Qa(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}var bn=Object.freeze({VIDEO:"video",AUDIO:"audio",SCREEN_VIDEO:"screenVideo",SCREEN_AUDIO:"screenAudio",CUSTOM_VIDEO:"customVideo",CUSTOM_AUDIO:"customAudio"}),ff=Object.freeze({PARTICIPANTS:"participants",STREAMING:"streaming",TRANSCRIPTION:"transcription"}),wn=Object.values(bn),Ha=["v","a","sv","sa","cv","ca"];Object.freeze(wn.reduce(function(n,e,t){return n[e]=Ha[t],n},{})),Object.freeze(Ha.reduce(function(n,e,t){return n[e]=wn[t],n},{}));var hf=[bn.VIDEO,bn.AUDIO,bn.SCREEN_VIDEO,bn.SCREEN_AUDIO],Xa=Object.values(ff),Ya=["p","s","t"];Object.freeze(Xa.reduce(function(n,e,t){return n[e]=Ya[t],n},{})),Object.freeze(Ya.reduce(function(n,e,t){return n[e]=Xa[t],n},{}));var pf=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.base,r=e.byUserId,i=e.byParticipantId;Te(this,n),this.base=t,this.byUserId=r,this.byParticipantId=i}return Ce(n,[{key:"clone",value:function(){var e=new n;if(this.base instanceof fe?e.base=this.base.clone():e.base=this.base,this.byUserId!==void 0)for(var t in e.byUserId={},this.byUserId){var r=this.byUserId[t];e.byUserId[t]=r instanceof fe?r.clone():r}if(this.byParticipantId!==void 0)for(var i in e.byParticipantId={},this.byParticipantId){var s=this.byParticipantId[i];e.byParticipantId[i]=s instanceof fe?s.clone():s}return e}},{key:"toJSONObject",value:function(){var e={};if(typeof this.base=="boolean"?e.base=this.base:this.base instanceof fe&&(e.base=this.base.toJSONObject()),this.byUserId!==void 0)for(var t in e.byUserId={},this.byUserId){var r=this.byUserId[t];e.byUserId[t]=r instanceof fe?r.toJSONObject():r}if(this.byParticipantId!==void 0)for(var i in e.byParticipantId={},this.byParticipantId){var s=this.byParticipantId[i];e.byParticipantId[i]=s instanceof fe?s.toJSONObject():s}return e}},{key:"toMinifiedJSONObject",value:function(){var e={};if(this.base!==void 0&&(typeof this.base=="boolean"?e.b=this.base:e.b=this.base.toMinifiedJSONObject()),this.byUserId!==void 0)for(var t in e.u={},this.byUserId){var r=this.byUserId[t];e.u[t]=typeof r=="boolean"?r:r.toMinifiedJSONObject()}if(this.byParticipantId!==void 0)for(var i in e.p={},this.byParticipantId){var s=this.byParticipantId[i];e.p[i]=typeof s=="boolean"?s:s.toMinifiedJSONObject()}return e}},{key:"normalize",value:function(){return this.base instanceof fe&&(this.base=this.base.normalize()),this.byUserId&&(this.byUserId=Object.fromEntries(Object.entries(this.byUserId).map(function(e){var t=we(e,2),r=t[0],i=t[1];return[r,i instanceof fe?i.normalize():i]}))),this.byParticipantId&&(this.byParticipantId=Object.fromEntries(Object.entries(this.byParticipantId).map(function(e){var t=we(e,2),r=t[0],i=t[1];return[r,i instanceof fe?i.normalize():i]}))),this}}],[{key:"fromJSONObject",value:function(e){var t,r,i;if(e.base!==void 0&&(t=typeof e.base=="boolean"?e.base:fe.fromJSONObject(e.base)),e.byUserId!==void 0)for(var s in r={},e.byUserId){var a=e.byUserId[s];r[s]=typeof a=="boolean"?a:fe.fromJSONObject(a)}if(e.byParticipantId!==void 0)for(var c in i={},e.byParticipantId){var l=e.byParticipantId[c];i[c]=typeof l=="boolean"?l:fe.fromJSONObject(l)}return new n({base:t,byUserId:r,byParticipantId:i})}},{key:"fromMinifiedJSONObject",value:function(e){var t,r,i;if(e.b!==void 0&&(t=typeof e.b=="boolean"?e.b:fe.fromMinifiedJSONObject(e.b)),e.u!==void 0)for(var s in r={},e.u){var a=e.u[s];r[s]=typeof a=="boolean"?a:fe.fromMinifiedJSONObject(a)}if(e.p!==void 0)for(var c in i={},e.p){var l=e.p[c];i[c]=typeof l=="boolean"?l:fe.fromMinifiedJSONObject(l)}return new n({base:t,byUserId:r,byParticipantId:i})}},{key:"validateJSONObject",value:function(e){if(H(e)!=="object")return[!1,"canReceive must be an object"];for(var t=["base","byUserId","byParticipantId"],r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];if(!t.includes(s))return[!1,"canReceive can only contain keys (".concat(t.join(", "),")")];if(s==="base"){var a=we(fe.validateJSONObject(e.base,!0),2),c=a[0],l=a[1];if(!c)return[!1,l]}else{if(H(e[s])!=="object")return[!1,"invalid (non-object) value for field '".concat(s,"' in canReceive")];for(var u=0,h=Object.values(e[s]);u<h.length;u++){var m=h[u],v=we(fe.validateJSONObject(m),2),_=v[0],y=v[1];if(!_)return[!1,y]}}}return[!0]}}])}(),fe=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.video,r=e.audio,i=e.screenVideo,s=e.screenAudio,a=e.customVideo,c=e.customAudio;Te(this,n),this.video=t,this.audio=r,this.screenVideo=i,this.screenAudio=s,this.customVideo=a,this.customAudio=c}return Ce(n,[{key:"clone",value:function(){var e=new n;return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=it({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=it({},this.customAudio)),e}},{key:"toJSONObject",value:function(){var e={};return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=it({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=it({},this.customAudio)),e}},{key:"toMinifiedJSONObject",value:function(){var e={};return this.video!==void 0&&(e.v=this.video),this.audio!==void 0&&(e.a=this.audio),this.screenVideo!==void 0&&(e.sv=this.screenVideo),this.screenAudio!==void 0&&(e.sa=this.screenAudio),this.customVideo!==void 0&&(e.cv=it({},this.customVideo)),this.customAudio!==void 0&&(e.ca=it({},this.customAudio)),e}},{key:"normalize",value:function(){function e(t,r){return t&&Object.keys(t).length===1&&t["*"]===r}return!(this.video!==!0||this.audio!==!0||this.screenVideo!==!0||this.screenAudio!==!0||!e(this.customVideo,!0)||!e(this.customAudio,!0))||(this.video!==!1||this.audio!==!1||this.screenVideo!==!1||this.screenAudio!==!1||!e(this.customVideo,!1)||!e(this.customAudio,!1))&&this}}],[{key:"fromBoolean",value:function(e){return new n({video:e,audio:e,screenVideo:e,screenAudio:e,customVideo:{"*":e},customAudio:{"*":e}})}},{key:"fromJSONObject",value:function(e){return new n({video:e.video,audio:e.audio,screenVideo:e.screenVideo,screenAudio:e.screenAudio,customVideo:e.customVideo!==void 0?it({},e.customVideo):void 0,customAudio:e.customAudio!==void 0?it({},e.customAudio):void 0})}},{key:"fromMinifiedJSONObject",value:function(e){return new n({video:e.v,audio:e.a,screenVideo:e.sv,screenAudio:e.sa,customVideo:e.cv,customAudio:e.ca})}},{key:"validateJSONObject",value:function(e,t){if(typeof e=="boolean")return[!0];if(H(e)!=="object")return[!1,"invalid (non-object, non-boolean) value in canReceive"];for(var r=Object.keys(e),i=0,s=r;i<s.length;i++){var a=s[i];if(!wn.includes(a))return[!1,"invalid media type '".concat(a,"' in canReceive")];if(hf.includes(a)){if(typeof e[a]!="boolean")return[!1,"invalid (non-boolean) value for media type '".concat(a,"' in canReceive")]}else{if(H(e[a])!=="object")return[!1,"invalid (non-object) value for media type '".concat(a,"' in canReceive")];for(var c=0,l=Object.values(e[a]);c<l.length;c++)if(typeof l[c]!="boolean")return[!1,"invalid (non-boolean) value for entry within '".concat(a,"' in canReceive")];if(t&&e[a]["*"]===void 0)return[!1,`canReceive "base" permission must specify "*" as an entry within '`.concat(a,"'")]}}return t&&r.length!==wn.length?[!1,'canReceive "base" permission must specify all media types: '.concat(wn.join(", ")," (or be set to a boolean shorthand)")]:[!0]}}])}(),mf=["result"],gf=["preserveIframe"];function Za(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function R(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Za(Object(t),!0).forEach(function(r){Qe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Za(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function bc(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(bc=function(){return!!n})()}function eo(n,e){var t=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=function(l,u){if(l){if(typeof l=="string")return to(l,u);var h={}.toString.call(l).slice(8,-1);return h==="Object"&&l.constructor&&(h=l.constructor.name),h==="Map"||h==="Set"?Array.from(l):h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h)?to(l,u):void 0}}(n))||e){t&&(n=t);var r=0,i=function(){};return{s:i,n:function(){return r>=n.length?{done:!0}:{done:!1,value:n[r++]}},e:function(l){throw l},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s,a=!0,c=!1;return{s:function(){t=t.call(n)},n:function(){var l=t.next();return a=l.done,l},e:function(l){c=!0,s=l},f:function(){try{a||t.return==null||t.return()}finally{if(c)throw s}}}}function to(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}var Mt={},no="video",vf="voice",ro=K()?{data:{}}:{data:{},topology:"none"},io={present:0,hidden:0},_c={maxBitrate:{min:1e5,max:25e5},maxFramerate:{min:1,max:30},scaleResolutionDownBy:{min:1,max:8}},zr=Object.keys(_c),so=["state","volume","simulcastEncodings"],ao={androidInCallNotification:{title:"string",subtitle:"string",iconName:"string",disableForCustomOverride:"boolean"},disableAutoDeviceManagement:{audio:"boolean",video:"boolean"}},ur={id:{iconPath:"string",iconPathDarkMode:"string",label:"string",tooltip:"string",visualState:"'default' | 'sidebar-open' | 'active'"}},Ti={id:{allow:"string",controlledBy:"'*' | 'owners' | string[]",csp:"string",iconURL:"string",label:"string",loading:"'eager' | 'lazy'",location:"'main' | 'sidebar'",name:"string",referrerPolicy:"string",sandbox:"string",src:"string",srcdoc:"string",shared:"string[] | 'owners' | boolean"}},Tt={customIntegrations:{validate:Oc,help:Tc()},customTrayButtons:{validate:Cc,help:"customTrayButtons should be a dictionary of the type ".concat(JSON.stringify(ur))},url:{validate:function(n){return typeof n=="string"},help:"url should be a string"},baseUrl:{validate:function(n){return typeof n=="string"},help:"baseUrl should be a string"},token:{validate:function(n){return typeof n=="string"},help:"token should be a string",queryString:"t"},dailyConfig:{validate:function(n,e){try{return e.validateDailyConfig(n),!0}catch(t){console.error("Failed to validate dailyConfig",t)}return!1},help:"Unsupported dailyConfig. Check error logs for detailed info."},reactNativeConfig:{validate:function(n){return Ac(n,ao)},help:"reactNativeConfig should look like ".concat(JSON.stringify(ao),", all fields optional")},lang:{validate:function(n){return["da","de","en-us","en","es","fi","fr","it","jp","ka","nl","no","pl","pt","pt-BR","ru","sv","tr","user"].includes(n)},help:"language not supported. Options are: da, de, en-us, en, es, fi, fr, it, jp, ka, nl, no, pl, pt, pt-BR, ru, sv, tr, user"},userName:!0,userData:{validate:function(n){try{return wc(n),!0}catch(e){return console.error(e),!1}},help:"invalid userData type provided"},startVideoOff:!0,startAudioOff:!0,allowLocalVideo:!0,allowLocalAudio:!0,activeSpeakerMode:!0,showLeaveButton:!0,showLocalVideo:!0,showParticipantsBar:!0,showFullscreenButton:!0,showUserNameChangeUI:!0,iframeStyle:!0,customLayout:!0,cssFile:!0,cssText:!0,bodyClass:!0,videoSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalVideo=n,!0;var t;if(n instanceof MediaStreamTrack)e._sharedTracks.videoTrack=n,t={customTrack:tt};else{if(delete e._sharedTracks.videoTrack,typeof n!="string")return console.error("videoSource must be a MediaStreamTrack, boolean, or a string"),!1;t={deviceId:n}}return e._updatePreloadCacheInputSettings({video:{settings:t}},!1),!0}},audioSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalAudio=n,!0;var t;if(n instanceof MediaStreamTrack)e._sharedTracks.audioTrack=n,t={customTrack:tt};else{if(delete e._sharedTracks.audioTrack,typeof n!="string")return console.error("audioSource must be a MediaStreamTrack, boolean, or a string"),!1;t={deviceId:n}}return e._updatePreloadCacheInputSettings({audio:{settings:t}},!1),!0}},subscribeToTracksAutomatically:{validate:function(n,e){return e._preloadCache.subscribeToTracksAutomatically=n,!0}},theme:{validate:function(n){var e=["accent","accentText","background","backgroundAccent","baseText","border","mainAreaBg","mainAreaBgAccent","mainAreaText","supportiveText"],t=function(r){for(var i=0,s=Object.keys(r);i<s.length;i++){var a=s[i];if(!e.includes(a))return console.error('unsupported color "'.concat(a,'". Valid colors: ').concat(e.join(", "))),!1;if(!r[a].match(/^#[0-9a-f]{6}|#[0-9a-f]{3}$/i))return console.error("".concat(a,' theme color should be provided in valid hex color format. Received: "').concat(r[a],'"')),!1}return!0};return H(n)==="object"&&("light"in n&&"dark"in n||"colors"in n)?"light"in n&&"dark"in n?"colors"in n.light?"colors"in n.dark?t(n.light.colors)&&t(n.dark.colors):(console.error('Dark theme is missing "colors" property.',n),!1):(console.error('Light theme is missing "colors" property.',n),!1):t(n.colors):(console.error('Theme must contain either both "light" and "dark" properties, or "colors".',n),!1)},help:"unsupported theme configuration. Check error logs for detailed info."},layoutConfig:{validate:function(n){if("grid"in n){var e=n.grid;if("maxTilesPerPage"in e){if(!Number.isInteger(e.maxTilesPerPage))return console.error("grid.maxTilesPerPage should be an integer. You passed ".concat(e.maxTilesPerPage,".")),!1;if(e.maxTilesPerPage>49)return console.error("grid.maxTilesPerPage can't be larger than 49 without sacrificing browser performance. Please contact us at https://www.daily.co/contact to talk about your use case."),!1}if("minTilesPerPage"in e){if(!Number.isInteger(e.minTilesPerPage))return console.error("grid.minTilesPerPage should be an integer. You passed ".concat(e.minTilesPerPage,".")),!1;if(e.minTilesPerPage<1)return console.error("grid.minTilesPerPage can't be lower than 1."),!1;if("maxTilesPerPage"in e&&e.minTilesPerPage>e.maxTilesPerPage)return console.error("grid.minTilesPerPage can't be higher than grid.maxTilesPerPage."),!1}}return!0},help:"unsupported layoutConfig. Check error logs for detailed info."},receiveSettings:{validate:function(n){return kc(n,{allowAllParticipantsKey:!1})},help:Mc({allowAllParticipantsKey:!1})},sendSettings:{validate:function(n,e){return!!function(t,r){try{return r.validateUpdateSendSettings(t),!0}catch(i){return console.error("Failed to validate send settings",i),!1}}(n,e)&&(e._preloadCache.sendSettings=n,!0)},help:"Invalid sendSettings provided. Check error logs for detailed info."},inputSettings:{validate:function(n,e){var t;return!!Sc(n)&&(e._inputSettings||(e._inputSettings={}),Ec(n,(t=e.properties)===null||t===void 0?void 0:t.dailyConfig,e._sharedTracks),e._updatePreloadCacheInputSettings(n,!0),!0)},help:Ci()},layout:{validate:function(n){return n==="custom-v1"||n==="browser"||n==="none"},help:'layout may only be set to "custom-v1"',queryString:"layout"},emb:{queryString:"emb"},embHref:{queryString:"embHref"},dailyJsVersion:{queryString:"dailyJsVersion"},proxy:{queryString:"proxy"},strictMode:!0,allowMultipleCallInstances:!0},qn={styles:{validate:function(n){for(var e in n)if(e!=="cam"&&e!=="screen")return!1;if(n.cam){for(var t in n.cam)if(t!=="div"&&t!=="video")return!1}if(n.screen){for(var r in n.screen)if(r!=="div"&&r!=="video")return!1}return!0},help:"styles format should be a subset of: { cam: {div: {}, video: {}}, screen: {div: {}, video: {}} }"},setSubscribedTracks:{validate:function(n,e){if(e._preloadCache.subscribeToTracksAutomatically)return!1;var t=[!0,!1,"staged"];if(t.includes(n)||!K()&&n==="avatar")return!0;var r=["audio","video","screenAudio","screenVideo","rmpAudio","rmpVideo"],i=function(s){var a=arguments.length>1&&arguments[1]!==void 0&&arguments[1];for(var c in s)if(c==="custom"){if(!t.includes(s[c])&&!i(s[c],!0))return!1}else{var l=!a&&!r.includes(c),u=!t.includes(s[c]);if(l||u)return!1}return!0};return i(n)},help:"setSubscribedTracks cannot be used when setSubscribeToTracksAutomatically is enabled, and should be of the form: "+"true".concat(K()?"":" | 'avatar'"," | false | 'staged' | { [audio: true|false|'staged'], [video: true|false|'staged'], [screenAudio: true|false|'staged'], [screenVideo: true|false|'staged'] }")},setAudio:!0,setVideo:!0,setScreenShare:{validate:function(n){return n===!1},help:"setScreenShare must be false, as it's only meant for stopping remote participants' screen shares"},eject:!0,updatePermissions:{validate:function(n){for(var e=0,t=Object.entries(n);e<t.length;e++){var r=we(t[e],2),i=r[0],s=r[1];switch(i){case"hasPresence":if(typeof s!="boolean")return!1;break;case"canSend":if(s instanceof Set||s instanceof Array||Array.isArray(s)){var a,c=["video","audio","screenVideo","screenAudio","customVideo","customAudio"],l=eo(s);try{for(l.s();!(a=l.n()).done;){var u=a.value;if(!c.includes(u))return!1}}catch(N){l.e(N)}finally{l.f()}}else if(typeof s!="boolean")return!1;(s instanceof Array||Array.isArray(s))&&(n.canSend=new Set(s));break;case"canReceive":var h=we(pf.validateJSONObject(s),2),m=h[0],v=h[1];if(!m)return console.error(v),!1;break;case"canAdmin":if(s instanceof Set||s instanceof Array||Array.isArray(s)){var _,y=["participants","streaming","transcription"],k=eo(s);try{for(k.s();!(_=k.n()).done;){var P=_.value;if(!y.includes(P))return!1}}catch(N){k.e(N)}finally{k.f()}}else if(typeof s!="boolean")return!1;(s instanceof Array||Array.isArray(s))&&(n.canAdmin=new Set(s));break;default:return!1}}return!0},help:"updatePermissions can take hasPresence, canSend, canReceive, and canAdmin permissions. hasPresence must be a boolean. canSend can be a boolean or an Array or Set of media types (video, audio, screenVideo, screenAudio, customVideo, customAudio). canReceive must be an object specifying base, byUserId, and/or byParticipantId fields (see documentation for more details). canAdmin can be a boolean or an Array or Set of admin types (participants, streaming, transcription)."}};Promise.any||(Promise.any=function(){var n=j(function*(e){return new Promise(function(t,r){var i=[];e.forEach(function(s){return Promise.resolve(s).then(function(a){t(a)}).catch(function(a){i.push(a),i.length===e.length&&r(i)})})})});return function(e){return n.apply(this,arguments)}}());var oo=function(){function n(o){var f,d,p,g,b,O,A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Te(this,n),p=this,g=We(g=n),Qe(d=_r(p,bc()?Reflect.construct(g,[],We(p).constructor):g.apply(p,b)),"startListeningForDeviceChanges",function(){cf(d.handleDeviceChange)}),Qe(d,"stopListeningForDeviceChanges",function(){lf(d.handleDeviceChange)}),Qe(d,"handleDeviceChange",function(q){q=q.map(function(G){return JSON.parse(JSON.stringify(G))}),d.emitDailyJSEvent({action:"available-devices-updated",availableDevices:q})}),Qe(d,"handleNativeAppStateChange",function(){var q=j(function*(G){if(G==="destroyed")return console.warn("App has been destroyed before leaving the meeting. Cleaning up all the resources!"),void(yield d.destroy());var Je=G==="active";d.disableReactNativeAutoDeviceManagement("video")||(Je?d.camUnmutedBeforeLosingNativeActiveState&&d.setLocalVideo(!0):(d.camUnmutedBeforeLosingNativeActiveState=d.localVideo(),d.camUnmutedBeforeLosingNativeActiveState&&d.setLocalVideo(!1)))});return function(G){return q.apply(this,arguments)}}()),Qe(d,"handleNativeAudioFocusChange",function(q){d.disableReactNativeAutoDeviceManagement("audio")||(d._hasNativeAudioFocus=q,d.toggleParticipantAudioBasedOnNativeAudioFocus(),d._hasNativeAudioFocus?d.micUnmutedBeforeLosingNativeAudioFocus&&d.setLocalAudio(!0):(d.micUnmutedBeforeLosingNativeAudioFocus=d.localAudio(),d.setLocalAudio(!1)))}),Qe(d,"handleNativeSystemScreenCaptureStop",function(){d.stopScreenShare()}),d.strictMode=A.strictMode===void 0||A.strictMode,d.allowMultipleCallInstances=(f=A.allowMultipleCallInstances)!==null&&f!==void 0&&f,Object.keys(Mt).length&&(d._logDuplicateInstanceAttempt(),!d.allowMultipleCallInstances)){if(d.strictMode)throw new Error("Duplicate DailyIframe instances are not allowed");console.warn("Using strictMode: false to allow multiple call instances is now deprecated. Set `allowMultipleCallInstances: true`")}if(window._daily||(window._daily={pendings:[],instances:{}}),d.callClientId=kr(),Mt[(O=d).callClientId]=O,window._daily.instances[d.callClientId]={},d._sharedTracks={},window._daily.instances[d.callClientId].tracks=d._sharedTracks,A.dailyJsVersion=n.version(),d._iframe=o,d._callObjectMode=A.layout==="none"&&!d._iframe,d._preloadCache={subscribeToTracksAutomatically:!0,outputDeviceId:null,inputSettings:null,sendSettings:null,videoTrackForNetworkConnectivityTest:null,videoTrackForConnectionQualityTest:null},A.showLocalVideo!==void 0?d._callObjectMode?console.error("showLocalVideo is not available in call object mode"):d._showLocalVideo=!!A.showLocalVideo:d._showLocalVideo=!0,A.showParticipantsBar!==void 0?d._callObjectMode?console.error("showParticipantsBar is not available in call object mode"):d._showParticipantsBar=!!A.showParticipantsBar:d._showParticipantsBar=!0,A.customIntegrations!==void 0?d._callObjectMode?console.error("customIntegrations is not available in call object mode"):d._customIntegrations=A.customIntegrations:d._customIntegrations={},A.customTrayButtons!==void 0?d._callObjectMode?console.error("customTrayButtons is not available in call object mode"):d._customTrayButtons=A.customTrayButtons:d._customTrayButtons={},A.activeSpeakerMode!==void 0?d._callObjectMode?console.error("activeSpeakerMode is not available in call object mode"):d._activeSpeakerMode=!!A.activeSpeakerMode:d._activeSpeakerMode=!1,A.receiveSettings?d._callObjectMode?d._receiveSettings=A.receiveSettings:console.error("receiveSettings is only available in call object mode"):d._receiveSettings={},d.validateProperties(A),d.properties=R({},A),d._inputSettings||(d._inputSettings={}),d._callObjectLoader=d._callObjectMode?new Hd(d.callClientId):null,d._callState=ka,d._isPreparingToJoin=!1,d._accessState={access:$r},d._meetingSessionSummary={},d._finalSummaryOfPrevSession={},d._meetingSessionState=Qr(ro,d._callObjectMode),d._nativeInCallAudioMode=no,d._participants={},d._isScreenSharing=!1,d._participantCounts=io,d._rmpPlayerState={},d._waitingParticipants={},d._network={threshold:"good",quality:100,networkState:"unknown",stats:{}},d._activeSpeaker={},d._localAudioLevel=0,d._isLocalAudioLevelObserverRunning=!1,d._remoteParticipantsAudioLevel={},d._isRemoteParticipantsAudioLevelObserverRunning=!1,d._maxAppMessageSize=Ur,d._messageChannel=K()?new Kd:new Gd,d._iframe&&(d._iframe.requestFullscreen?d._iframe.addEventListener("fullscreenchange",function(){document.fullscreenElement===d._iframe?(d.emitDailyJSEvent({action:$n}),d.sendMessageToCallMachine({action:$n})):(d.emitDailyJSEvent({action:Un}),d.sendMessageToCallMachine({action:Un}))}):d._iframe.webkitRequestFullscreen&&d._iframe.addEventListener("webkitfullscreenchange",function(){document.webkitFullscreenElement===d._iframe?(d.emitDailyJSEvent({action:$n}),d.sendMessageToCallMachine({action:$n})):(d.emitDailyJSEvent({action:Un}),d.sendMessageToCallMachine({action:Un}))})),K()){var L=d.nativeUtils();L.addAudioFocusChangeListener&&L.removeAudioFocusChangeListener&&L.addAppStateChangeListener&&L.removeAppStateChangeListener&&L.addSystemScreenCaptureStopListener&&L.removeSystemScreenCaptureStopListener||console.warn("expected (add|remove)(AudioFocusChange|AppActiveStateChange|SystemScreenCaptureStop)Listener to be available in React Native"),d._hasNativeAudioFocus=!0,L.addAudioFocusChangeListener(d.handleNativeAudioFocusChange),L.addAppStateChangeListener(d.handleNativeAppStateChange),L.addSystemScreenCaptureStopListener(d.handleNativeSystemScreenCaptureStop)}return d._callObjectMode&&d.startListeningForDeviceChanges(),d._messageChannel.addListenerForMessagesFromCallMachine(d.handleMessageFromCallMachine,d.callClientId,d),d}return wr(n,Nn),Ce(n,[{key:"destroy",value:(ln=j(function*(){var o;try{yield this.leave()}catch{}var f=this._iframe;if(f){var d=f.parentElement;d&&d.removeChild(f)}if(this._messageChannel.removeListener(this.handleMessageFromCallMachine),K()){var p=this.nativeUtils();p.removeAudioFocusChangeListener(this.handleNativeAudioFocusChange),p.removeAppStateChangeListener(this.handleNativeAppStateChange),p.removeSystemScreenCaptureStopListener(this.handleNativeSystemScreenCaptureStop)}this._callObjectMode&&this.stopListeningForDeviceChanges(),this.resetMeetingDependentVars(),this._destroyed=!0,this.emitDailyJSEvent({action:"call-instance-destroyed"}),delete Mt[this.callClientId],!((o=window)===null||o===void 0||(o=o._daily)===null||o===void 0)&&o.instances&&delete window._daily.instances[this.callClientId],this.strictMode&&(this.callClientId=void 0)}),function(){return ln.apply(this,arguments)})},{key:"isDestroyed",value:function(){return!!this._destroyed}},{key:"loadCss",value:function(o){var f=o.bodyClass,d=o.cssFile,p=o.cssText;return J(),this.sendMessageToCallMachine({action:"load-css",cssFile:this.absoluteUrl(d),bodyClass:f,cssText:p}),this}},{key:"iframe",value:function(){return J(),this._iframe}},{key:"meetingState",value:function(){return this._callState}},{key:"accessState",value:function(){return Le(this._callObjectMode,"accessState()"),this._accessState}},{key:"participants",value:function(){return this._participants}},{key:"participantCounts",value:function(){return this._participantCounts}},{key:"waitingParticipants",value:function(){return Le(this._callObjectMode,"waitingParticipants()"),this._waitingParticipants}},{key:"validateParticipantProperties",value:function(o,f){for(var d in f){if(!qn[d])throw new Error("unrecognized updateParticipant property ".concat(d));if(qn[d].validate&&!qn[d].validate(f[d],this,this._participants[o]))throw new Error(qn[d].help)}}},{key:"updateParticipant",value:function(o,f){return this._participants.local&&this._participants.local.session_id===o&&(o="local"),o&&f&&(this.validateParticipantProperties(o,f),this.sendMessageToCallMachine({action:"update-participant",id:o,properties:f})),this}},{key:"updateParticipants",value:function(o){var f=this._participants.local&&this._participants.local.session_id;for(var d in o)d===f&&(d="local"),d&&o[d]&&this.validateParticipantProperties(d,o[d]);return this.sendMessageToCallMachine({action:"update-participants",participants:o}),this}},{key:"updateWaitingParticipant",value:(_t=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Le(this._callObjectMode,"updateWaitingParticipant()"),ne(this._callState,"updateWaitingParticipant()"),typeof f!="string"||H(d)!=="object")throw new Error("updateWaitingParticipant() must take an id string and a updates object");return new Promise(function(p,g){o.sendMessageToCallMachine({action:"daily-method-update-waiting-participant",id:f,updates:d},function(b){b.error&&g(b.error),b.id||g(new Error("unknown error in updateWaitingParticipant()")),p({id:b.id})})})}),function(){return _t.apply(this,arguments)})},{key:"updateWaitingParticipants",value:(cn=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Le(this._callObjectMode,"updateWaitingParticipants()"),ne(this._callState,"updateWaitingParticipants()"),H(f)!=="object")throw new Error("updateWaitingParticipants() must take a mapping between ids and update objects");return new Promise(function(d,p){o.sendMessageToCallMachine({action:"daily-method-update-waiting-participants",updatesById:f},function(g){g.error&&p(g.error),g.ids||p(new Error("unknown error in updateWaitingParticipants()")),d({ids:g.ids})})})}),function(){return cn.apply(this,arguments)})},{key:"requestAccess",value:(bt=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=f.access,p=d===void 0?{level:Vu}:d,g=f.name,b=g===void 0?"":g;return Le(this._callObjectMode,"requestAccess()"),ne(this._callState,"requestAccess()"),new Promise(function(O,A){o.sendMessageToCallMachine({action:"daily-method-request-access",access:p,name:b},function(L){L.error&&A(L.error),L.access||A(new Error("unknown error in requestAccess()")),O({access:L.access,granted:L.granted})})})}),function(){return bt.apply(this,arguments)})},{key:"localAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.audio.state):null}},{key:"localVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.video.state):null}},{key:"setLocalAudio",value:function(o){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"forceDiscardTrack"in f&&(K()?(console.warn("forceDiscardTrack option not supported in React Native; ignoring"),f={}):o&&(console.warn("forceDiscardTrack option only supported when calling setLocalAudio(false); ignoring"),f={})),this.sendMessageToCallMachine({action:"local-audio",state:o,options:f}),this}},{key:"localScreenAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenAudio.state):null}},{key:"localScreenVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenVideo.state):null}},{key:"updateScreenShare",value:function(o){if(this._isScreenSharing)return this.sendMessageToCallMachine({action:"local-screen-update",options:o}),this;console.warn("There is no screen share in progress. Try calling startScreenShare first.")}},{key:"setLocalVideo",value:function(o){return this.sendMessageToCallMachine({action:"local-video",state:o}),this}},{key:"_setAllowLocalAudio",value:function(o){if(this._preloadCache.allowLocalAudio=o,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-audio",state:o}),this}},{key:"_setAllowLocalVideo",value:function(o){if(this._preloadCache.allowLocalVideo=o,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-video",state:o}),this}},{key:"getReceiveSettings",value:(on=j(function*(o){var f=this,d=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).showInheritedValues,p=d!==void 0&&d;if(Le(this._callObjectMode,"getReceiveSettings()"),!this._callMachineInitialized)return this._receiveSettings;switch(H(o)){case"string":return new Promise(function(g){f.sendMessageToCallMachine({action:"get-single-participant-receive-settings",id:o,showInheritedValues:p},function(b){g(b.receiveSettings)})});case"undefined":return this._receiveSettings;default:throw new Error('first argument to getReceiveSettings() must be a participant id (or "base"), or there should be no arguments')}}),function(o){return on.apply(this,arguments)})},{key:"updateReceiveSettings",value:(yt=j(function*(o){var f=this;if(Le(this._callObjectMode,"updateReceiveSettings()"),!kc(o,{allowAllParticipantsKey:!0}))throw new Error(Mc({allowAllParticipantsKey:!0}));return ne(this._callState,"updateReceiveSettings()","To specify receive settings earlier, use the receiveSettings config property."),new Promise(function(d){f.sendMessageToCallMachine({action:"update-receive-settings",receiveSettings:o},function(p){d({receiveSettings:p.receiveSettings})})})}),function(o){return yt.apply(this,arguments)})},{key:"_prepInputSettingsForSharing",value:function(o,f){if(o){var d={};if(o.audio){var p,g,b;o.audio.settings&&(!Object.keys(o.audio.settings).length&&f||(d.audio={settings:R({},o.audio.settings)})),f&&(p=d.audio)!==null&&p!==void 0&&(p=p.settings)!==null&&p!==void 0&&p.customTrack&&(d.audio.settings={customTrack:this._sharedTracks.audioTrack});var O=((g=o.audio.processor)===null||g===void 0?void 0:g.type)==="none"&&((b=o.audio.processor)===null||b===void 0?void 0:b._isDefaultWhenNone);if(o.audio.processor&&!O){var A=R({},o.audio.processor);delete A._isDefaultWhenNone,d.audio=R(R({},d.audio),{},{processor:A})}}if(o.video){var L,q,G;o.video.settings&&(!Object.keys(o.video.settings).length&&f||(d.video={settings:R({},o.video.settings)})),f&&(L=d.video)!==null&&L!==void 0&&(L=L.settings)!==null&&L!==void 0&&L.customTrack&&(d.video.settings={customTrack:this._sharedTracks.videoTrack});var Je=((q=o.video.processor)===null||q===void 0?void 0:q.type)==="none"&&((G=o.video.processor)===null||G===void 0?void 0:G._isDefaultWhenNone);if(o.video.processor&&!Je){var wt=R({},o.video.processor);delete wt._isDefaultWhenNone,d.video=R(R({},d.video),{},{processor:wt})}}return d}}},{key:"getInputSettings",value:function(){var o=this;return J(),new Promise(function(f){f(o._getInputSettings())})}},{key:"_getInputSettings",value:function(){var o,f,d,p,g,b,O={processor:{type:"none",_isDefaultWhenNone:!0}};this._inputSettings?(o=((d=this._inputSettings)===null||d===void 0?void 0:d.video)||O,f=((p=this._inputSettings)===null||p===void 0?void 0:p.audio)||O):(o=((g=this._preloadCache)===null||g===void 0||(g=g.inputSettings)===null||g===void 0?void 0:g.video)||O,f=((b=this._preloadCache)===null||b===void 0||(b=b.inputSettings)===null||b===void 0?void 0:b.audio)||O);var A={audio:f,video:o};return this._prepInputSettingsForSharing(A,!0)}},{key:"_updatePreloadCacheInputSettings",value:function(o,f){var d=this._inputSettings||{},p={};if(o.video){var g,b,O;p.video={},o.video.settings?(p.video.settings={},f||o.video.settings.customTrack||(O=d.video)===null||O===void 0||!O.settings?p.video.settings=o.video.settings:p.video.settings=R(R({},d.video.settings),o.video.settings),Object.keys(p.video.settings).length||delete p.video.settings):(g=d.video)!==null&&g!==void 0&&g.settings&&(p.video.settings=d.video.settings),o.video.processor?p.video.processor=o.video.processor:(b=d.video)!==null&&b!==void 0&&b.processor&&(p.video.processor=d.video.processor)}else d.video&&(p.video=d.video);if(o.audio){var A,L,q;p.audio={},o.audio.settings?(p.audio.settings={},f||o.audio.settings.customTrack||(q=d.audio)===null||q===void 0||!q.settings?p.audio.settings=o.audio.settings:p.audio.settings=R(R({},d.audio.settings),o.audio.settings),Object.keys(p.audio.settings).length||delete p.audio.settings):(A=d.audio)!==null&&A!==void 0&&A.settings&&(p.audio.settings=d.audio.settings),o.audio.processor?p.audio.processor=o.audio.processor:(L=d.audio)!==null&&L!==void 0&&L.processor&&(p.audio.processor=d.audio.processor)}else d.audio&&(p.audio=d.audio);this._maybeUpdateInputSettings(p)}},{key:"_devicesFromInputSettings",value:function(o){var f,d,p=(o==null||(f=o.video)===null||f===void 0||(f=f.settings)===null||f===void 0?void 0:f.deviceId)||null,g=(o==null||(d=o.audio)===null||d===void 0||(d=d.settings)===null||d===void 0?void 0:d.deviceId)||null,b=this._preloadCache.outputDeviceId||null;return{camera:p?{deviceId:p}:{},mic:g?{deviceId:g}:{},speaker:b?{deviceId:b}:{}}}},{key:"updateInputSettings",value:(an=j(function*(o){var f=this;return J(),Sc(o)?o.video||o.audio?(Ec(o,this.properties.dailyConfig,this._sharedTracks),this._callObjectMode&&!this._callMachineInitialized?(this._updatePreloadCacheInputSettings(o,!0),this._getInputSettings()):new Promise(function(d,p){f.sendMessageToCallMachine({action:"update-input-settings",inputSettings:o},function(g){if(g.error)p(g.error);else{if(g.returnPreloadCache)return f._updatePreloadCacheInputSettings(o,!0),void d(f._getInputSettings());f._maybeUpdateInputSettings(g.inputSettings),d(f._prepInputSettingsForSharing(g.inputSettings,!0))}})})):this._getInputSettings():(console.error(Ci()),Promise.reject(Ci()))}),function(o){return an.apply(this,arguments)})},{key:"setBandwidth",value:function(o){var f=o.kbs,d=o.trackConstraints;if(J(),this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-bandwidth",kbs:f,trackConstraints:d}),this}},{key:"getDailyLang",value:function(){var o=this;if(J(),this._callMachineInitialized)return new Promise(function(f){o.sendMessageToCallMachine({action:"get-daily-lang"},function(d){delete d.action,delete d.callbackStamp,f(d)})})}},{key:"setDailyLang",value:function(o){return J(),this.sendMessageToCallMachine({action:"set-daily-lang",lang:o}),this}},{key:"setProxyUrl",value:function(o){return this.sendMessageToCallMachine({action:"set-proxy-url",proxyUrl:o}),this}},{key:"setIceConfig",value:function(o){return this.sendMessageToCallMachine({action:"set-ice-config",iceConfig:o}),this}},{key:"meetingSessionSummary",value:function(){return[Et,rt].includes(this._callState)?this._finalSummaryOfPrevSession:this._meetingSessionSummary}},{key:"getMeetingSession",value:(vt=j(function*(){var o=this;return console.warn("getMeetingSession() is deprecated: use meetingSessionSummary(), which will return immediately"),ne(this._callState,"getMeetingSession()"),new Promise(function(f){o.sendMessageToCallMachine({action:"get-meeting-session"},function(d){delete d.action,delete d.callbackStamp,f(d)})})}),function(){return vt.apply(this,arguments)})},{key:"meetingSessionState",value:function(){return ne(this._callState,"meetingSessionState"),this._meetingSessionState}},{key:"setMeetingSessionData",value:function(o){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"replace";Le(this._callObjectMode,"setMeetingSessionData()"),ne(this._callState,"setMeetingSessionData");try{(function(d,p){new Qd({data:d,mergeStrategy:p})})(o,f)}catch(d){throw console.error(d),d}try{this.sendMessageToCallMachine({action:"set-session-data",data:o,mergeStrategy:f})}catch(d){throw new Error("Error setting meeting session data: ".concat(d))}}},{key:"setUserName",value:function(o,f){var d=this;return this.properties.userName=o,new Promise(function(p){d.sendMessageToCallMachine({action:"set-user-name",name:o??"",thisMeetingOnly:K()||!!f&&!!f.thisMeetingOnly},function(g){delete g.action,delete g.callbackStamp,p(g)})})}},{key:"setUserData",value:(gt=j(function*(o){var f=this;try{wc(o)}catch(d){throw console.error(d),d}if(this.properties.userData=o,this._callMachineInitialized)return new Promise(function(d){try{f.sendMessageToCallMachine({action:"set-user-data",userData:o},function(p){delete p.action,delete p.callbackStamp,d(p)})}catch(p){throw new Error("Error setting user data: ".concat(p))}})}),function(o){return gt.apply(this,arguments)})},{key:"validateAudioLevelInterval",value:function(o){if(o&&(o<100||typeof o!="number"))throw new Error("The interval must be a number greater than or equal to 100 milliseconds.")}},{key:"startLocalAudioLevelObserver",value:function(o){var f=this;if(typeof AudioWorkletNode>"u"&&!K())throw new Error("startLocalAudioLevelObserver() is not supported on this browser");if(this.validateAudioLevelInterval(o),this._callMachineInitialized)return this._isLocalAudioLevelObserverRunning=!0,new Promise(function(d,p){f.sendMessageToCallMachine({action:"start-local-audio-level-observer",interval:o},function(g){f._isLocalAudioLevelObserverRunning=!g.error,g.error?p({error:g.error}):d()})});this._preloadCache.localAudioLevelObserver={enabled:!0,interval:o}}},{key:"isLocalAudioLevelObserverRunning",value:function(){return this._isLocalAudioLevelObserverRunning}},{key:"stopLocalAudioLevelObserver",value:function(){this._preloadCache.localAudioLevelObserver=null,this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-local-audio-level-observer"})}},{key:"startRemoteParticipantsAudioLevelObserver",value:function(o){var f=this;if(this.validateAudioLevelInterval(o),this._callMachineInitialized)return this._isRemoteParticipantsAudioLevelObserverRunning=!0,new Promise(function(d,p){f.sendMessageToCallMachine({action:"start-remote-participants-audio-level-observer",interval:o},function(g){f._isRemoteParticipantsAudioLevelObserverRunning=!g.error,g.error?p({error:g.error}):d()})});this._preloadCache.remoteParticipantsAudioLevelObserver={enabled:!0,interval:o}}},{key:"isRemoteParticipantsAudioLevelObserverRunning",value:function(){return this._isRemoteParticipantsAudioLevelObserverRunning}},{key:"stopRemoteParticipantsAudioLevelObserver",value:function(){this._preloadCache.remoteParticipantsAudioLevelObserver=null,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-remote-participants-audio-level-observer"})}},{key:"startCamera",value:(qe=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Le(this._callObjectMode,"startCamera()"),Gr(this._callState,this._isPreparingToJoin,"startCamera()","Did you mean to use setLocalAudio() and/or setLocalVideo() instead?"),this.needsLoad())try{yield this.load(f)}catch(d){return Promise.reject(d)}else{if(this._didPreAuth){if(f.url&&f.url!==this.properties.url)return console.error("url in startCamera() is different than the one used in preAuth()"),Promise.reject();if(f.token&&f.token!==this.properties.token)return console.error("token in startCamera() is different than the one used in preAuth()"),Promise.reject()}this.validateProperties(f),this.properties=R(R({},this.properties),f)}return new Promise(function(d){o._preloadCache.inputSettings=o._prepInputSettingsForSharing(o._inputSettings,!1),o.sendMessageToCallMachine({action:"start-camera",properties:Ut(o.properties,o.callClientId),preloadCache:Ut(o._preloadCache,o.callClientId)},function(p){d({camera:p.camera,mic:p.mic,speaker:p.speaker})})})}),function(){return qe.apply(this,arguments)})},{key:"validateCustomTrack",value:function(o,f,d){if(d&&d.length>50)throw new Error("Custom track `trackName` must not be more than 50 characters");if(f&&f!=="music"&&f!=="speech"&&!(f instanceof Object))throw new Error("Custom track `mode` must be either `music` | `speech` | `DailyMicAudioModeSettings` or `undefined`");if(d&&["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo","customVideoDefaults"].includes(d))throw new Error("Custom track `trackName` must not match a track name already used by daily: cam-audio, cam-video, customVideoDefaults, screen-video, screen-audio, rmpAudio, rmpVideo");if(!(o instanceof MediaStreamTrack))throw new Error("Custom tracks provided must be instances of MediaStreamTrack")}},{key:"startCustomTrack",value:function(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{track,mode,trackName};return J(),ne(this._callState,"startCustomTrack()"),this.validateCustomTrack(f.track,f.mode,f.trackName),new Promise(function(d,p){o._sharedTracks.customTrack=f.track,f.track=tt,o.sendMessageToCallMachine({action:"start-custom-track",properties:f},function(g){g.error?p({error:g.error}):d(g.mediaTag)})})}},{key:"stopCustomTrack",value:function(o){var f=this;return J(),ne(this._callState,"stopCustomTrack()"),new Promise(function(d){f.sendMessageToCallMachine({action:"stop-custom-track",mediaTag:o},function(p){d(p.mediaTag)})})}},{key:"setCamera",value:function(o){var f=this;return mn(),Jn(this._callMachineInitialized,"setCamera()"),new Promise(function(d){f.sendMessageToCallMachine({action:"set-camera",cameraDeviceId:o},function(p){d({device:p.device})})})}},{key:"setAudioDevice",value:(xe=j(function*(o){return mn(),this.nativeUtils().setAudioDevice(o),{deviceId:yield this.nativeUtils().getAudioDevice()}}),function(o){return xe.apply(this,arguments)})},{key:"cycleCamera",value:function(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise(function(d){o.sendMessageToCallMachine({action:"cycle-camera",properties:f},function(p){d({device:p.device})})})}},{key:"cycleMic",value:function(){var o=this;return J(),new Promise(function(f){o.sendMessageToCallMachine({action:"cycle-mic"},function(d){f({device:d.device})})})}},{key:"getCameraFacingMode",value:function(){var o=this;return mn(),new Promise(function(f){o.sendMessageToCallMachine({action:"get-camera-facing-mode"},function(d){f(d.facingMode)})})}},{key:"setInputDevicesAsync",value:(se=j(function*(o){var f=this,d=o.audioDeviceId,p=o.videoDeviceId,g=o.audioSource,b=o.videoSource;if(J(),g!==void 0&&(d=g),b!==void 0&&(p=b),typeof d=="boolean"&&(this._setAllowLocalAudio(d),d=void 0),typeof p=="boolean"&&(this._setAllowLocalVideo(p),p=void 0),!d&&!p)return yield this.getInputDevices();var O={};return d&&(d instanceof MediaStreamTrack?(this._sharedTracks.audioTrack=d,d=tt,O.audio={settings:{customTrack:d}}):(delete this._sharedTracks.audioTrack,O.audio={settings:{deviceId:d}})),p&&(p instanceof MediaStreamTrack?(this._sharedTracks.videoTrack=p,p=tt,O.video={settings:{customTrack:p}}):(delete this._sharedTracks.videoTrack,O.video={settings:{deviceId:p}})),this._callObjectMode&&this.needsLoad()?(this._updatePreloadCacheInputSettings(O,!1),this._devicesFromInputSettings(this._inputSettings)):new Promise(function(A){f.sendMessageToCallMachine({action:"set-input-devices",audioDeviceId:d,videoDeviceId:p},function(L){if(delete L.action,delete L.callbackStamp,L.returnPreloadCache)return f._updatePreloadCacheInputSettings(O,!1),void A(f._devicesFromInputSettings(f._inputSettings));A(L)})})}),function(o){return se.apply(this,arguments)})},{key:"setOutputDeviceAsync",value:(F=j(function*(o){var f=this,d=o.outputDeviceId;return J(),d&&(this._preloadCache.outputDeviceId=d),this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise(function(p){f.sendMessageToCallMachine({action:"set-output-device",outputDeviceId:d},function(g){delete g.action,delete g.callbackStamp,g.returnPreloadCache?p(f._devicesFromInputSettings(f._inputSettings)):p(g)})})}),function(o){return F.apply(this,arguments)})},{key:"getInputDevices",value:(V=j(function*(){var o=this;return this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise(function(f){o.sendMessageToCallMachine({action:"get-input-devices"},function(d){d.returnPreloadCache?f(o._devicesFromInputSettings(o._inputSettings)):f({camera:d.camera,mic:d.mic,speaker:d.speaker})})})}),function(){return V.apply(this,arguments)})},{key:"nativeInCallAudioMode",value:function(){return mn(),this._nativeInCallAudioMode}},{key:"setNativeInCallAudioMode",value:function(o){if(mn(),[no,vf].includes(o)){if(o!==this._nativeInCallAudioMode)return this._nativeInCallAudioMode=o,!this.disableReactNativeAutoDeviceManagement("audio")&&er(this._callState,this._isPreparingToJoin)&&this.nativeUtils().setAudioMode(this._nativeInCallAudioMode),this}else console.error("invalid in-call audio mode specified: ",o)}},{key:"preAuth",value:(x=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Le(this._callObjectMode,"preAuth()"),Gr(this._callState,this._isPreparingToJoin,"preAuth()"),this.needsLoad()&&(yield this.load(f)),!f.url)throw new Error("preAuth() requires at least a url to be provided");return this.validateProperties(f),this.properties=R(R({},this.properties),f),new Promise(function(d,p){o._preloadCache.inputSettings=o._prepInputSettingsForSharing(o._inputSettings,!1),o.sendMessageToCallMachine({action:"daily-method-preauth",properties:Ut(o.properties,o.callClientId),preloadCache:Ut(o._preloadCache,o.callClientId)},function(g){return g.error?p(g.error):g.access?(o._didPreAuth=!0,void d({access:g.access})):p(new Error("unknown error in preAuth()"))})})}),function(){return x.apply(this,arguments)})},{key:"load",value:(I=j(function*(o){var f=this;if(this.needsLoad()){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");if(o&&(this.validateProperties(o),this.properties=R(R({},this.properties),o)),!this._callObjectMode&&!this.properties.url)throw new Error("can't load iframe meeting because url property isn't set");return this._updateCallState(Sa),this.emitDailyJSEvent({action:Qu}),this._callObjectMode?new Promise(function(d,p){f._callObjectLoader.cancel();var g=Date.now();f._callObjectLoader.load(f.properties.dailyConfig,function(b){f._bundleLoadTime=b?"no-op":Date.now()-g,f._updateCallState(Ea),b&&f.emitDailyJSEvent({action:Ta}),d()},function(b,O){if(f.emitDailyJSEvent({action:Hu}),!O){f._updateCallState(rt),f.resetMeetingDependentVars();var A={action:Ia,errorMsg:b.msg,error:{type:"connection-error",msg:"Failed to load call object bundle.",details:{on:"load",sourceError:b,bundleUrl:nr(f.properties.dailyConfig)}}};f._maybeSendToSentry(A),f.emitDailyJSEvent(A),p(b.msg)}})}):(this._iframe.src=qo(this.assembleMeetingUrl(),this.properties.dailyConfig),new Promise(function(d,p){f._loadedCallback=function(g){f._callState!==rt?(f._updateCallState(Ea),(f.properties.cssFile||f.properties.cssText)&&f.loadCss(f.properties),d()):p(g)}}))}}),function(o){return I.apply(this,arguments)})},{key:"join",value:(C=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._testCallInProgress&&this.stopTestCallQuality();var d=!1;if(this.needsLoad()){this.updateIsPreparingToJoin(!0);try{yield this.load(f)}catch(p){return this.updateIsPreparingToJoin(!1),Promise.reject(p)}}else{if(d=!(!this.properties.cssFile&&!this.properties.cssText),this._didPreAuth){if(f.url&&f.url!==this.properties.url)return console.error("url in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject();if(f.token&&f.token!==this.properties.token)return console.error("token in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject()}if(f.url&&!this._callObjectMode&&f.url&&f.url!==this.properties.url)return console.error("url in join() is different than the one used in load() (".concat(this.properties.url," -> ").concat(f.url,")")),this.updateIsPreparingToJoin(!1),Promise.reject();this.validateProperties(f),this.properties=R(R({},this.properties),f)}return f.showLocalVideo!==void 0&&(this._callObjectMode?console.error("showLocalVideo is not available in callObject mode"):this._showLocalVideo=!!f.showLocalVideo),f.showParticipantsBar!==void 0&&(this._callObjectMode?console.error("showParticipantsBar is not available in callObject mode"):this._showParticipantsBar=!!f.showParticipantsBar),this._callState===At||this._callState===_i?(console.warn("already joined meeting, call leave() before joining again"),void this.updateIsPreparingToJoin(!1)):(this._updateCallState(_i,!1),this.emitDailyJSEvent({action:Zu}),this._preloadCache.inputSettings=this._prepInputSettingsForSharing(this._inputSettings||{},!1),this.sendMessageToCallMachine({action:"join-meeting",properties:Ut(this.properties,this.callClientId),preloadCache:Ut(this._preloadCache,this.callClientId)}),new Promise(function(p,g){o._joinedCallback=function(b,O){if(o._callState!==rt){if(o._updateCallState(At),b)for(var A in b){if(o._callObjectMode){var L=o._callMachine().store;qa(b[A],L),Ja(b[A],L),za(b[A],o._participants[A],L)}o._participants[A]=R({},b[A]),o.toggleParticipantAudioBasedOnNativeAudioFocus()}d&&o.loadCss(o.properties),p(b)}else g(O)}}))}),function(){return C.apply(this,arguments)})},{key:"leave",value:(w=j(function*(){var o=this;return this._testCallInProgress&&this.stopTestCallQuality(),new Promise(function(f){o._callState===Et||o._callState===rt?f():o._callObjectLoader&&!o._callObjectLoader.loaded?(o._callObjectLoader.cancel(),o._updateCallState(Et),o.resetMeetingDependentVars(),o.emitDailyJSEvent({action:Et}),f()):(o._resolveLeave=f,o.sendMessageToCallMachine({action:"leave-meeting"}))})}),function(){return w.apply(this,arguments)})},{key:"startScreenShare",value:(T=j(function*(){var o=this,f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Jn(this._callMachineInitialized,"startScreenShare()"),f.screenVideoSendSettings&&this._validateVideoSendSettings("screenVideo",f.screenVideoSendSettings),f.mediaStream&&(this._sharedTracks.screenMediaStream=f.mediaStream,f.mediaStream=tt),typeof DailyNativeUtils<"u"&&DailyNativeUtils.isIOS!==void 0&&DailyNativeUtils.isIOS){var d=this.nativeUtils();if(yield d.isScreenBeingCaptured())return void this.emitDailyJSEvent({action:Pa,type:"screen-share-error",errorMsg:"Could not start the screen sharing. The screen is already been captured!"});d.setSystemScreenCaptureStartCallback(function(){d.setSystemScreenCaptureStartCallback(null),o.sendMessageToCallMachine({action:xa,captureOptions:f})}),d.presentSystemScreenCapturePrompt()}else this.sendMessageToCallMachine({action:xa,captureOptions:f})}),function(){return T.apply(this,arguments)})},{key:"stopScreenShare",value:function(){Jn(this._callMachineInitialized,"stopScreenShare()"),this.sendMessageToCallMachine({action:"local-screen-stop"})}},{key:"startRecording",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},f=o.type;if(f&&f!=="cloud"&&f!=="raw-tracks"&&f!=="local")throw new Error("invalid type: ".concat(f,", allowed values 'cloud', 'raw-tracks', or 'local'"));this.sendMessageToCallMachine(R({action:"local-recording-start"},o))}},{key:"updateRecording",value:function(o){var f=o.layout,d=f===void 0?{preset:"default"}:f,p=o.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-recording",layout:d,instanceId:p})}},{key:"stopRecording",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"local-recording-stop"},o))}},{key:"startLiveStreaming",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"daily-method-start-live-streaming"},o))}},{key:"updateLiveStreaming",value:function(o){var f=o.layout,d=f===void 0?{preset:"default"}:f,p=o.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-live-streaming",layout:d,instanceId:p})}},{key:"addLiveStreamingEndpoints",value:function(o){var f=o.endpoints,d=o.instanceId;this.sendMessageToCallMachine({action:La,endpointsOp:Ud,endpoints:f,instanceId:d})}},{key:"removeLiveStreamingEndpoints",value:function(o){var f=o.endpoints,d=o.instanceId;this.sendMessageToCallMachine({action:La,endpointsOp:Vd,endpoints:f,instanceId:d})}},{key:"stopLiveStreaming",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(R({action:"daily-method-stop-live-streaming"},o))}},{key:"validateDailyConfig",value:function(o){o.camSimulcastEncodings&&(console.warn("camSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide camera simulcast settings."),this.validateSimulcastEncodings(o.camSimulcastEncodings)),o.screenSimulcastEncodings&&console.warn("screenSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide screen simulcast settings."),uc()&&o.noAutoDefaultDeviceChange&&console.warn("noAutoDefaultDeviceChange is not supported on Android, and will be ignored.")}},{key:"validateSimulcastEncodings",value:function(o){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(o){if(!(o instanceof Array||Array.isArray(o)))throw new Error("encodings must be an Array");if(!fo(o.length,1,3))throw new Error("encodings must be an Array with between 1 to ".concat(3," layers"));for(var p=0;p<o.length;p++){var g=o[p];for(var b in this._validateEncodingLayerHasValidProperties(g),g)if(zr.includes(b)){if(typeof g[b]!="number")throw new Error("".concat(b," must be a number"));if(f){var O=f[b],A=O.min,L=O.max;if(!fo(g[b],A,L))throw new Error("".concat(b," value not in range. valid range: ").concat(A," to ").concat(L))}}else if(!["active","scalabilityMode"].includes(b))throw new Error("Invalid key ".concat(b,", valid keys are:")+Object.values(zr));if(d&&!g.hasOwnProperty("maxBitrate"))throw new Error("maxBitrate is not specified")}}}},{key:"startRemoteMediaPlayer",value:(D=j(function*(o){var f=this,d=o.url,p=o.settings,g=p===void 0?{state:wi.PLAY}:p;try{(function(b){if(typeof b!="string")throw new Error('url parameter must be "string" type')})(d),uo(g),function(b){for(var O in b)if(!so.includes(O))throw new Error("Invalid key ".concat(O,", valid keys are: ").concat(so));b.simulcastEncodings&&this.validateSimulcastEncodings(b.simulcastEncodings,_c,!0)}(g)}catch(b){throw console.error("invalid argument Error: ".concat(b)),console.error(`startRemoteMediaPlayer arguments must be of the form:
  { url: "playback url",
  settings?:
  {state: "play"|"pause", simulcastEncodings?: [{}] } }`),b}return new Promise(function(b,O){f.sendMessageToCallMachine({action:"daily-method-start-remote-media-player",url:d,settings:g},function(A){A.error?O({error:A.error,errorMsg:A.errorMsg}):b({session_id:A.session_id,remoteMediaPlayerState:{state:A.state,settings:A.settings}})})})}),function(o){return D.apply(this,arguments)})},{key:"stopRemoteMediaPlayer",value:(B=j(function*(o){var f=this;if(typeof o!="string")throw new Error(" remotePlayerID must be of type string");return new Promise(function(d,p){f.sendMessageToCallMachine({action:"daily-method-stop-remote-media-player",session_id:o},function(g){g.error?p({error:g.error,errorMsg:g.errorMsg}):d()})})}),function(o){return B.apply(this,arguments)})},{key:"updateRemoteMediaPlayer",value:(N=j(function*(o){var f=this,d=o.session_id,p=o.settings;try{uo(p)}catch(g){throw console.error("invalid argument Error: ".concat(g)),console.error(`updateRemoteMediaPlayer arguments must be of the form:
  session_id: "participant session",
  { settings?: {state: "play"|"pause"} }`),g}return new Promise(function(g,b){f.sendMessageToCallMachine({action:"daily-method-update-remote-media-player",session_id:d,settings:p},function(O){O.error?b({error:O.error,errorMsg:O.errorMsg}):g({session_id:O.session_id,remoteMediaPlayerState:{state:O.state,settings:O.settings}})})})}),function(o){return N.apply(this,arguments)})},{key:"startTranscription",value:function(o){ne(this._callState,"startTranscription()"),this.sendMessageToCallMachine(R({action:"daily-method-start-transcription"},o))}},{key:"updateTranscription",value:function(o){if(ne(this._callState,"updateTranscription()"),!o)throw new Error("updateTranscription Error: options is mandatory");if(H(o)!=="object")throw new Error("updateTranscription Error: options must be object type");if(o.participants&&!Array.isArray(o.participants))throw new Error("updateTranscription Error: participants must be an array");this.sendMessageToCallMachine(R({action:"daily-method-update-transcription"},o))}},{key:"stopTranscription",value:function(o){if(ne(this._callState,"stopTranscription()"),o&&H(o)!=="object")throw new Error("stopTranscription Error: options must be object type");if(o&&!o.instanceId)throw new Error('"instanceId" not provided');this.sendMessageToCallMachine(R({action:"daily-method-stop-transcription"},o))}},{key:"startDialOut",value:(P=j(function*(o){var f=this;ne(this._callState,"startDialOut()");var d=function(p){if(p){if(!Array.isArray(p))throw new Error("Error starting dial out: audio codec must be an array");if(p.length<=0)throw new Error("Error starting dial out: audio codec array specified but empty");p.forEach(function(g){if(typeof g!="string")throw new Error("Error starting dial out: audio codec must be a string");if(g!=="OPUS"&&g!=="PCMU"&&g!=="PCMA"&&g!=="G722")throw new Error("Error starting dial out: audio codec must be one of OPUS, PCMU, PCMA, G722")})}};if(!o.sipUri&&!o.phoneNumber)throw new Error("Error starting dial out: either a sip uri or phone number must be provided");if(o.sipUri&&o.phoneNumber)throw new Error("Error starting dial out: only one of sip uri or phone number must be provided");if(o.sipUri){if(typeof o.sipUri!="string")throw new Error("Error starting dial out: sipUri must be a string");if(!o.sipUri.startsWith("sip:"))throw new Error("Error starting dial out: Invalid SIP URI, must start with 'sip:'");if(o.video&&typeof o.video!="boolean")throw new Error("Error starting dial out: video must be a boolean value");(function(p){if(p&&(d(p.audio),p.video)){if(!Array.isArray(p.video))throw new Error("Error starting dial out: video codec must be an array");if(p.video.length<=0)throw new Error("Error starting dial out: video codec array specified but empty");p.video.forEach(function(g){if(typeof g!="string")throw new Error("Error starting dial out: video codec must be a string");if(g!=="H264"&&g!=="VP8")throw new Error("Error starting dial out: video codec must be H264 or VP8")})}})(o.codecs)}if(o.phoneNumber){if(typeof o.phoneNumber!="string")throw new Error("Error starting dial out: phoneNumber must be a string");if(!/^\+\d{1,}$/.test(o.phoneNumber))throw new Error("Error starting dial out: Invalid phone number, must be valid phone number as per E.164");o.codecs&&d(o.codecs.audio)}if(o.callerId){if(typeof o.callerId!="string")throw new Error("Error starting dial out: callerId must be a string");if(o.sipUri)throw new Error("Error starting dial out: callerId not allowed with sipUri")}if(o.displayName){if(typeof o.displayName!="string")throw new Error("Error starting dial out: displayName must be a string");if(o.displayName.length>=200)throw new Error("Error starting dial out: displayName length must be less than 200")}if(o.userId){if(typeof o.userId!="string")throw new Error("Error starting dial out: userId must be a string");if(o.userId.length>36)throw new Error("Error starting dial out: userId length must be less than or equal to 36")}return new Promise(function(p,g){f.sendMessageToCallMachine(R({action:"dialout-start"},o),function(b){b.error?g(b.error):p(b)})})}),function(o){return P.apply(this,arguments)})},{key:"stopDialOut",value:function(o){var f=this;return ne(this._callState,"stopDialOut()"),new Promise(function(d,p){f.sendMessageToCallMachine(R({action:"dialout-stop"},o),function(g){g.error?p(g.error):d(g)})})}},{key:"sipCallTransfer",value:(k=j(function*(o){var f=this;if(ne(this._callState,"sipCallTransfer()"),!o)throw new Error("sipCallTransfer() requires a sessionId and toEndPoint");return o.useSipRefer=!1,lo(o,"sipCallTransfer"),new Promise(function(d,p){f.sendMessageToCallMachine(R({action:Ra},o),function(g){g.error?p(g.error):d(g)})})}),function(o){return k.apply(this,arguments)})},{key:"sipRefer",value:(y=j(function*(o){var f=this;if(ne(this._callState,"sipRefer()"),!o)throw new Error("sessionId and toEndPoint are mandatory parameter");return o.useSipRefer=!0,lo(o,"sipRefer"),new Promise(function(d,p){f.sendMessageToCallMachine(R({action:Ra},o),function(g){g.error?p(g.error):d(g)})})}),function(o){return y.apply(this,arguments)})},{key:"sendDTMF",value:(_=j(function*(o){var f=this;return ne(this._callState,"sendDTMF()"),function(d){var p=d.sessionId,g=d.tones;if(!p||!g)throw new Error("sessionId and tones are mandatory parameter");if(typeof p!="string"||typeof g!="string")throw new Error("sessionId and tones should be of string type");if(g.length>20)throw new Error("tones string must be upto 20 characters");var b=/[^0-9A-D*#]/g,O=g.match(b);if(O&&O[0])throw new Error("".concat(O[0]," is not valid DTMF tone"))}(o),new Promise(function(d,p){f.sendMessageToCallMachine(R({action:"send-dtmf"},o),function(g){g.error?p(g.error):d(g)})})}),function(o){return _.apply(this,arguments)})},{key:"getNetworkStats",value:function(){var o=this;return this._callState!==At?Promise.resolve(R({stats:{latest:{}}},this._network)):new Promise(function(f){o.sendMessageToCallMachine({action:"get-calc-stats"},function(d){f(R(R({},o._network),{},{stats:d.stats}))})})}},{key:"testWebsocketConnectivity",value:(v=j(function*(){var o=this;if(Kr(this._testCallInProgress,"testWebsocketConnectivity()"),this.needsLoad())try{yield this.load()}catch(f){return Promise.reject(f)}return new Promise(function(f,d){o.sendMessageToCallMachine({action:"test-websocket-connectivity"},function(p){p.error?d(p.error):f(p.results)})})}),function(){return v.apply(this,arguments)})},{key:"abortTestWebsocketConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-websocket-connectivity"})}},{key:"_validateVideoTrackForNetworkTests",value:function(o){return o?o instanceof MediaStreamTrack?!!df(o)||(console.error("Video track is not playable. This test needs a live video track."),!1):(console.error("Video track needs to be of type `MediaStreamTrack`."),!1):(console.error("Missing video track. You must provide a video track in order to run this test."),!1)}},{key:"testCallQuality",value:(m=j(function*(){var o=this;J(),Le(this._callObjectMode,"testCallQuality()"),Jn(this._callMachineInitialized,"testCallQuality()",null,!0),Gr(this._callState,this._isPreparingToJoin,"testCallQuality()");var f=this._testCallAlreadyInProgress,d=function(g){f||(o._testCallInProgress=g)};if(d(!0),this.needsLoad())try{var p=this._callState;yield this.load(),this._callState=p}catch(g){return d(!1),Promise.reject(g)}return new Promise(function(g){o.sendMessageToCallMachine({action:"test-call-quality",dailyJsVersion:o.properties.dailyJsVersion},function(b){var O=b.results,A=O.result,L=us(O,mf);if(A==="failed"){var q,G=R({},L);(q=L.error)!==null&&q!==void 0&&q.details?(L.error.details=JSON.parse(L.error.details),G.error=R(R({},G.error),{},{details:R({},G.error.details)}),G.error.details.duringTest="testCallQuality"):(G.error=G.error?R({},G.error):{},G.error.details={duringTest:"testCallQuality"}),o._maybeSendToSentry(G)}d(!1),g(R({result:A},L))})})}),function(){return m.apply(this,arguments)})},{key:"stopTestCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-call-quality"})}},{key:"testConnectionQuality",value:(h=j(function*(o){var f;K()?(console.warn("testConnectionQuality() is deprecated: use testPeerToPeerCallQuality() instead"),f=yield this.testPeerToPeerCallQuality(o)):(console.warn("testConnectionQuality() is deprecated: use testCallQuality() instead"),f=yield this.testCallQuality());var d={result:f.result,secondsElapsed:f.secondsElapsed};return f.data&&(d.data={maxRTT:f.data.maxRoundTripTime,packetLoss:f.data.avgRecvPacketLoss}),d}),function(o){return h.apply(this,arguments)})},{key:"testPeerToPeerCallQuality",value:(u=j(function*(o){var f=this;if(Kr(this._testCallInProgress,"testPeerToPeerCallQuality()"),this.needsLoad())try{yield this.load()}catch(g){return Promise.reject(g)}var d=o.videoTrack,p=o.duration;if(!this._validateVideoTrackForNetworkTests(d))throw new Error("Video track error");return this._sharedTracks.videoTrackForConnectionQualityTest=d,new Promise(function(g,b){f.sendMessageToCallMachine({action:"test-p2p-call-quality",duration:p},function(O){O.error?b(O.error):g(O.results)})})}),function(o){return u.apply(this,arguments)})},{key:"stopTestConnectionQuality",value:function(){K()?(console.warn("stopTestConnectionQuality() is deprecated: use testPeerToPeerCallQuality() and stopTestPeerToPeerCallQuality() instead"),this.stopTestPeerToPeerCallQuality()):(console.warn("stopTestConnectionQuality() is deprecated: use testCallQuality() and stopTestCallQuality() instead"),this.stopTestCallQuality())}},{key:"stopTestPeerToPeerCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-p2p-call-quality"})}},{key:"testNetworkConnectivity",value:(l=j(function*(o){var f=this;if(Kr(this._testCallInProgress,"testNetworkConnectivity()"),this.needsLoad())try{yield this.load()}catch(d){return Promise.reject(d)}if(!this._validateVideoTrackForNetworkTests(o))throw new Error("Video track error");return this._sharedTracks.videoTrackForNetworkConnectivityTest=o,new Promise(function(d,p){f.sendMessageToCallMachine({action:"test-network-connectivity"},function(g){g.error?p(g.error):d(g.results)})})}),function(o){return l.apply(this,arguments)})},{key:"abortTestNetworkConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-network-connectivity"})}},{key:"getCpuLoadStats",value:function(){var o=this;return new Promise(function(f){o._callState===At?o.sendMessageToCallMachine({action:"get-cpu-load-stats"},function(d){f(d.cpuStats)}):f({cpuLoadState:void 0,cpuLoadStateReason:void 0,stats:{}})})}},{key:"_validateEncodingLayerHasValidProperties",value:function(o){var f;if(!(((f=Object.keys(o))===null||f===void 0?void 0:f.length)>0))throw new Error("Empty encoding is not allowed. At least one of these valid keys should be specified:"+Object.values(zr))}},{key:"_validateVideoSendSettings",value:function(o,f){var d=o==="screenVideo"?["default-screen-video","detail-optimized","motion-optimized","motion-and-detail-balanced"]:["default-video","bandwidth-optimized","bandwidth-and-quality-balanced","quality-optimized","adaptive-2-layers","adaptive-3-layers"],p="Video send settings should be either an object or one of the supported presets: ".concat(d.join());if(typeof f=="string"){if(!d.includes(f))throw new Error(p)}else{if(H(f)!=="object")throw new Error(p);if(!f.maxQuality&&!f.encodings&&f.allowAdaptiveLayers===void 0)throw new Error("Video send settings must contain at least maxQuality, allowAdaptiveLayers or encodings attribute");if(f.maxQuality&&["low","medium","high"].indexOf(f.maxQuality)===-1)throw new Error("maxQuality must be either low, medium or high");if(f.encodings){var g=!1;switch(Object.keys(f.encodings).length){case 1:g=!f.encodings.low;break;case 2:g=!f.encodings.low||!f.encodings.medium;break;case 3:g=!f.encodings.low||!f.encodings.medium||!f.encodings.high;break;default:g=!0}if(g)throw new Error("Encodings must be defined as: low, low and medium, or low, medium and high.");f.encodings.low&&this._validateEncodingLayerHasValidProperties(f.encodings.low),f.encodings.medium&&this._validateEncodingLayerHasValidProperties(f.encodings.medium),f.encodings.high&&this._validateEncodingLayerHasValidProperties(f.encodings.high)}}}},{key:"validateUpdateSendSettings",value:function(o){var f=this;if(!o||Object.keys(o).length===0)throw new Error("Send settings must contain at least information for one track!");Object.entries(o).forEach(function(d){var p=we(d,2),g=p[0],b=p[1];f._validateVideoSendSettings(g,b)})}},{key:"updateSendSettings",value:function(o){var f=this;return this.validateUpdateSendSettings(o),this.needsLoad()?(this._preloadCache.sendSettings=o,{sendSettings:this._preloadCache.sendSettings}):new Promise(function(d,p){f.sendMessageToCallMachine({action:"update-send-settings",sendSettings:o},function(g){g.error?p(g.error):d(g.sendSettings)})})}},{key:"getSendSettings",value:function(){return this._sendSettings||this._preloadCache.sendSettings}},{key:"getLocalAudioLevel",value:function(){return this._localAudioLevel}},{key:"getRemoteParticipantsAudioLevel",value:function(){return this._remoteParticipantsAudioLevel}},{key:"getActiveSpeaker",value:function(){return J(),this._activeSpeaker}},{key:"setActiveSpeakerMode",value:function(o){return J(),this.sendMessageToCallMachine({action:"set-active-speaker-mode",enabled:o}),this}},{key:"activeSpeakerMode",value:function(){return J(),this._activeSpeakerMode}},{key:"subscribeToTracksAutomatically",value:function(){return this._preloadCache.subscribeToTracksAutomatically}},{key:"setSubscribeToTracksAutomatically",value:function(o){return ne(this._callState,"setSubscribeToTracksAutomatically()","Use the subscribeToTracksAutomatically configuration property."),this._preloadCache.subscribeToTracksAutomatically=o,this.sendMessageToCallMachine({action:"daily-method-subscribe-to-tracks-automatically",enabled:o}),this}},{key:"enumerateDevices",value:(c=j(function*(){var o=this;if(this._callObjectMode){var f=yield navigator.mediaDevices.enumerateDevices();return Bt()==="Firefox"&&cr().major>115&&cr().major<123&&(f=f.filter(function(d){return d.kind!=="audiooutput"})),{devices:f.map(function(d){var p=JSON.parse(JSON.stringify(d));if(!K()&&d.kind==="videoinput"&&d.getCapabilities){var g,b=d.getCapabilities();p.facing=(b==null||(g=b.facingMode)===null||g===void 0?void 0:g.length)>=1?b.facingMode[0]:void 0}return p})}}return new Promise(function(d){o.sendMessageToCallMachine({action:"enumerate-devices"},function(p){d({devices:p.devices})})})}),function(){return c.apply(this,arguments)})},{key:"sendAppMessage",value:function(o){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"*";if(ne(this._callState,"sendAppMessage()"),JSON.stringify(o).length>this._maxAppMessageSize)throw new Error("Message data too large. Max size is "+this._maxAppMessageSize);return this.sendMessageToCallMachine({action:"app-msg",data:o,to:f}),this}},{key:"addFakeParticipant",value:function(o){return J(),ne(this._callState,"addFakeParticipant()"),this.sendMessageToCallMachine(R({action:"add-fake-participant"},o)),this}},{key:"setShowNamesMode",value:function(o){return Ee(this._callObjectMode,"setShowNamesMode()"),J(),o&&o!=="always"&&o!=="never"?(console.error('setShowNamesMode argument should be "always", "never", or false'),this):(this.sendMessageToCallMachine({action:"set-show-names",mode:o}),this)}},{key:"setShowLocalVideo",value:function(){var o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return Ee(this._callObjectMode,"setShowLocalVideo()"),J(),ne(this._callState,"setShowLocalVideo()"),typeof o!="boolean"?(console.error("setShowLocalVideo only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-local-video",show:o}),this._showLocalVideo=o,this)}},{key:"showLocalVideo",value:function(){return Ee(this._callObjectMode,"showLocalVideo()"),J(),this._showLocalVideo}},{key:"setShowParticipantsBar",value:function(){var o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return Ee(this._callObjectMode,"setShowParticipantsBar()"),J(),ne(this._callState,"setShowParticipantsBar()"),typeof o!="boolean"?(console.error("setShowParticipantsBar only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-participants-bar",show:o}),this._showParticipantsBar=o,this)}},{key:"showParticipantsBar",value:function(){return Ee(this._callObjectMode,"showParticipantsBar()"),J(),this._showParticipantsBar}},{key:"customIntegrations",value:function(){return J(),Ee(this._callObjectMode,"customIntegrations()"),this._customIntegrations}},{key:"setCustomIntegrations",value:function(o){return J(),Ee(this._callObjectMode,"setCustomIntegrations()"),ne(this._callState,"setCustomIntegrations()"),Oc(o)?(this.sendMessageToCallMachine({action:"set-custom-integrations",integrations:o}),this._customIntegrations=o,this):this}},{key:"startCustomIntegrations",value:function(o){var f=this;if(J(),Ee(this._callObjectMode,"startCustomIntegrations()"),ne(this._callState,"startCustomIntegrations()"),Array.isArray(o)&&o.some(function(g){return typeof g!="string"})||!Array.isArray(o)&&typeof o!="string")return console.error("startCustomIntegrations() only accepts string | string[]"),this;var d=typeof o=="string"?[o]:o,p=d.filter(function(g){return!(g in f._customIntegrations)});return p.length?(console.error(`Can't find custom integration(s): "`.concat(p.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"start-custom-integrations",ids:d}),this)}},{key:"stopCustomIntegrations",value:function(o){var f=this;if(J(),Ee(this._callObjectMode,"stopCustomIntegrations()"),ne(this._callState,"stopCustomIntegrations()"),Array.isArray(o)&&o.some(function(g){return typeof g!="string"})||!Array.isArray(o)&&typeof o!="string")return console.error("stopCustomIntegrations() only accepts string | string[]"),this;var d=typeof o=="string"?[o]:o,p=d.filter(function(g){return!(g in f._customIntegrations)});return p.length?(console.error(`Can't find custom integration(s): "`.concat(p.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"stop-custom-integrations",ids:d}),this)}},{key:"customTrayButtons",value:function(){return Ee(this._callObjectMode,"customTrayButtons()"),J(),this._customTrayButtons}},{key:"updateCustomTrayButtons",value:function(o){return Ee(this._callObjectMode,"updateCustomTrayButtons()"),J(),ne(this._callState,"updateCustomTrayButtons()"),Cc(o)?(this.sendMessageToCallMachine({action:"update-custom-tray-buttons",btns:o}),this._customTrayButtons=o,this):(console.error("updateCustomTrayButtons only accepts a dictionary of the type ".concat(JSON.stringify(ur))),this)}},{key:"theme",value:function(){return Ee(this._callObjectMode,"theme()"),this.properties.theme}},{key:"setTheme",value:function(o){var f=this;return Ee(this._callObjectMode,"setTheme()"),new Promise(function(d,p){try{f.validateProperties({theme:o}),f.properties.theme=R({},o),f.sendMessageToCallMachine({action:"set-theme",theme:f.properties.theme});try{f.emitDailyJSEvent({action:Ku,theme:f.properties.theme})}catch(g){console.log("could not emit 'theme-updated'",g)}d(f.properties.theme)}catch(g){p(g)}})}},{key:"requestFullscreen",value:(a=j(function*(){if(J(),this._iframe&&!document.fullscreenElement&&Da())try{(yield this._iframe.requestFullscreen)?this._iframe.requestFullscreen():this._iframe.webkitRequestFullscreen()}catch(o){console.log("could not make video call fullscreen",o)}}),function(){return a.apply(this,arguments)})},{key:"exitFullscreen",value:function(){J(),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()}},{key:"getSidebarView",value:(s=j(function*(){var o=this;return this._callObjectMode?(console.error("getSidebarView is not available in callObject mode"),Promise.resolve(null)):new Promise(function(f){o.sendMessageToCallMachine({action:"get-sidebar-view"},function(d){f(d.view)})})}),function(){return s.apply(this,arguments)})},{key:"setSidebarView",value:function(o){return this._callObjectMode?(console.error("setSidebarView is not available in callObject mode"),this):(this.sendMessageToCallMachine({action:"set-sidebar-view",view:o}),this)}},{key:"room",value:(i=j(function*(){var o=this,f=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).includeRoomConfigDefaults,d=f===void 0||f;return this._accessState.access===$r||this.needsLoad()?this.properties.url?{roomUrlPendingJoin:this.properties.url}:null:new Promise(function(p){o.sendMessageToCallMachine({action:"lib-room-info",includeRoomConfigDefaults:d},function(g){delete g.action,delete g.callbackStamp,p(g)})})}),function(){return i.apply(this,arguments)})},{key:"geo",value:(r=j(function*(){try{var o=yield fetch("https://gs.daily.co/_ks_/x-swsl/:");return{current:(yield o.json()).geo}}catch(f){return console.error("geo lookup failed",f),{current:""}}}),function(){return r.apply(this,arguments)})},{key:"setNetworkTopology",value:(t=j(function*(o){var f=this;return J(),ne(this._callState,"setNetworkTopology()"),new Promise(function(d,p){f.sendMessageToCallMachine({action:"set-network-topology",opts:o},function(g){g.error?p({error:g.error}):d({workerId:g.workerId})})})}),function(o){return t.apply(this,arguments)})},{key:"getNetworkTopology",value:(e=j(function*(){var o=this;return new Promise(function(f,d){o.needsLoad()&&f({topology:"none"}),o.sendMessageToCallMachine({action:"get-network-topology"},function(p){p.error?d({error:p.error}):f({topology:p.topology})})})}),function(){return e.apply(this,arguments)})},{key:"setPlayNewParticipantSound",value:function(o){if(J(),typeof o!="number"&&o!==!0&&o!==!1)throw new Error("argument to setShouldPlayNewParticipantSound should be true, false, or a number, but is ".concat(o));this.sendMessageToCallMachine({action:"daily-method-set-play-ding",arg:o})}},{key:"on",value:function(o,f){return Nn.prototype.on.call(this,o,f)}},{key:"once",value:function(o,f){return Nn.prototype.once.call(this,o,f)}},{key:"off",value:function(o,f){return Nn.prototype.off.call(this,o,f)}},{key:"validateProperties",value:function(o){var f,d;if(o!=null&&(f=o.dailyConfig)!==null&&f!==void 0&&f.userMediaAudioConstraints){var p,g;K()||console.warn("userMediaAudioConstraints is deprecated. You can override constraints with inputSettings.audio.settings, found in DailyCallOptions.");var b=o.inputSettings||{};b.audio=((p=o.inputSettings)===null||p===void 0?void 0:p.audio)||{},b.audio.settings=((g=o.inputSettings)===null||g===void 0||(g=g.audio)===null||g===void 0?void 0:g.settings)||{},b.audio.settings=R(R({},b.audio.settings),o.dailyConfig.userMediaAudioConstraints),o.inputSettings=b,delete o.dailyConfig.userMediaAudioConstraints}if(o!=null&&(d=o.dailyConfig)!==null&&d!==void 0&&d.userMediaVideoConstraints){var O,A;K()||console.warn("userMediaVideoConstraints is deprecated. You can override constraints with inputSettings.video.settings, found in DailyCallOptions.");var L=o.inputSettings||{};L.video=((O=o.inputSettings)===null||O===void 0?void 0:O.video)||{},L.video.settings=((A=o.inputSettings)===null||A===void 0||(A=A.video)===null||A===void 0?void 0:A.settings)||{},L.video.settings=R(R({},L.video.settings),o.dailyConfig.userMediaVideoConstraints),o.inputSettings=L,delete o.dailyConfig.userMediaVideoConstraints}for(var q in o){if(!Tt[q])throw new Error("unrecognized property '".concat(q,"'"));if(Tt[q].validate&&!Tt[q].validate(o[q],this))throw new Error("property '".concat(q,"': ").concat(Tt[q].help))}}},{key:"assembleMeetingUrl",value:function(){var o,f,d=R(R({},this.properties),{},{emb:this.callClientId,embHref:encodeURIComponent(window.location.href),proxy:(o=this.properties.dailyConfig)!==null&&o!==void 0&&o.proxyUrl?encodeURIComponent((f=this.properties.dailyConfig)===null||f===void 0?void 0:f.proxyUrl):void 0}),p=d.url.match(/\?/)?"&":"?";return d.url+p+Object.keys(Tt).filter(function(g){return Tt[g].queryString&&d[g]!==void 0}).map(function(g){return"".concat(Tt[g].queryString,"=").concat(d[g])}).join("&")}},{key:"needsLoad",value:function(){return[ka,Sa,Et,rt].includes(this._callState)}},{key:"sendMessageToCallMachine",value:function(o,f){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");this._messageChannel.sendMessageToCallMachine(o,f,this.callClientId,this._iframe)}},{key:"forwardPackagedMessageToCallMachine",value:function(o){this._messageChannel.forwardPackagedMessageToCallMachine(o,this._iframe,this.callClientId)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(o){return this._messageChannel.addListenerForPackagedMessagesFromCallMachine(o,this.callClientId)}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(o){this._messageChannel.removeListenerForPackagedMessagesFromCallMachine(o)}},{key:"handleMessageFromCallMachine",value:function(o){switch(o.action){case zu:this.sendMessageToCallMachine(R({action:Gu},this.properties));break;case"call-machine-initialized":this._callMachineInitialized=!0;var f={action:Vn,level:"log",code:1011,stats:{event:"bundle load",time:this._bundleLoadTime==="no-op"?0:this._bundleLoadTime,preLoaded:this._bundleLoadTime==="no-op",url:nr(this.properties.dailyConfig)}};this.sendMessageToCallMachine(f),this._delayDuplicateInstanceLog&&this._logDuplicateInstanceAttempt();break;case Ta:this._loadedCallback&&(this._loadedCallback(),this._loadedCallback=null),this.emitDailyJSEvent(o);break;case ed:var d,p=R({},o);delete p.internal,this._maxAppMessageSize=((d=o.internal)===null||d===void 0?void 0:d._maxAppMessageSize)||Ur,this._joinedCallback&&(this._joinedCallback(o.participants),this._joinedCallback=null),this.emitDailyJSEvent(p);break;case nd:case rd:if(this._callState===Et)return;if(o.participant&&o.participant.session_id){var g=o.participant.local?"local":o.participant.session_id;if(this._callObjectMode){var b=this._callMachine().store;qa(o.participant,b),Ja(o.participant,b),za(o.participant,this._participants[g],b)}try{this.maybeParticipantTracksStopped(this._participants[g],o.participant),this.maybeParticipantTracksStarted(this._participants[g],o.participant),this.maybeEventRecordingStopped(this._participants[g],o.participant),this.maybeEventRecordingStarted(this._participants[g],o.participant)}catch(Hc){console.error("track events error",Hc)}this.compareEqualForParticipantUpdateEvent(o.participant,this._participants[g])||(this._participants[g]=R({},o.participant),this.toggleParticipantAudioBasedOnNativeAudioFocus(),this.emitDailyJSEvent(o))}break;case id:if(o.participant&&o.participant.session_id){var O=this._participants[o.participant.session_id];O&&this.maybeParticipantTracksStopped(O,null),delete this._participants[o.participant.session_id],this.emitDailyJSEvent(o)}break;case sd:be(this._participantCounts,o.participantCounts)||(this._participantCounts=o.participantCounts,this.emitDailyJSEvent(o));break;case ad:var A={access:o.access};o.awaitingAccess&&(A.awaitingAccess=o.awaitingAccess),be(this._accessState,A)||(this._accessState=A,this.emitDailyJSEvent(o));break;case od:if(o.meetingSession){this._meetingSessionSummary=o.meetingSession,this.emitDailyJSEvent(o);var L=R(R({},o),{},{action:"meeting-session-updated"});this.emitDailyJSEvent(L)}break;case Ia:var q;this._iframe&&!o.preserveIframe&&(this._iframe.src=""),this._updateCallState(rt),this.resetMeetingDependentVars(),this._loadedCallback&&(this._loadedCallback(o.errorMsg),this._loadedCallback=null),o.preserveIframe;var G=us(o,gf);G!=null&&(q=G.error)!==null&&q!==void 0&&q.details&&(G.error.details=JSON.parse(G.error.details)),this._maybeSendToSentry(o),this._joinedCallback&&(this._joinedCallback(null,G),this._joinedCallback=null),this.emitDailyJSEvent(G);break;case td:this._callState!==rt&&this._updateCallState(Et),this.resetMeetingDependentVars(),this._resolveLeave&&(this._resolveLeave(),this._resolveLeave=null),this.emitDailyJSEvent(o);break;case"selected-devices-updated":o.devices&&this.emitDailyJSEvent(o);break;case Id:var Je=o.state,wt=o.threshold,un=o.quality,le=Je.state,Oe=Je.reasons;le===this._network.networkState&&be(Oe,this._network.networkStateReasons)&&wt===this._network.threshold&&un===this._network.quality||(this._network.networkState=le,this._network.networkStateReasons=Oe,this._network.quality=un,this._network.threshold=wt,o.networkState=le,Oe.length&&(o.networkStateReasons=Oe),delete o.state,this.emitDailyJSEvent(o));break;case xd:o&&o.cpuLoadState&&this.emitDailyJSEvent(o);break;case Ld:o&&o.faceCounts!==void 0&&this.emitDailyJSEvent(o);break;case Ad:var kt=o.activeSpeaker;this._activeSpeaker.peerId!==kt.peerId&&(this._activeSpeaker.peerId=kt.peerId,this.emitDailyJSEvent({action:o.action,activeSpeaker:this._activeSpeaker}));break;case"show-local-video-changed":if(this._callObjectMode)return;var dn=o.show;this._showLocalVideo=dn,this.emitDailyJSEvent({action:o.action,show:dn});break;case Pd:var An=o.enabled;this._activeSpeakerMode!==An&&(this._activeSpeakerMode=An,this.emitDailyJSEvent({action:o.action,enabled:this._activeSpeakerMode}));break;case ld:case ud:case dd:this._waitingParticipants=o.allWaitingParticipants,this.emitDailyJSEvent({action:o.action,participant:o.participant});break;case $d:be(this._receiveSettings,o.receiveSettings)||(this._receiveSettings=o.receiveSettings,this.emitDailyJSEvent({action:o.action,receiveSettings:o.receiveSettings}));break;case Aa:this._maybeUpdateInputSettings(o.inputSettings);break;case"send-settings-updated":be(this._sendSettings,o.sendSettings)||(this._sendSettings=o.sendSettings,this._preloadCache.sendSettings=null,this.emitDailyJSEvent({action:o.action,sendSettings:o.sendSettings}));break;case"local-audio-level":this._localAudioLevel=o.audioLevel,this._preloadCache.localAudioLevelObserver=null,this.emitDailyJSEvent(o);break;case"remote-participants-audio-level":this._remoteParticipantsAudioLevel=o.participantsAudioLevel,this._preloadCache.remoteParticipantsAudioLevelObserver=null,this.emitDailyJSEvent(o);break;case Sd:var fn=o.session_id;this._rmpPlayerState[fn]=o.playerState,this.emitDailyJSEvent(o);break;case Md:delete this._rmpPlayerState[o.session_id],this.emitDailyJSEvent(o);break;case Ed:var hn=o.session_id,as=this._rmpPlayerState[hn];as&&this.compareEqualForRMPUpdateEvent(as,o.remoteMediaPlayerState)||(this._rmpPlayerState[hn]=o.remoteMediaPlayerState,this.emitDailyJSEvent(o));break;case"custom-button-click":case"sidebar-view-changed":this.emitDailyJSEvent(o);break;case cd:var Qc=this._meetingSessionState.topology!==(o.meetingSessionState&&o.meetingSessionState.topology);this._meetingSessionState=Qr(o.meetingSessionState,this._callObjectMode),(this._callObjectMode||Qc)&&this.emitDailyJSEvent(o);break;case Td:this._isScreenSharing=!0,this.emitDailyJSEvent(o);break;case Cd:case Od:this._isScreenSharing=!1,this.emitDailyJSEvent(o);break;case Ca:case Oa:case vd:case yd:case bd:case pd:case md:case gd:case Xu:case Yu:case wd:case kd:case"test-completed":case Nd:case _d:case Rd:case Dd:case Bd:case jd:case Pa:case Fd:case"dialin-ready":case"dialin-connected":case"dialin-error":case"dialin-stopped":case"dialin-warning":case"dialout-connected":case"dialout-answered":case"dialout-error":case"dialout-stopped":case"dialout-warning":this.emitDailyJSEvent(o);break;case"request-fullscreen":this.requestFullscreen();break;case"request-exit-fullscreen":this.exitFullscreen()}}},{key:"maybeEventRecordingStopped",value:function(o,f){var d="record";o&&(f.local||f[d]!==!1||o[d]===f[d]||this.emitDailyJSEvent({action:Oa}))}},{key:"maybeEventRecordingStarted",value:function(o,f){var d="record";o&&(f.local||f[d]!==!0||o[d]===f[d]||this.emitDailyJSEvent({action:Ca}))}},{key:"_trackStatePlayable",value:function(o){return!(!o||o.state!==Uu)}},{key:"_trackChanged",value:function(o,f){return(o==null?void 0:o.id)!==(f==null?void 0:f.id)}},{key:"maybeEventTrackStopped",value:function(o,f,d){var p,g,b=(p=f==null?void 0:f.tracks[o])!==null&&p!==void 0?p:null,O=(g=d==null?void 0:d.tracks[o])!==null&&g!==void 0?g:null,A=b==null?void 0:b.track;if(A){var L=this._trackStatePlayable(b),q=this._trackStatePlayable(O),G=this._trackChanged(A,O==null?void 0:O.track);L&&(q&&!G||this.emitDailyJSEvent({action:hd,track:A,participant:d??f,type:o}))}}},{key:"maybeEventTrackStarted",value:function(o,f,d){var p,g,b=(p=f==null?void 0:f.tracks[o])!==null&&p!==void 0?p:null,O=(g=d==null?void 0:d.tracks[o])!==null&&g!==void 0?g:null,A=O==null?void 0:O.track;if(A){var L=this._trackStatePlayable(b),q=this._trackStatePlayable(O),G=this._trackChanged(b==null?void 0:b.track,A);q&&(L&&!G||this.emitDailyJSEvent({action:fd,track:A,participant:d,type:o}))}}},{key:"maybeParticipantTracksStopped",value:function(o,f){if(o)for(var d in o.tracks)this.maybeEventTrackStopped(d,o,f)}},{key:"maybeParticipantTracksStarted",value:function(o,f){if(f)for(var d in f.tracks)this.maybeEventTrackStarted(d,o,f)}},{key:"compareEqualForRMPUpdateEvent",value:function(o,f){var d,p;return o.state===f.state&&((d=o.settings)===null||d===void 0?void 0:d.volume)===((p=f.settings)===null||p===void 0?void 0:p.volume)}},{key:"emitDailyJSEvent",value:function(o){try{o.callClientId=this.callClientId,this.emit(o.action,o)}catch(f){console.log("could not emit",o,f)}}},{key:"compareEqualForParticipantUpdateEvent",value:function(o,f){return!!be(o,f)&&(!o.videoTrack||!f.videoTrack||o.videoTrack.id===f.videoTrack.id&&o.videoTrack.muted===f.videoTrack.muted&&o.videoTrack.enabled===f.videoTrack.enabled)&&(!o.audioTrack||!f.audioTrack||o.audioTrack.id===f.audioTrack.id&&o.audioTrack.muted===f.audioTrack.muted&&o.audioTrack.enabled===f.audioTrack.enabled)}},{key:"nativeUtils",value:function(){return K()?typeof DailyNativeUtils>"u"?(console.warn("in React Native, DailyNativeUtils is expected to be available"),null):DailyNativeUtils:null}},{key:"updateIsPreparingToJoin",value:function(o){this._updateCallState(this._callState,o)}},{key:"_updateCallState",value:function(o){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._isPreparingToJoin;if(o!==this._callState||f!==this._isPreparingToJoin){var d=this._callState,p=this._isPreparingToJoin;this._callState=o,this._isPreparingToJoin=f;var g=this._callState===At;this.updateShowAndroidOngoingMeetingNotification(g);var b=er(d,p),O=er(this._callState,this._isPreparingToJoin);b!==O&&(this.updateKeepDeviceAwake(O),this.updateDeviceAudioMode(O),this.updateNoOpRecordingEnsuringBackgroundContinuity(O))}}},{key:"resetMeetingDependentVars",value:function(){this._participants={},this._participantCounts=io,this._waitingParticipants={},this._activeSpeaker={},this._activeSpeakerMode=!1,this._didPreAuth=!1,this._accessState={access:$r},this._finalSummaryOfPrevSession=this._meetingSessionSummary,this._meetingSessionSummary={},this._meetingSessionState=Qr(ro,this._callObjectMode),this._isScreenSharing=!1,this._receiveSettings={},this._inputSettings=void 0,this._sendSettings={},this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this._maxAppMessageSize=Ur,this._callMachineInitialized=!1,this._bundleLoadTime=void 0,this._preloadCache}},{key:"updateKeepDeviceAwake",value:function(o){K()&&this.nativeUtils().setKeepDeviceAwake(o,this.callClientId)}},{key:"updateDeviceAudioMode",value:function(o){if(K()&&!this.disableReactNativeAutoDeviceManagement("audio")){var f=o?this._nativeInCallAudioMode:"idle";this.nativeUtils().setAudioMode(f)}}},{key:"updateShowAndroidOngoingMeetingNotification",value:function(o){if(K()&&this.nativeUtils().setShowOngoingMeetingNotification){var f,d,p,g;if(this.properties.reactNativeConfig&&this.properties.reactNativeConfig.androidInCallNotification){var b=this.properties.reactNativeConfig.androidInCallNotification;f=b.title,d=b.subtitle,p=b.iconName,g=b.disableForCustomOverride}g&&(o=!1),this.nativeUtils().setShowOngoingMeetingNotification(o,f,d,p,this.callClientId)}}},{key:"updateNoOpRecordingEnsuringBackgroundContinuity",value:function(o){K()&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity(o)}},{key:"toggleParticipantAudioBasedOnNativeAudioFocus",value:function(){var o;if(K()){var f=(o=this._callMachine())===null||o===void 0||(o=o.store)===null||o===void 0?void 0:o.getState();for(var d in f==null?void 0:f.streams){var p=f.streams[d];p&&p.pendingTrack&&p.pendingTrack.kind==="audio"&&(p.pendingTrack.enabled=this._hasNativeAudioFocus)}}}},{key:"disableReactNativeAutoDeviceManagement",value:function(o){return this.properties.reactNativeConfig&&this.properties.reactNativeConfig.disableAutoDeviceManagement&&this.properties.reactNativeConfig.disableAutoDeviceManagement[o]}},{key:"absoluteUrl",value:function(o){if(o!==void 0){var f=document.createElement("a");return f.href=o,f.href}}},{key:"sayHello",value:function(){var o="hello, world.";return console.log(o),o}},{key:"_logUseAfterDestroy",value:function(){var o=Object.values(Mt)[0];if(this.needsLoad())if(o&&!o.needsLoad()){var f={action:Vn,level:"error",code:this.strictMode?9995:9997};o.sendMessageToCallMachine(f)}else this.strictMode||console.error("You are are attempting to use a call instance that was previously destroyed, which is unsupported. Please remove `strictMode: false` from your constructor properties to enable strict mode to track down and fix this unsupported usage.");else{var d={action:Vn,level:"error",code:this.strictMode?9995:9997};this._messageChannel.sendMessageToCallMachine(d,null,this.callClientId,this._iframe)}}},{key:"_logDuplicateInstanceAttempt",value:function(){for(var o=0,f=Object.values(Mt);o<f.length;o++){var d=f[o];d._callMachineInitialized?(d.sendMessageToCallMachine({action:Vn,level:"warn",code:this.allowMultipleCallInstances?9993:9992}),d._delayDuplicateInstanceLog=!1):d._delayDuplicateInstanceLog=!0}}},{key:"_maybeSendToSentry",value:function(o){var f,d,p,g;if(!((f=o.error)!==null&&f!==void 0&&f.type&&(![Ju,qu,Ma].includes(o.error.type)||o.error.type===Ma&&o.error.msg.includes("deleted")))){var b=(d=this.properties)!==null&&d!==void 0&&d.url?new URL(this.properties.url):void 0,O="production";b&&b.host.includes(".staging.daily")&&(O="staging");var A,L,q,G,Je,wt=function(fn){const hn=[ou(),su(),xu(),Iu(),ju(),$u(),du(),Fu()];return fn.autoSessionTracking!==!1&&hn.push(Bu()),hn}({}).filter(function(fn){return!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(fn.name)}),un=new bu({dsn:"https://f10f1c81e5d44a4098416c0867a8b740@o77906.ingest.sentry.io/168844",transport:Eu,stackParser:Pu,integrations:wt,environment:O}),le=new pt;if(le.setClient(un),un.init(),this.session_id&&le.setExtra("sessionId",this.session_id),this.properties){var Oe=R({},this.properties);Oe.userName=Oe.userName?"[Filtered]":void 0,Oe.userData=Oe.userData?"[Filtered]":void 0,Oe.token=Oe.token?"[Filtered]":void 0,le.setExtra("properties",Oe)}if(b){var kt=b.searchParams.get("domain");if(!kt){var dn=b.host.match(/(.*?)\./);kt=dn&&dn[1]||""}kt&&le.setTag("domain",kt)}o.error&&(le.setTag("fatalErrorType",o.error.type),le.setExtra("errorDetails",o.error.details),!((A=o.error.details)===null||A===void 0)&&A.uri&&le.setTag("serverAddress",o.error.details.uri),!((L=o.error.details)===null||L===void 0)&&L.workerGroup&&le.setTag("workerGroup",o.error.details.workerGroup),!((q=o.error.details)===null||q===void 0)&&q.geoGroup&&le.setTag("geoGroup",o.error.details.geoGroup),!((G=o.error.details)===null||G===void 0)&&G.on&&le.setTag("connectionAttempt",o.error.details.on),(Je=o.error.details)!==null&&Je!==void 0&&Je.bundleUrl&&(le.setTag("bundleUrl",o.error.details.bundleUrl),le.setTag("bundleError",o.error.details.sourceError.type))),le.setTags({callMode:this._callObjectMode?K()?"reactNative":(p=this.properties)!==null&&p!==void 0&&(p=p.dailyConfig)!==null&&p!==void 0&&(p=p.callMode)!==null&&p!==void 0&&p.includes("prebuilt")?this.properties.dailyConfig.callMode:"custom":"prebuilt-frame",version:n.version()});var An=((g=o.error)===null||g===void 0?void 0:g.msg)||o.errorMsg;le.captureException(new Error(An))}}},{key:"_callMachine",value:function(){var o;return(o=window._daily)===null||o===void 0||(o=o.instances)===null||o===void 0||(o=o[this.callClientId])===null||o===void 0?void 0:o.callMachine}},{key:"_maybeUpdateInputSettings",value:function(o){if(!be(this._inputSettings,o)){var f=this._getInputSettings();this._inputSettings=o;var d=this._getInputSettings();be(f,d)||this.emitDailyJSEvent({action:Aa,inputSettings:d})}}}],[{key:"supportedBrowser",value:function(){if(K())return{supported:!0,mobile:!0,name:"React Native",version:null,supportsScreenShare:!0,supportsSfu:!0,supportsVideoProcessing:!1,supportsAudioProcessing:!1};var o=Cl.getParser(Ne());return{supported:!!Ba(),mobile:o.getPlatformType()==="mobile",name:o.getBrowserName(),version:o.getBrowserVersion(),supportsFullscreen:!!Da(),supportsScreenShare:!!Wd(),supportsSfu:!!Ba(),supportsVideoProcessing:cc(),supportsAudioProcessing:lc()}}},{key:"version",value:function(){return"0.79.0"}},{key:"createCallObject",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return o.layout="none",new n(null,o)}},{key:"wrap",value:function(o){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(J(),!o||!o.contentWindow||typeof o.src!="string")throw new Error("DailyIframe::Wrap needs an iframe-like first argument");return f.layout||(f.customLayout?f.layout="custom-v1":f.layout="browser"),new n(o,f)}},{key:"createFrame",value:function(o,f){var d,p;J(),o&&f?(d=o,p=f):o&&o.append?(d=o,p={}):(d=document.body,p=o||{});var g=p.iframeStyle;g||(g=d===document.body?{position:"fixed",border:"1px solid black",backgroundColor:"white",width:"375px",height:"450px",right:"1em",bottom:"1em"}:{border:0,width:"100%",height:"100%"});var b=document.createElement("iframe");window.navigator&&window.navigator.userAgent.match(/Chrome\/61\./)?b.allow="microphone, camera":b.allow="microphone; camera; autoplay; display-capture; screen-wake-lock",b.style.visibility="hidden",d.appendChild(b),b.style.visibility=null,Object.keys(g).forEach(function(O){return b.style[O]=g[O]}),p.layout||(p.customLayout?p.layout="custom-v1":p.layout="browser");try{return new n(b,p)}catch(O){throw d.removeChild(b),O}}},{key:"createTransparentFrame",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};J();var f=document.createElement("iframe");return f.allow="microphone; camera; autoplay",f.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      pointer-events: none;
    `,document.body.appendChild(f),o.layout||(o.layout="custom-v1"),n.wrap(f,o)}},{key:"getCallInstance",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return o?Mt[o]:Object.values(Mt)[0]}}]);var e,t,r,i,s,a,c,l,u,h,m,v,_,y,k,P,N,B,D,T,w,C,I,x,V,F,se,xe,qe,gt,vt,an,yt,on,bt,cn,_t,ln}();function Ut(n,e){var t={};for(var r in n)if(n[r]instanceof MediaStreamTrack)console.warn("MediaStreamTrack found in props or cache.",r),t[r]=tt;else if(r==="dailyConfig"){if(n[r].modifyLocalSdpHook){var i=window._daily.instances[e].customCallbacks||{};i.modifyLocalSdpHook=n[r].modifyLocalSdpHook,window._daily.instances[e].customCallbacks=i,delete n[r].modifyLocalSdpHook}if(n[r].modifyRemoteSdpHook){var s=window._daily.instances[e].customCallbacks||{};s.modifyRemoteSdpHook=n[r].modifyRemoteSdpHook,window._daily.instances[e].customCallbacks=s,delete n[r].modifyRemoteSdpHook}t[r]=n[r]}else t[r]=n[r];return t}function ne(n){var e=arguments.length>2?arguments[2]:void 0;if(n!==At){var t="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," only supported after join.");throw e&&(t+=" ".concat(e)),console.error(t),new Error(t)}}function er(n,e){return[_i,At].includes(n)||e}function Gr(n,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"This daily-js method",r=arguments.length>3?arguments[3]:void 0;if(er(n,e)){var i="".concat(t," not supported after joining a meeting.");throw r&&(i+=" ".concat(r)),console.error(i),new Error(i)}}function Jn(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method",t=arguments.length>2?arguments[2]:void 0;if(!n){var r="".concat(e,arguments.length>3&&arguments[3]!==void 0&&arguments[3]?" requires preAuth() or startCamera() to initialize call state.":" requires preAuth(), startCamera(), or join() to initialize call state.");throw t&&(r+=" ".concat(t)),console.error(r),new Error(r)}}function Kr(n){if(n){var e="A pre-call quality test is in progress. Please try ".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," again once testing has completed. Use stopTestCallQuality() to end it early.");throw console.error(e),new Error(e)}}function Le(n){if(!n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported on custom callObject instances");throw console.error(e),new Error(e)}}function Ee(n){if(n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported as part of Daily's Prebuilt");throw console.error(e),new Error(e)}}function J(){if(K())throw new Error("This daily-js method is not currently supported in React Native")}function mn(){if(!K())throw new Error("This daily-js method is only supported in React Native")}function wc(n){if(n===void 0)return!0;var e;if(typeof n=="string")e=n;else try{e=JSON.stringify(n),be(JSON.parse(e),n)||console.warn("The userData provided will be modified when serialized.")}catch(t){throw Error("userData must be serializable to JSON: ".concat(t))}if(e.length>4096)throw Error("userData is too large (".concat(e.length," characters). Maximum size suppported is ").concat(4096,"."));return!0}function kc(n,e){for(var t=e.allowAllParticipantsKey,r=function(m){var v=["local"];return t||v.push("*"),m&&!v.includes(m)},i=function(m){return!!(m.layer===void 0||Number.isInteger(m.layer)&&m.layer>=0||m.layer==="inherit")},s=function(m){return!!m&&!(m.video&&!i(m.video))&&!(m.screenVideo&&!i(m.screenVideo))},a=0,c=Object.entries(n);a<c.length;a++){var l=we(c[a],2),u=l[0],h=l[1];if(!r(u)||!s(h))return!1}return!0}function Sc(n){if(H(n)!=="object")return!1;for(var e=0,t=Object.entries(n);e<t.length;e++){var r=we(t[e],2),i=r[0],s=r[1];switch(i){case"video":if(H(s)!=="object")return!1;for(var a=0,c=Object.entries(s);a<c.length;a++){var l=we(c[a],2),u=l[0],h=l[1];switch(u){case"processor":if(!bf(h))return!1;break;case"settings":if(!co(h))return!1;break;default:return!1}}break;case"audio":if(H(s)!=="object")return!1;for(var m=0,v=Object.entries(s);m<v.length;m++){var _=we(v[m],2),y=_[0],k=_[1];switch(y){case"processor":if(!yf(k))return!1;break;case"settings":if(!co(k))return!1;break;default:return!1}}break;default:return!1}}return!0}function Ec(n,e,t){var r,i=[];n.video&&n.video.processor&&(cc((r=e==null?void 0:e.useLegacyVideoProcessor)!==null&&r!==void 0&&r)||(n.video.settings?delete n.video.processor:delete n.video,i.push("video"))),n.audio&&n.audio.processor&&(lc()||(n.audio.settings?delete n.audio.processor:delete n.audio,i.push("audio"))),i.length>0&&console.error("Ignoring settings for browser- or platform-unsupported input processor(s): ".concat(i.join(", "))),n.audio&&n.audio.settings&&(n.audio.settings.customTrack?(t.audioTrack=n.audio.settings.customTrack,n.audio.settings={customTrack:tt}):delete t.audioTrack),n.video&&n.video.settings&&(n.video.settings.customTrack?(t.videoTrack=n.video.settings.customTrack,n.video.settings={customTrack:tt}):delete t.videoTrack)}function yf(n){if(K())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type"];return!!n&&H(n)==="object"&&(Object.keys(n).filter(function(t){return!e.includes(t)}).forEach(function(t){console.warn("invalid key inputSettings -> audio -> processor : ".concat(t)),delete n[t]}),!!function(t){return typeof t!="string"?!1:Object.values(ac).includes(t)?!0:(console.error("inputSettings audio processor type invalid"),!1)}(n.type))}function bf(n){if(K())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type","config"];return!n||H(n)!=="object"||!function(t){return typeof t!="string"?!1:Object.values(Zn).includes(t)?!0:(console.error("inputSettings video processor type invalid"),!1)}(n.type)||n.config&&(H(n.config)!=="object"||!function(t,r){var i=Object.keys(r);if(i.length===0)return!0;var s="invalid object in inputSettings -> video -> processor -> config";switch(t){case Zn.BGBLUR:return i.length>1||i[0]!=="strength"?(console.error(s),!1):!(typeof r.strength!="number"||r.strength<=0||r.strength>1||isNaN(r.strength))||(console.error("".concat(s,"; expected: {0 < strength <= 1}, got: ").concat(r.strength)),!1);case Zn.BGIMAGE:return!(r.source!==void 0&&!function(a){if(a.source==="default")return a.type="default",!0;if(a.source instanceof ArrayBuffer)return!0;if(rr(a.source))return a.type="url",!!function(u){var h=new URL(u),m=h.pathname;if(h.protocol==="data:")try{var v=m.substring(m.indexOf(":")+1,m.indexOf(";")).split("/")[1];return Wr.includes(v)}catch(y){return console.error("failed to deduce blob content type",y),!1}var _=m.split(".").at(-1).toLowerCase().trim();return Wr.includes(_)}(a.source)||(console.error("invalid image type; supported types: [".concat(Wr.join(", "),"]")),!1);return c=a.source,l=Number(c),isNaN(l)||!Number.isInteger(l)||l<=0||l>10?(console.error("invalid image selection; must be an int, > 0, <= ".concat(10)),!1):(a.type="daily-preselect",!0);var c,l}(r));default:return!0}}(n.type,n.config))?!1:(Object.keys(n).filter(function(t){return!e.includes(t)}).forEach(function(t){console.warn("invalid key inputSettings -> video -> processor : ".concat(t)),delete n[t]}),!0)}function co(n){return H(n)==="object"&&(!n.customTrack||n.customTrack instanceof MediaStreamTrack)}function Ci(){var n=Object.values(Zn).join(" | "),e=Object.values(ac).join(" | ");return"inputSettings must be of the form: { video?: { processor?: { type: [ ".concat(n," ], config?: {} } }, audio?: { processor: {type: [ ").concat(e," ] } } }")}function Mc(n){var e=n.allowAllParticipantsKey;return"receiveSettings must be of the form { [<remote participant id> | ".concat(Wu).concat(e?' | "'.concat("*",'"'):"","]: ")+'{ [video: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]], [screenVideo: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]] }}}'}function Tc(){return"customIntegrations should be an object of type ".concat(JSON.stringify(Ti),".")}function Cc(n){if(n&&H(n)!=="object"||Array.isArray(n))return console.error("customTrayButtons should be an Object of the type ".concat(JSON.stringify(ur),".")),!1;if(n)for(var e=0,t=Object.entries(n);e<t.length;e++)for(var r=we(t[e],1)[0],i=0,s=Object.entries(n[r]);i<s.length;i++){var a=we(s[i],2),c=a[0],l=a[1],u=ur.id[c];if(!u)return console.error("customTrayButton does not support key ".concat(c)),!1;switch(c){case"iconPath":case"iconPathDarkMode":if(!rr(l))return console.error("customTrayButton ".concat(c," should be a url.")),!1;break;case"visualState":if(!["default","sidebar-open","active"].includes(l))return console.error("customTrayButton ".concat(c," should be ").concat(u,". Got: ").concat(l)),!1;break;default:if(H(l)!==u)return console.error("customTrayButton ".concat(c," should be a ").concat(u,".")),!1}}return!0}function Oc(n){if(!n||n&&H(n)!=="object"||Array.isArray(n))return console.error(Tc()),!1;for(var e=function(m){return"".concat(m," should be ").concat(Ti.id[m])},t=function(m,v){return console.error("customIntegration ".concat(m,": ").concat(v))},r=0,i=Object.entries(n);r<i.length;r++){var s=we(i[r],1)[0];if(!("label"in n[s]))return t(s,"label is required"),!1;if(!("location"in n[s]))return t(s,"location is required"),!1;if(!("src"in n[s])&&!("srcdoc"in n[s]))return t(s,"src or srcdoc is required"),!1;for(var a=0,c=Object.entries(n[s]);a<c.length;a++){var l=we(c[a],2),u=l[0],h=l[1];switch(u){case"allow":case"csp":case"name":case"referrerPolicy":case"sandbox":if(typeof h!="string")return t(s,e(u)),!1;break;case"iconURL":if(!rr(h))return t(s,"".concat(u," should be a url")),!1;break;case"src":if("srcdoc"in n[s])return t(s,"cannot have both src and srcdoc"),!1;if(!rr(h))return t(s,'src "'.concat(h,'" is not a valid URL')),!1;break;case"srcdoc":if("src"in n[s])return t(s,"cannot have both src and srcdoc"),!1;if(typeof h!="string")return t(s,e(u)),!1;break;case"location":if(!["main","sidebar"].includes(h))return t(s,e(u)),!1;break;case"controlledBy":if(h!=="*"&&h!=="owners"&&(!Array.isArray(h)||h.some(function(m){return typeof m!="string"})))return t(s,e(u)),!1;break;case"shared":if((!Array.isArray(h)||h.some(function(m){return typeof m!="string"}))&&h!=="owners"&&typeof h!="boolean")return t(s,e(u)),!1;break;default:if(!Ti.id[u])return console.error("customIntegration does not support key ".concat(u)),!1}}}return!0}function Ac(n,e){if(e===void 0)return!1;switch(H(e)){case"string":return H(n)===e;case"object":if(H(n)!=="object")return!1;for(var t in n)if(!Ac(n[t],e[t]))return!1;return!0;default:return!1}}function lo(n,e){var t=n.sessionId,r=n.toEndPoint,i=n.callerId,s=n.useSipRefer;if(!t||!r)throw new Error("".concat(e,"() requires a sessionId and toEndPoint"));if(typeof t!="string"||typeof r!="string")throw new Error("Invalid paramater: sessionId and toEndPoint must be of type string");if(s&&!r.startsWith("sip:"))throw new Error('"toEndPoint" must be a "sip" address');if(!r.startsWith("sip:")&&!r.startsWith("+"))throw new Error("toEndPoint: ".concat(r,' must starts with either "sip:" or "+"'));if(i&&typeof i!="string")throw new Error("callerId must be of type string");if(i&&!r.startsWith("+"))throw new Error("callerId is only valid when transferring to a PSTN number")}function uo(n){if(H(n)!=="object")throw new Error('RemoteMediaPlayerSettings: must be "object" type');if(n.state&&!Object.values(wi).includes(n.state))throw new Error("Invalid value for RemoteMediaPlayerSettings.state, valid values are: "+JSON.stringify(wi));if(n.volume){if(typeof n.volume!="number")throw new Error('RemoteMediaPlayerSettings.volume: must be "number" type');if(n.volume<0||n.volume>2)throw new Error("RemoteMediaPlayerSettings.volume: must be between 0.0 - 2.0")}}function fo(n,e,t){return!(typeof n!="number"||n<e||n>t)}function Qr(n,e){return n&&!e&&delete n.data,n}function Pc(n){let e=typeof n;if(e=="object"){if(Array.isArray(n))return"array";if(n===null)return"null"}return e}function _f(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}let Ze="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Or=[];for(let n=0;n<Ze.length;n++)Or[Ze[n].charCodeAt(0)]=n;Or[45]=Ze.indexOf("+");Or[95]=Ze.indexOf("/");function wf(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,i=0,s,a=0;for(let c=0;c<n.length;c++){if(s=Or[n.charCodeAt(c)],s===void 0)switch(n[c]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:a=s,i=1;break;case 1:t[r++]=a<<2|(s&48)>>4,a=s,i=2;break;case 2:t[r++]=(a&15)<<4|(s&60)>>2,a=s,i=3;break;case 3:t[r++]=(a&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return t.subarray(0,r)}function kf(n){let e="",t=0,r,i=0;for(let s=0;s<n.length;s++)switch(r=n[s],t){case 0:e+=Ze[r>>2],i=(r&3)<<4,t=1;break;case 1:e+=Ze[i|r>>4],i=(r&15)<<2,t=2;break;case 2:e+=Ze[i|r>>6],e+=Ze[r&63],t=0;break}return t&&(e+=Ze[i],e+="=",t==1&&(e+="=")),e}var Se;(function(n){n.symbol=Symbol.for("protobuf-ts/unknown"),n.onRead=(t,r,i,s,a)=>{(e(r)?r[n.symbol]:r[n.symbol]=[]).push({no:i,wireType:s,data:a})},n.onWrite=(t,r,i)=>{for(let{no:s,wireType:a,data:c}of n.list(r))i.tag(s,a).raw(c)},n.list=(t,r)=>{if(e(t)){let i=t[n.symbol];return r?i.filter(s=>s.no==r):i}return[]},n.last=(t,r)=>n.list(t,r).slice(-1)[0];const e=t=>t&&Array.isArray(t[n.symbol])})(Se||(Se={}));var W;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(W||(W={}));function Sf(){let n=0,e=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(n|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(e|=(i&127)<<r,(i&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Hr(n,e,t){for(let s=0;s<28;s=s+7){const a=n>>>s,c=!(!(a>>>7)&&e==0),l=(c?a|128:a)&255;if(t.push(l),!c)return}const r=n>>>28&15|(e&7)<<4,i=e>>3!=0;if(t.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const a=e>>>s,c=!!(a>>>7),l=(c?a|128:a)&255;if(t.push(l),!c)return}t.push(e>>>31&1)}}const tr=65536*65536;function Ic(n){let e=n[0]=="-";e&&(n=n.slice(1));const t=1e6;let r=0,i=0;function s(a,c){const l=Number(n.slice(a,c));i*=t,r=r*t+l,r>=tr&&(i=i+(r/tr|0),r=r%tr)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),[e,r,i]}function Oi(n,e){if(e>>>0<=2097151)return""+(tr*e+(n>>>0));let t=n&16777215,r=(n>>>24|e<<8)>>>0&16777215,i=e>>16&65535,s=t+r*6777216+i*6710656,a=r+i*8147497,c=i*2,l=1e7;s>=l&&(a+=Math.floor(s/l),s%=l),a>=l&&(c+=Math.floor(a/l),a%=l);function u(h,m){let v=h?String(h):"";return m?"0000000".slice(v.length)+v:v}return u(c,0)+u(a,c)+u(s,1)}function ho(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Ef(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}let re;function Mf(){const n=new DataView(new ArrayBuffer(8));re=globalThis.BigInt!==void 0&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"?{MIN:BigInt("-9223372036854775808"),MAX:BigInt("9223372036854775807"),UMIN:BigInt("0"),UMAX:BigInt("18446744073709551615"),C:BigInt,V:n}:void 0}Mf();function Nc(n){if(!n)throw new Error("BigInt unavailable, see https://github.com/timostamm/protobuf-ts/blob/v1.0.8/MANUAL.md#bigint-support")}const xc=/^-?[0-9]+$/,dr=4294967296,zn=2147483648;class Lc{constructor(e,t){this.lo=e|0,this.hi=t|0}isZero(){return this.lo==0&&this.hi==0}toNumber(){let e=this.hi*dr+(this.lo>>>0);if(!Number.isSafeInteger(e))throw new Error("cannot convert to safe number");return e}}class me extends Lc{static from(e){if(re)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=re.C(e);case"number":if(e===0)return this.ZERO;e=re.C(e);case"bigint":if(!e)return this.ZERO;if(e<re.UMIN)throw new Error("signed value for ulong");if(e>re.UMAX)throw new Error("ulong too large");return re.V.setBigUint64(0,e,!0),new me(re.V.getInt32(0,!0),re.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!xc.test(e))throw new Error("string is no integer");let[t,r,i]=Ic(e);if(t)throw new Error("signed value for ulong");return new me(r,i);case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");if(e<0)throw new Error("signed value for ulong");return new me(e,e/dr)}throw new Error("unknown value "+typeof e)}toString(){return re?this.toBigInt().toString():Oi(this.lo,this.hi)}toBigInt(){return Nc(re),re.V.setInt32(0,this.lo,!0),re.V.setInt32(4,this.hi,!0),re.V.getBigUint64(0,!0)}}me.ZERO=new me(0,0);class ce extends Lc{static from(e){if(re)switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=="")throw new Error("string is no integer");e=re.C(e);case"number":if(e===0)return this.ZERO;e=re.C(e);case"bigint":if(!e)return this.ZERO;if(e<re.MIN)throw new Error("signed long too small");if(e>re.MAX)throw new Error("signed long too large");return re.V.setBigInt64(0,e,!0),new ce(re.V.getInt32(0,!0),re.V.getInt32(4,!0))}else switch(typeof e){case"string":if(e=="0")return this.ZERO;if(e=e.trim(),!xc.test(e))throw new Error("string is no integer");let[t,r,i]=Ic(e);if(t){if(i>zn||i==zn&&r!=0)throw new Error("signed long too small")}else if(i>=zn)throw new Error("signed long too large");let s=new ce(r,i);return t?s.negate():s;case"number":if(e==0)return this.ZERO;if(!Number.isSafeInteger(e))throw new Error("number is no integer");return e>0?new ce(e,e/dr):new ce(-e,-e/dr).negate()}throw new Error("unknown value "+typeof e)}isNegative(){return(this.hi&zn)!==0}negate(){let e=~this.hi,t=this.lo;return t?t=~t+1:e+=1,new ce(t,e)}toString(){if(re)return this.toBigInt().toString();if(this.isNegative()){let e=this.negate();return"-"+Oi(e.lo,e.hi)}return Oi(this.lo,this.hi)}toBigInt(){return Nc(re),re.V.setInt32(0,this.lo,!0),re.V.setInt32(4,this.hi,!0),re.V.getBigInt64(0,!0)}}ce.ZERO=new ce(0,0);const po={readUnknownField:!0,readerFactory:n=>new Cf(n)};function Tf(n){return n?Object.assign(Object.assign({},po),n):po}class Cf{constructor(e,t){this.varint64=Sf,this.uint32=Ef,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0})}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e){let t=this.pos;switch(e){case W.Varint:for(;this.buf[this.pos++]&128;);break;case W.Bit64:this.pos+=4;case W.Bit32:this.pos+=4;break;case W.LengthDelimited:let r=this.uint32();this.pos+=r;break;case W.StartGroup:let i;for(;(i=this.tag()[1])!==W.EndGroup;)this.skip(i);break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(t,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return new ce(...this.varint64())}uint64(){return new me(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,new ce(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return new me(this.sfixed32(),this.sfixed32())}sfixed64(){return new ce(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function X(n,e){if(!n)throw new Error(e)}const Of=34028234663852886e22,Af=-34028234663852886e22,Pf=4294967295,If=2147483647,Nf=-2147483648;function kn(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>If||n<Nf)throw new Error("invalid int 32: "+n)}function fr(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>Pf||n<0)throw new Error("invalid uint 32: "+n)}function Ki(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Of||n<Af))throw new Error("invalid float 32: "+n)}const mo={writeUnknownFields:!0,writerFactory:()=>new Lf};function xf(n){return n?Object.assign(Object.assign({},mo),n):mo}class Lf{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let i=0;i<this.chunks.length;i++)e+=this.chunks[i].length;let t=new Uint8Array(e),r=0;for(let i=0;i<this.chunks.length;i++)t.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(fr(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return kn(e),ho(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){Ki(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){fr(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){kn(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return kn(e),e=(e<<1^e>>31)>>>0,ho(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=ce.from(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),i=me.from(e);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(t)}int64(e){let t=ce.from(e);return Hr(t.lo,t.hi,this.buf),this}sint64(e){let t=ce.from(e),r=t.hi>>31,i=t.lo<<1^r,s=(t.hi<<1|t.lo>>>31)^r;return Hr(i,s,this.buf),this}uint64(e){let t=me.from(e);return Hr(t.lo,t.hi,this.buf),this}}const go={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0},vo={ignoreUnknownFields:!1};function Rf(n){return n?Object.assign(Object.assign({},vo),n):vo}function Df(n){return n?Object.assign(Object.assign({},go),n):go}const Rc=Symbol.for("protobuf-ts/message-type");function yo(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let i=n.charAt(r);i=="_"?e=!0:/\d/.test(i)?(t.push(i),e=!0):e?(t.push(i.toUpperCase()),e=!1):r==0?t.push(i.toLowerCase()):t.push(i)}return t.join("")}var S;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(S||(S={}));var He;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING",n[n.NUMBER=2]="NUMBER"})(He||(He={}));var hr;(function(n){n[n.NO=0]="NO",n[n.PACKED=1]="PACKED",n[n.UNPACKED=2]="UNPACKED"})(hr||(hr={}));function Bf(n){var e,t,r,i;return n.localName=(e=n.localName)!==null&&e!==void 0?e:yo(n.name),n.jsonName=(t=n.jsonName)!==null&&t!==void 0?t:yo(n.name),n.repeat=(r=n.repeat)!==null&&r!==void 0?r:hr.NO,n.opt=(i=n.opt)!==null&&i!==void 0?i:n.repeat||n.oneof?!1:n.kind=="message",n}function jf(n){if(typeof n!="object"||n===null||!n.hasOwnProperty("oneofKind"))return!1;switch(typeof n.oneofKind){case"string":return n[n.oneofKind]===void 0?!1:Object.keys(n).length==2;case"undefined":return Object.keys(n).length==1;default:return!1}}class Ff{constructor(e){var t;this.fields=(t=e.fields)!==null&&t!==void 0?t:[]}prepare(){if(this.data)return;const e=[],t=[],r=[];for(let i of this.fields)if(i.oneof)r.includes(i.oneof)||(r.push(i.oneof),e.push(i.oneof),t.push(i.oneof));else switch(t.push(i.localName),i.kind){case"scalar":case"enum":(!i.opt||i.repeat)&&e.push(i.localName);break;case"message":i.repeat&&e.push(i.localName);break;case"map":e.push(i.localName);break}this.data={req:e,known:t,oneofs:Object.values(r)}}is(e,t,r=!1){if(t<0)return!0;if(e==null||typeof e!="object")return!1;this.prepare();let i=Object.keys(e),s=this.data;if(i.length<s.req.length||s.req.some(a=>!i.includes(a))||!r&&i.some(a=>!s.known.includes(a)))return!1;if(t<1)return!0;for(const a of s.oneofs){const c=e[a];if(!jf(c))return!1;if(c.oneofKind===void 0)continue;const l=this.fields.find(u=>u.localName===c.oneofKind);if(!l||!this.field(c[c.oneofKind],l,r,t))return!1}for(const a of this.fields)if(a.oneof===void 0&&!this.field(e[a.localName],a,r,t))return!1;return!0}field(e,t,r,i){let s=t.repeat;switch(t.kind){case"scalar":return e===void 0?t.opt:s?this.scalars(e,t.T,i,t.L):this.scalar(e,t.T,t.L);case"enum":return e===void 0?t.opt:s?this.scalars(e,S.INT32,i):this.scalar(e,S.INT32);case"message":return e===void 0?!0:s?this.messages(e,t.T(),r,i):this.message(e,t.T(),r,i);case"map":if(typeof e!="object"||e===null)return!1;if(i<2)return!0;if(!this.mapKeys(e,t.K,i))return!1;switch(t.V.kind){case"scalar":return this.scalars(Object.values(e),t.V.T,i,t.V.L);case"enum":return this.scalars(Object.values(e),S.INT32,i);case"message":return this.messages(Object.values(e),t.V.T(),r,i)}break}return!0}message(e,t,r,i){return r?t.isAssignable(e,i):t.is(e,i)}messages(e,t,r,i){if(!Array.isArray(e))return!1;if(i<2)return!0;if(r){for(let s=0;s<e.length&&s<i;s++)if(!t.isAssignable(e[s],i-1))return!1}else for(let s=0;s<e.length&&s<i;s++)if(!t.is(e[s],i-1))return!1;return!0}scalar(e,t,r){let i=typeof e;switch(t){case S.UINT64:case S.FIXED64:case S.INT64:case S.SFIXED64:case S.SINT64:switch(r){case He.BIGINT:return i=="bigint";case He.NUMBER:return i=="number"&&!isNaN(e);default:return i=="string"}case S.BOOL:return i=="boolean";case S.STRING:return i=="string";case S.BYTES:return e instanceof Uint8Array;case S.DOUBLE:case S.FLOAT:return i=="number"&&!isNaN(e);default:return i=="number"&&Number.isInteger(e)}}scalars(e,t,r,i){if(!Array.isArray(e))return!1;if(r<2)return!0;if(Array.isArray(e)){for(let s=0;s<e.length&&s<r;s++)if(!this.scalar(e[s],t,i))return!1}return!0}mapKeys(e,t,r){let i=Object.keys(e);switch(t){case S.INT32:case S.FIXED32:case S.SFIXED32:case S.SINT32:case S.UINT32:return this.scalars(i.slice(0,r).map(s=>parseInt(s)),t,r);case S.BOOL:return this.scalars(i.slice(0,r).map(s=>s=="true"?!0:s=="false"?!1:s),t,r);default:return this.scalars(i,t,r,He.STRING)}}}function Fe(n,e){switch(e){case He.BIGINT:return n.toBigInt();case He.NUMBER:return n.toNumber();default:return n.toString()}}class $f{constructor(e){this.info=e}prepare(){var e;if(this.fMap===void 0){this.fMap={};const t=(e=this.info.fields)!==null&&e!==void 0?e:[];for(const r of t)this.fMap[r.name]=r,this.fMap[r.jsonName]=r,this.fMap[r.localName]=r}}assert(e,t,r){if(!e){let i=Pc(r);throw(i=="number"||i=="boolean")&&(i=r.toString()),new Error(`Cannot parse JSON ${i} for ${this.info.typeName}#${t}`)}}read(e,t,r){this.prepare();const i=[];for(const[s,a]of Object.entries(e)){const c=this.fMap[s];if(!c){if(!r.ignoreUnknownFields)throw new Error(`Found unknown field while reading ${this.info.typeName} from JSON format. JSON key: ${s}`);continue}const l=c.localName;let u;if(c.oneof){if(a===null&&(c.kind!=="enum"||c.T()[0]!=="google.protobuf.NullValue"))continue;if(i.includes(c.oneof))throw new Error(`Multiple members of the oneof group "${c.oneof}" of ${this.info.typeName} are present in JSON.`);i.push(c.oneof),u=t[c.oneof]={oneofKind:l}}else u=t;if(c.kind=="map"){if(a===null)continue;this.assert(_f(a),c.name,a);const h=u[l];for(const[m,v]of Object.entries(a)){this.assert(v!==null,c.name+" map value",null);let _;switch(c.V.kind){case"message":_=c.V.T().internalJsonRead(v,r);break;case"enum":if(_=this.enum(c.V.T(),v,c.name,r.ignoreUnknownFields),_===!1)continue;break;case"scalar":_=this.scalar(v,c.V.T,c.V.L,c.name);break}this.assert(_!==void 0,c.name+" map value",v);let y=m;c.K==S.BOOL&&(y=y=="true"?!0:y=="false"?!1:y),y=this.scalar(y,c.K,He.STRING,c.name).toString(),h[y]=_}}else if(c.repeat){if(a===null)continue;this.assert(Array.isArray(a),c.name,a);const h=u[l];for(const m of a){this.assert(m!==null,c.name,null);let v;switch(c.kind){case"message":v=c.T().internalJsonRead(m,r);break;case"enum":if(v=this.enum(c.T(),m,c.name,r.ignoreUnknownFields),v===!1)continue;break;case"scalar":v=this.scalar(m,c.T,c.L,c.name);break}this.assert(v!==void 0,c.name,a),h.push(v)}}else switch(c.kind){case"message":if(a===null&&c.T().typeName!="google.protobuf.Value"){this.assert(c.oneof===void 0,c.name+" (oneof member)",null);continue}u[l]=c.T().internalJsonRead(a,r,u[l]);break;case"enum":if(a===null)continue;let h=this.enum(c.T(),a,c.name,r.ignoreUnknownFields);if(h===!1)continue;u[l]=h;break;case"scalar":if(a===null)continue;u[l]=this.scalar(a,c.T,c.L,c.name);break}}}enum(e,t,r,i){if(e[0]=="google.protobuf.NullValue"&&X(t===null||t==="NULL_VALUE",`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} only accepts null.`),t===null)return 0;switch(typeof t){case"number":return X(Number.isInteger(t),`Unable to parse field ${this.info.typeName}#${r}, enum can only be integral number, got ${t}.`),t;case"string":let s=t;e[2]&&t.substring(0,e[2].length)===e[2]&&(s=t.substring(e[2].length));let a=e[1][s];return typeof a>"u"&&i?!1:(X(typeof a=="number",`Unable to parse field ${this.info.typeName}#${r}, enum ${e[0]} has no value for "${t}".`),a)}X(!1,`Unable to parse field ${this.info.typeName}#${r}, cannot parse enum value from ${typeof t}".`)}scalar(e,t,r,i){let s;try{switch(t){case S.DOUBLE:case S.FLOAT:if(e===null)return 0;if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""){s="empty string";break}if(typeof e=="string"&&e.trim().length!==e.length){s="extra whitespace";break}if(typeof e!="string"&&typeof e!="number")break;let a=Number(e);if(Number.isNaN(a)){s="not a number";break}if(!Number.isFinite(a)){s="too large or small";break}return t==S.FLOAT&&Ki(a),a;case S.INT32:case S.FIXED32:case S.SFIXED32:case S.SINT32:case S.UINT32:if(e===null)return 0;let c;if(typeof e=="number"?c=e:e===""?s="empty string":typeof e=="string"&&(e.trim().length!==e.length?s="extra whitespace":c=Number(e)),c===void 0)break;return t==S.UINT32?fr(c):kn(c),c;case S.INT64:case S.SFIXED64:case S.SINT64:if(e===null)return Fe(ce.ZERO,r);if(typeof e!="number"&&typeof e!="string")break;return Fe(ce.from(e),r);case S.FIXED64:case S.UINT64:if(e===null)return Fe(me.ZERO,r);if(typeof e!="number"&&typeof e!="string")break;return Fe(me.from(e),r);case S.BOOL:if(e===null)return!1;if(typeof e!="boolean")break;return e;case S.STRING:if(e===null)return"";if(typeof e!="string"){s="extra whitespace";break}try{encodeURIComponent(e)}catch(l){l="invalid UTF8";break}return e;case S.BYTES:if(e===null||e==="")return new Uint8Array(0);if(typeof e!="string")break;return wf(e)}}catch(a){s=a.message}this.assert(!1,i+(s?" - "+s:""),e)}}class Uf{constructor(e){var t;this.fields=(t=e.fields)!==null&&t!==void 0?t:[]}write(e,t){const r={},i=e;for(const s of this.fields){if(!s.oneof){let u=this.field(s,i[s.localName],t);u!==void 0&&(r[t.useProtoFieldName?s.name:s.jsonName]=u);continue}const a=i[s.oneof];if(a.oneofKind!==s.localName)continue;const c=s.kind=="scalar"||s.kind=="enum"?Object.assign(Object.assign({},t),{emitDefaultValues:!0}):t;let l=this.field(s,a[s.localName],c);X(l!==void 0),r[t.useProtoFieldName?s.name:s.jsonName]=l}return r}field(e,t,r){let i;if(e.kind=="map"){X(typeof t=="object"&&t!==null);const s={};switch(e.V.kind){case"scalar":for(const[l,u]of Object.entries(t)){const h=this.scalar(e.V.T,u,e.name,!1,!0);X(h!==void 0),s[l.toString()]=h}break;case"message":const a=e.V.T();for(const[l,u]of Object.entries(t)){const h=this.message(a,u,e.name,r);X(h!==void 0),s[l.toString()]=h}break;case"enum":const c=e.V.T();for(const[l,u]of Object.entries(t)){X(u===void 0||typeof u=="number");const h=this.enum(c,u,e.name,!1,!0,r.enumAsInteger);X(h!==void 0),s[l.toString()]=h}break}(r.emitDefaultValues||Object.keys(s).length>0)&&(i=s)}else if(e.repeat){X(Array.isArray(t));const s=[];switch(e.kind){case"scalar":for(let l=0;l<t.length;l++){const u=this.scalar(e.T,t[l],e.name,e.opt,!0);X(u!==void 0),s.push(u)}break;case"enum":const a=e.T();for(let l=0;l<t.length;l++){X(t[l]===void 0||typeof t[l]=="number");const u=this.enum(a,t[l],e.name,e.opt,!0,r.enumAsInteger);X(u!==void 0),s.push(u)}break;case"message":const c=e.T();for(let l=0;l<t.length;l++){const u=this.message(c,t[l],e.name,r);X(u!==void 0),s.push(u)}break}(r.emitDefaultValues||s.length>0||r.emitDefaultValues)&&(i=s)}else switch(e.kind){case"scalar":i=this.scalar(e.T,t,e.name,e.opt,r.emitDefaultValues);break;case"enum":i=this.enum(e.T(),t,e.name,e.opt,r.emitDefaultValues,r.enumAsInteger);break;case"message":i=this.message(e.T(),t,e.name,r);break}return i}enum(e,t,r,i,s,a){if(e[0]=="google.protobuf.NullValue")return!s&&!i?void 0:null;if(t===void 0){X(i);return}if(!(t===0&&!s&&!i))return X(typeof t=="number"),X(Number.isInteger(t)),a||!e[1].hasOwnProperty(t)?t:e[2]?e[2]+e[1][t]:e[1][t]}message(e,t,r,i){return t===void 0?i.emitDefaultValues?null:void 0:e.internalJsonWrite(t,i)}scalar(e,t,r,i,s){if(t===void 0){X(i);return}const a=s||i;switch(e){case S.INT32:case S.SFIXED32:case S.SINT32:return t===0?a?0:void 0:(kn(t),t);case S.FIXED32:case S.UINT32:return t===0?a?0:void 0:(fr(t),t);case S.FLOAT:Ki(t);case S.DOUBLE:return t===0?a?0:void 0:(X(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t);case S.STRING:return t===""?a?"":void 0:(X(typeof t=="string"),t);case S.BOOL:return t===!1?a?!1:void 0:(X(typeof t=="boolean"),t);case S.UINT64:case S.FIXED64:X(typeof t=="number"||typeof t=="string"||typeof t=="bigint");let c=me.from(t);return c.isZero()&&!a?void 0:c.toString();case S.INT64:case S.SFIXED64:case S.SINT64:X(typeof t=="number"||typeof t=="string"||typeof t=="bigint");let l=ce.from(t);return l.isZero()&&!a?void 0:l.toString();case S.BYTES:return X(t instanceof Uint8Array),t.byteLength?kf(t):a?"":void 0}}}function Ai(n,e=He.STRING){switch(n){case S.BOOL:return!1;case S.UINT64:case S.FIXED64:return Fe(me.ZERO,e);case S.INT64:case S.SFIXED64:case S.SINT64:return Fe(ce.ZERO,e);case S.DOUBLE:case S.FLOAT:return 0;case S.BYTES:return new Uint8Array(0);case S.STRING:return"";default:return 0}}class Vf{constructor(e){this.info=e}prepare(){var e;if(!this.fieldNoToField){const t=(e=this.info.fields)!==null&&e!==void 0?e:[];this.fieldNoToField=new Map(t.map(r=>[r.no,r]))}}read(e,t,r,i){this.prepare();const s=i===void 0?e.len:e.pos+i;for(;e.pos<s;){const[a,c]=e.tag(),l=this.fieldNoToField.get(a);if(!l){let v=r.readUnknownField;if(v=="throw")throw new Error(`Unknown field ${a} (wire type ${c}) for ${this.info.typeName}`);let _=e.skip(c);v!==!1&&(v===!0?Se.onRead:v)(this.info.typeName,t,a,c,_);continue}let u=t,h=l.repeat,m=l.localName;switch(l.oneof&&(u=u[l.oneof],u.oneofKind!==m&&(u=t[l.oneof]={oneofKind:m})),l.kind){case"scalar":case"enum":let v=l.kind=="enum"?S.INT32:l.T,_=l.kind=="scalar"?l.L:void 0;if(h){let P=u[m];if(c==W.LengthDelimited&&v!=S.STRING&&v!=S.BYTES){let N=e.uint32()+e.pos;for(;e.pos<N;)P.push(this.scalar(e,v,_))}else P.push(this.scalar(e,v,_))}else u[m]=this.scalar(e,v,_);break;case"message":if(h){let P=u[m],N=l.T().internalBinaryRead(e,e.uint32(),r);P.push(N)}else u[m]=l.T().internalBinaryRead(e,e.uint32(),r,u[m]);break;case"map":let[y,k]=this.mapEntry(l,e,r);u[m][y]=k;break}}}mapEntry(e,t,r){let i=t.uint32(),s=t.pos+i,a,c;for(;t.pos<s;){let[l,u]=t.tag();switch(l){case 1:e.K==S.BOOL?a=t.bool().toString():a=this.scalar(t,e.K,He.STRING);break;case 2:switch(e.V.kind){case"scalar":c=this.scalar(t,e.V.T,e.V.L);break;case"enum":c=t.int32();break;case"message":c=e.V.T().internalBinaryRead(t,t.uint32(),r);break}break;default:throw new Error(`Unknown field ${l} (wire type ${u}) in map entry for ${this.info.typeName}#${e.name}`)}}if(a===void 0){let l=Ai(e.K);a=e.K==S.BOOL?l.toString():l}if(c===void 0)switch(e.V.kind){case"scalar":c=Ai(e.V.T,e.V.L);break;case"enum":c=0;break;case"message":c=e.V.T().create();break}return[a,c]}scalar(e,t,r){switch(t){case S.INT32:return e.int32();case S.STRING:return e.string();case S.BOOL:return e.bool();case S.DOUBLE:return e.double();case S.FLOAT:return e.float();case S.INT64:return Fe(e.int64(),r);case S.UINT64:return Fe(e.uint64(),r);case S.FIXED64:return Fe(e.fixed64(),r);case S.FIXED32:return e.fixed32();case S.BYTES:return e.bytes();case S.UINT32:return e.uint32();case S.SFIXED32:return e.sfixed32();case S.SFIXED64:return Fe(e.sfixed64(),r);case S.SINT32:return e.sint32();case S.SINT64:return Fe(e.sint64(),r)}}}class Wf{constructor(e){this.info=e}prepare(){if(!this.fields){const e=this.info.fields?this.info.fields.concat():[];this.fields=e.sort((t,r)=>t.no-r.no)}}write(e,t,r){this.prepare();for(const s of this.fields){let a,c,l=s.repeat,u=s.localName;if(s.oneof){const h=e[s.oneof];if(h.oneofKind!==u)continue;a=h[u],c=!0}else a=e[u],c=!1;switch(s.kind){case"scalar":case"enum":let h=s.kind=="enum"?S.INT32:s.T;if(l)if(X(Array.isArray(a)),l==hr.PACKED)this.packed(t,h,s.no,a);else for(const m of a)this.scalar(t,h,s.no,m,!0);else a===void 0?X(s.opt):this.scalar(t,h,s.no,a,c||s.opt);break;case"message":if(l){X(Array.isArray(a));for(const m of a)this.message(t,r,s.T(),s.no,m)}else this.message(t,r,s.T(),s.no,a);break;case"map":X(typeof a=="object"&&a!==null);for(const[m,v]of Object.entries(a))this.mapEntry(t,r,s,m,v);break}}let i=r.writeUnknownFields;i!==!1&&(i===!0?Se.onWrite:i)(this.info.typeName,e,t)}mapEntry(e,t,r,i,s){e.tag(r.no,W.LengthDelimited),e.fork();let a=i;switch(r.K){case S.INT32:case S.FIXED32:case S.UINT32:case S.SFIXED32:case S.SINT32:a=Number.parseInt(i);break;case S.BOOL:X(i=="true"||i=="false"),a=i=="true";break}switch(this.scalar(e,r.K,1,a,!0),r.V.kind){case"scalar":this.scalar(e,r.V.T,2,s,!0);break;case"enum":this.scalar(e,S.INT32,2,s,!0);break;case"message":this.message(e,t,r.V.T(),2,s);break}e.join()}message(e,t,r,i,s){s!==void 0&&(r.internalBinaryWrite(s,e.tag(i,W.LengthDelimited).fork(),t),e.join())}scalar(e,t,r,i,s){let[a,c,l]=this.scalarInfo(t,i);(!l||s)&&(e.tag(r,a),e[c](i))}packed(e,t,r,i){if(!i.length)return;X(t!==S.BYTES&&t!==S.STRING),e.tag(r,W.LengthDelimited),e.fork();let[,s]=this.scalarInfo(t);for(let a=0;a<i.length;a++)e[s](i[a]);e.join()}scalarInfo(e,t){let r=W.Varint,i,s=t===void 0,a=t===0;switch(e){case S.INT32:i="int32";break;case S.STRING:a=s||!t.length,r=W.LengthDelimited,i="string";break;case S.BOOL:a=t===!1,i="bool";break;case S.UINT32:i="uint32";break;case S.DOUBLE:r=W.Bit64,i="double";break;case S.FLOAT:r=W.Bit32,i="float";break;case S.INT64:a=s||ce.from(t).isZero(),i="int64";break;case S.UINT64:a=s||me.from(t).isZero(),i="uint64";break;case S.FIXED64:a=s||me.from(t).isZero(),r=W.Bit64,i="fixed64";break;case S.BYTES:a=s||!t.byteLength,r=W.LengthDelimited,i="bytes";break;case S.FIXED32:r=W.Bit32,i="fixed32";break;case S.SFIXED32:r=W.Bit32,i="sfixed32";break;case S.SFIXED64:a=s||ce.from(t).isZero(),r=W.Bit64,i="sfixed64";break;case S.SINT32:i="sint32";break;case S.SINT64:a=s||ce.from(t).isZero(),i="sint64";break}return[r,i,s||a]}}function qf(n){const e=n.messagePrototype?Object.create(n.messagePrototype):Object.defineProperty({},Rc,{value:n});for(let t of n.fields){let r=t.localName;if(!t.opt)if(t.oneof)e[t.oneof]={oneofKind:void 0};else if(t.repeat)e[r]=[];else switch(t.kind){case"scalar":e[r]=Ai(t.T,t.L);break;case"enum":e[r]=0;break;case"map":e[r]={};break}}return e}function dt(n,e,t){let r,i=t,s;for(let a of n.fields){let c=a.localName;if(a.oneof){const l=i[a.oneof];if((l==null?void 0:l.oneofKind)==null)continue;if(r=l[c],s=e[a.oneof],s.oneofKind=l.oneofKind,r==null){delete s[c];continue}}else if(r=i[c],s=e,r==null)continue;switch(a.repeat&&(s[c].length=r.length),a.kind){case"scalar":case"enum":if(a.repeat)for(let u=0;u<r.length;u++)s[c][u]=r[u];else s[c]=r;break;case"message":let l=a.T();if(a.repeat)for(let u=0;u<r.length;u++)s[c][u]=l.create(r[u]);else s[c]===void 0?s[c]=l.create(r):l.mergePartial(s[c],r);break;case"map":switch(a.V.kind){case"scalar":case"enum":Object.assign(s[c],r);break;case"message":let u=a.V.T();for(let h of Object.keys(r))s[c][h]=u.create(r[h]);break}break}}}function Jf(n,e,t){if(e===t)return!0;if(!e||!t)return!1;for(let r of n.fields){let i=r.localName,s=r.oneof?e[r.oneof][i]:e[i],a=r.oneof?t[r.oneof][i]:t[i];switch(r.kind){case"enum":case"scalar":let c=r.kind=="enum"?S.INT32:r.T;if(!(r.repeat?bo(c,s,a):Dc(c,s,a)))return!1;break;case"map":if(!(r.V.kind=="message"?_o(r.V.T(),Gn(s),Gn(a)):bo(r.V.kind=="enum"?S.INT32:r.V.T,Gn(s),Gn(a))))return!1;break;case"message":let l=r.T();if(!(r.repeat?_o(l,s,a):l.equals(s,a)))return!1;break}}return!0}const Gn=Object.values;function Dc(n,e,t){if(e===t)return!0;if(n!==S.BYTES)return!1;let r=e,i=t;if(r.length!==i.length)return!1;for(let s=0;s<r.length;s++)if(r[s]!=i[s])return!1;return!0}function bo(n,e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Dc(n,e[r],t[r]))return!1;return!0}function _o(n,e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!n.equals(e[r],t[r]))return!1;return!0}const Bc=Object.getOwnPropertyDescriptors(Object.getPrototypeOf({})),zf=Bc[Rc]={};class On{constructor(e,t,r){this.defaultCheckDepth=16,this.typeName=e,this.fields=t.map(Bf),this.options=r??{},zf.value=this,this.messagePrototype=Object.create(null,Bc),this.refTypeCheck=new Ff(this),this.refJsonReader=new $f(this),this.refJsonWriter=new Uf(this),this.refBinReader=new Vf(this),this.refBinWriter=new Wf(this)}create(e){let t=qf(this);return e!==void 0&&dt(this,t,e),t}clone(e){let t=this.create();return dt(this,t,e),t}equals(e,t){return Jf(this,e,t)}is(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!1)}isAssignable(e,t=this.defaultCheckDepth){return this.refTypeCheck.is(e,t,!0)}mergePartial(e,t){dt(this,e,t)}fromBinary(e,t){let r=Tf(t);return this.internalBinaryRead(r.readerFactory(e),e.byteLength,r)}fromJson(e,t){return this.internalJsonRead(e,Rf(t))}fromJsonString(e,t){let r=JSON.parse(e);return this.fromJson(r,t)}toJson(e,t){return this.internalJsonWrite(e,Df(t))}toJsonString(e,t){var r;let i=this.toJson(e,t);return JSON.stringify(i,null,(r=t==null?void 0:t.prettySpaces)!==null&&r!==void 0?r:0)}toBinary(e,t){let r=xf(t);return this.internalBinaryWrite(e,r.writerFactory(),r).finish()}internalJsonRead(e,t,r){if(e!==null&&typeof e=="object"&&!Array.isArray(e)){let i=r??this.create();return this.refJsonReader.read(e,i,t),i}throw new Error(`Unable to parse message ${this.typeName} from JSON ${Pc(e)}.`)}internalJsonWrite(e,t){return this.refJsonWriter.write(e,t)}internalBinaryWrite(e,t,r){return this.refBinWriter.write(e,t,r),t}internalBinaryRead(e,t,r,i){let s=i??this.create();return this.refBinReader.read(e,s,r,t),s}}var jc=Object.defineProperty,ke=(n,e)=>jc(n,"name",{value:e,configurable:!0}),Qi=(n,e)=>{for(var t in e)jc(n,t,{get:e[t],enumerable:!0})},Gf={};Qi(Gf,{decode:()=>Zi,decodeBuffer:()=>$c,decodeSample:()=>Xi,encode:()=>Yi,encodeBuffer:()=>Fc,encodeSample:()=>Hi});var Kf=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function Hi(n){let e;n=n==-32768?-32767:n;let t=~n>>8&128;if(t||(n=n*-1),n>32635&&(n=32635),n>=256){let r=Kf[n>>8&127],i=n>>r+3&15;e=r<<4|i}else e=n>>4;return e^(t^85)}ke(Hi,"encodeSample");function Xi(n){let e=0;n^=85,n&128&&(n&=-129,e=-1);let t=((n&240)>>4)+4,r=0;return t!=4?r=1<<t|(n&15)<<t-4|1<<t-5:r=n<<1|1,r=e===0?r:-r,r*8*-1}ke(Xi,"decodeSample");function Yi(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=Hi(n[t]);return e}ke(Yi,"encode");function Zi(n){let e=new Int16Array(n.length);for(let t=0;t<n.length;t++)e[t]=Xi(n[t]);return e}ke(Zi,"decode");function Fc(n){const e=Math.floor(n.length/2),t=new Int16Array(e);for(let r=0;r<e;r++)t[r]=n.readInt16LE(r*2);return Buffer.from(Yi(t).buffer)}ke(Fc,"encodeBuffer");function $c(n){const e=Zi(new Uint8Array(n));return Buffer.from(e.buffer)}ke($c,"decodeBuffer");var Pi={};Qi(Pi,{decode:()=>rs,decodeBuffer:()=>Vc,decodeSample:()=>ts,encode:()=>ns,encodeBuffer:()=>Uc,encodeSample:()=>es});var Qf=132,wo=32635,Hf=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],Xf=[0,132,396,924,1980,4092,8316,16764];function es(n){const e=n<0?128:0;n=Math.abs(n),n+=Qf,n>wo&&(n=wo);const t=Hf[n>>7&255],r=n>>t+3&15;return~(e|t<<4|r)&255}ke(es,"encodeSample");function ts(n){n=~n&255;const e=n&128?-1:1,t=n>>4&7,r=n&15,i=Xf[t]+(r<<t+3);return e*i}ke(ts,"decodeSample");function ns(n){const e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=es(n[t]);return e}ke(ns,"encode");function rs(n){const e=new Int16Array(n.length);for(let t=0;t<n.length;t++)e[t]=ts(n[t]);return e}ke(rs,"decode");function Uc(n){const e=Math.floor(n.length/2),t=new Int16Array(e);for(let r=0;r<e;r++)t[r]=n.readInt16LE(r*2);return Buffer.from(ns(t).buffer)}ke(Uc,"encodeBuffer");function Vc(n){const e=rs(new Uint8Array(n));return Buffer.from(e.buffer)}ke(Vc,"decodeBuffer");var Yf={};Qi(Yf,{calculateLoudness:()=>Wc,createWavHeader:()=>qc,resample:()=>Zf});var Ii=[8,16,24,32,48];function Wc(n,e){if(!(n instanceof Buffer)||n.length===0)throw new Error("Invalid buffer, must be a non-empty Buffer.");if(!Ii.includes(e))throw new Error("Invalid bit depth, supported values are 8, 16, 24, 32, and 48.");if(e===48)throw new Error("48-bit audio is not yet implemented.");const t=Math.ceil(e/8);if(n.length%t!==0)throw new Error(`Invalid buffer length ${n.length}. Must be a multiple of ${t} bytes for ${e}-bit audio.`);const r=Math.pow(2,e-1)-1,i=n.length/t;let s=0;for(let c=0;c<i;c++){const l=c*t;let u;switch(e){case 8:u=n[l],u&128&&(u=u-256);break;case 16:u=n[l]|n[l+1]<<8,u&32768&&(u=u-65536);break;case 24:u=n[l]|n[l+1]<<8|n[l+2]<<16,u&8388608&&(u=u|-16777216);break;case 32:u=n[l]|n[l+1]<<8|n[l+2]<<16|n[l+3]<<24;break;default:throw new Error(`Unsupported bit depth: ${e}`)}const h=u/r;s+=h*h}const a=Math.sqrt(s/i);return a<=1e-10?-100:20*Math.log10(a)}ke(Wc,"calculateLoudness");function qc(n,e,t,r){const i=[{value:"RIFF",type:"string"},{value:36+n,type:"uint32"},{value:"WAVE",type:"string"},{value:"fmt ",type:"string"},{value:16,type:"uint32"},{value:1,type:"uint16"},{value:t,type:"uint16"},{value:e,type:"uint32"},{value:e*t*r/8,type:"uint32"},{value:t*r/8,type:"uint16"},{value:r,type:"uint16"},{value:"data",type:"string"},{value:n,type:"uint32"}],s=Buffer.alloc(44);let a=0;return i.forEach(({value:c,type:l})=>{l==="string"?(s.write(c,a),a+=4):l==="uint32"?(s.writeUInt32LE(c,a),a+=4):l==="uint16"&&(s.writeUInt16LE(c,a),a+=2)}),s}ke(qc,"createWavHeader");var Zf=ke((n,e,t,r)=>{if(e<=0||t<=0)throw new Error("Sample rates must be positive.");if(!Ii.includes(r))throw new Error(`Invalid bit depth. Allowed values are: ${Ii.join(", ")}`);const i=t/e,s=Math.round(n.length*i),a=new Array(s),c=(1<<r-1)-1,l=-1<<r-1;for(let u=0;u<s;u++){const h=u/i,m=Math.floor(h),v=Math.min(m+1,n.length-1),_=h-m,y=n[m]*(1-_)+n[v]*_,k=Math.round(y);a[u]=Math.max(l,Math.min(c,k))}return a},"resample");class je{static floatTo16BitPCM(e){const t=new ArrayBuffer(e.length*2),r=new DataView(t);let i=0;for(let s=0;s<e.length;s++,i+=2){let a=Math.max(-1,Math.min(1,e[s]));r.setInt16(i,a<0?a*32768:a*32767,!0)}return t}static mergeBuffers(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}_packData(e,t){return[new Uint8Array([t,t>>8]),new Uint8Array([t,t>>8,t>>16,t>>24])][e]}pack(e,t){if(t!=null&&t.bitsPerSample)if(t!=null&&t.channels){if(!(t!=null&&t.data))throw new Error('Missing "data"')}else throw new Error('Missing "channels"');else throw new Error('Missing "bitsPerSample"');const{bitsPerSample:r,channels:i,data:s}=t,a=["RIFF",this._packData(1,52),"WAVE","fmt ",this._packData(1,16),this._packData(0,1),this._packData(0,i.length),this._packData(1,e),this._packData(1,e*i.length*r/8),this._packData(0,i.length*r/8),this._packData(0,r),"data",this._packData(1,i[0].length*i.length*r/8),s],c=new Blob(a,{type:"audio/mpeg"}),l=URL.createObjectURL(c);return{blob:c,url:l,channelCount:i.length,sampleRate:e,duration:s.byteLength/(i.length*e*2)}}}globalThis.WavPacker=je;const ko=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],eh=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ft=[],is=[];for(let n=1;n<=8;n++)for(let e=0;e<ko.length;e++){const t=ko[e];ft.push(t/Math.pow(2,8-n)),is.push(eh[e]+n)}const pr=[32,2e3],So=ft.filter((n,e)=>ft[e]>pr[0]&&ft[e]<pr[1]),th=is.filter((n,e)=>ft[e]>pr[0]&&ft[e]<pr[1]);class sn{static getFrequencies(e,t,r,i="frequency",s=-100,a=-30){r||(r=new Float32Array(e.frequencyBinCount),e.getFloatFrequencyData(r));const c=t/2,l=1/r.length*c;let u,h,m;if(i==="music"||i==="voice"){const y=i==="voice"?So:ft,k=Array(y.length).fill(s);for(let P=0;P<r.length;P++){const N=P*l,B=r[P];for(let D=y.length-1;D>=0;D--)if(N>y[D]){k[D]=Math.max(k[D],B);break}}u=k,h=i==="voice"?So:ft,m=i==="voice"?th:is}else u=Array.from(r),h=u.map((y,k)=>l*k),m=h.map(y=>`${y.toFixed(2)} Hz`);const v=u.map(y=>Math.max(0,Math.min((y-s)/(a-s),1)));return{values:new Float32Array(v),frequencies:h,labels:m}}constructor(e,t=null){if(this.fftResults=[],t){const{length:r,sampleRate:i}=t,s=new OfflineAudioContext({length:r,sampleRate:i}),a=s.createBufferSource();a.buffer=t;const c=s.createAnalyser();c.fftSize=8192,c.smoothingTimeConstant=.1,a.connect(c);const l=1/60,u=r/i,h=m=>{const v=l*m;v<u&&s.suspend(v).then(()=>{const _=new Float32Array(c.frequencyBinCount);c.getFloatFrequencyData(_),this.fftResults.push(_),h(m+1)}),m===1?s.startRendering():s.resume()};a.start(0),h(1),this.audio=e,this.context=s,this.analyser=c,this.sampleRate=i,this.audioBuffer=t}else{const r=new AudioContext,i=r.createMediaElementSource(e),s=r.createAnalyser();s.fftSize=8192,s.smoothingTimeConstant=.1,i.connect(s),s.connect(r.destination),this.audio=e,this.context=r,this.analyser=s,this.sampleRate=this.context.sampleRate,this.audioBuffer=null}}getFrequencies(e="frequency",t=-100,r=-30){let i=null;if(this.audioBuffer&&this.fftResults.length){const s=this.audio.currentTime/this.audio.duration,a=Math.min(s*this.fftResults.length|0,this.fftResults.length-1);i=this.fftResults[a]}return sn.getFrequencies(this.analyser,this.sampleRate,i,e,t,r)}async resumeIfSuspended(){return this.context.state==="suspended"&&await this.context.resume(),!0}}globalThis.AudioAnalysis=sn;const nh=`
class StreamProcessor extends AudioWorkletProcessor {
  constructor() {
    super();
    this.hasStarted = false;
    this.hasInterrupted = false;
    this.outputBuffers = [];
    this.bufferLength = 128;
    this.write = { buffer: new Float32Array(this.bufferLength), trackId: null };
    this.writeOffset = 0;
    this.trackSampleOffsets = {};
    this.port.onmessage = (event) => {
      if (event.data) {
        const payload = event.data;
        if (payload.event === 'write') {
          const int16Array = payload.buffer;
          const float32Array = new Float32Array(int16Array.length);
          for (let i = 0; i < int16Array.length; i++) {
            float32Array[i] = int16Array[i] / 0x8000; // Convert Int16 to Float32
          }
          this.writeData(float32Array, payload.trackId);
        } else if (
          payload.event === 'offset' ||
          payload.event === 'interrupt'
        ) {
          const requestId = payload.requestId;
          const trackId = this.write.trackId;
          const offset = this.trackSampleOffsets[trackId] || 0;
          this.port.postMessage({
            event: 'offset',
            requestId,
            trackId,
            offset,
          });
          if (payload.event === 'interrupt') {
            this.hasInterrupted = true;
          }
        } else {
          throw new Error(\`Unhandled event "\${payload.event}"\`);
        }
      }
    };
  }

  writeData(float32Array, trackId = null) {
    let { buffer } = this.write;
    let offset = this.writeOffset;
    for (let i = 0; i < float32Array.length; i++) {
      buffer[offset++] = float32Array[i];
      if (offset >= buffer.length) {
        this.outputBuffers.push(this.write);
        this.write = { buffer: new Float32Array(this.bufferLength), trackId };
        buffer = this.write.buffer;
        offset = 0;
      }
    }
    this.writeOffset = offset;
    return true;
  }

  process(inputs, outputs, parameters) {
    const output = outputs[0];
    const outputChannelData = output[0];
    const outputBuffers = this.outputBuffers;
    if (this.hasInterrupted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else if (outputBuffers.length) {
      this.hasStarted = true;
      const { buffer, trackId } = outputBuffers.shift();
      for (let i = 0; i < outputChannelData.length; i++) {
        outputChannelData[i] = buffer[i] || 0;
      }
      if (trackId) {
        this.trackSampleOffsets[trackId] =
          this.trackSampleOffsets[trackId] || 0;
        this.trackSampleOffsets[trackId] += buffer.length;
      }
      return true;
    } else if (this.hasStarted) {
      this.port.postMessage({ event: 'stop' });
      return false;
    } else {
      return true;
    }
  }
}

registerProcessor('stream_processor', StreamProcessor);
`,rh=new Blob([nh],{type:"application/javascript"}),ih=URL.createObjectURL(rh),sh=ih;class ss{constructor({sampleRate:e=44100}={}){this.scriptSrc=sh,this.sampleRate=e,this.context=null,this.stream=null,this.analyser=null,this.trackSampleOffsets={},this.interruptedTrackIds={}}async connect(){this.context=new AudioContext({sampleRate:this.sampleRate}),this._speakerID&&this.context.setSinkId(this._speakerID),this.context.state==="suspended"&&await this.context.resume();try{await this.context.audioWorklet.addModule(this.scriptSrc)}catch(t){throw console.error(t),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}const e=this.context.createAnalyser();return e.fftSize=8192,e.smoothingTimeConstant=.1,this.analyser=e,!0}getFrequencies(e="frequency",t=-100,r=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return sn.getFrequencies(this.analyser,this.sampleRate,null,e,t,r)}async updateSpeaker(e){const t=this._speakerID;if(this._speakerID=e,this.context)try{e==="default"?await this.context.setSinkId():await this.context.setSinkId(e)}catch(r){console.error(`Could not set sinkId to ${e}: ${r}`),this._speakerID=t}}_start(){const e=new AudioWorkletNode(this.context,"stream_processor");return e.connect(this.context.destination),e.port.onmessage=t=>{const{event:r}=t.data;if(r==="stop")e.disconnect(),this.stream=null;else if(r==="offset"){const{requestId:i,trackId:s,offset:a}=t.data,c=a/this.sampleRate;this.trackSampleOffsets[i]={trackId:s,offset:a,currentTime:c}}},this.analyser.disconnect(),e.connect(this.analyser),this.stream=e,!0}add16BitPCM(e,t="default"){if(typeof t!="string")throw new Error("trackId must be a string");if(this.interruptedTrackIds[t])return;this.stream||this._start();let r;if(e instanceof Int16Array)r=e;else if(e instanceof ArrayBuffer)r=new Int16Array(e);else throw new Error("argument must be Int16Array or ArrayBuffer");return this.stream.port.postMessage({event:"write",buffer:r,trackId:t}),r}async getTrackSampleOffset(e=!1){if(!this.stream)return null;const t=crypto.randomUUID();this.stream.port.postMessage({event:e?"interrupt":"offset",requestId:t});let r;for(;!r;)r=this.trackSampleOffsets[t],await new Promise(s=>setTimeout(()=>s(),1));const{trackId:i}=r;return e&&i&&(this.interruptedTrackIds[i]=!0),r}async interrupt(){return this.getTrackSampleOffset(!0)}}globalThis.WavStreamPlayer=ss;const ah=`
class AudioProcessor extends AudioWorkletProcessor {

  constructor() {
    super();
    this.port.onmessage = this.receive.bind(this);
    this.initialize();
  }

  initialize() {
    this.foundAudio = false;
    this.recording = false;
    this.chunks = [];
  }

  /**
   * Concatenates sampled chunks into channels
   * Format is chunk[Left[], Right[]]
   */
  readChannelData(chunks, channel = -1, maxChannels = 9) {
    let channelLimit;
    if (channel !== -1) {
      if (chunks[0] && chunks[0].length - 1 < channel) {
        throw new Error(
          \`Channel \${channel} out of range: max \${chunks[0].length}\`
        );
      }
      channelLimit = channel + 1;
    } else {
      channel = 0;
      channelLimit = Math.min(chunks[0] ? chunks[0].length : 1, maxChannels);
    }
    const channels = [];
    for (let n = channel; n < channelLimit; n++) {
      const length = chunks.reduce((sum, chunk) => {
        return sum + chunk[n].length;
      }, 0);
      const buffers = chunks.map((chunk) => chunk[n]);
      const result = new Float32Array(length);
      let offset = 0;
      for (let i = 0; i < buffers.length; i++) {
        result.set(buffers[i], offset);
        offset += buffers[i].length;
      }
      channels[n] = result;
    }
    return channels;
  }

  /**
   * Combines parallel audio data into correct format,
   * channels[Left[], Right[]] to float32Array[LRLRLRLR...]
   */
  formatAudioData(channels) {
    if (channels.length === 1) {
      // Simple case is only one channel
      const float32Array = channels[0].slice();
      const meanValues = channels[0].slice();
      return { float32Array, meanValues };
    } else {
      const float32Array = new Float32Array(
        channels[0].length * channels.length
      );
      const meanValues = new Float32Array(channels[0].length);
      for (let i = 0; i < channels[0].length; i++) {
        const offset = i * channels.length;
        let meanValue = 0;
        for (let n = 0; n < channels.length; n++) {
          float32Array[offset + n] = channels[n][i];
          meanValue += channels[n][i];
        }
        meanValues[i] = meanValue / channels.length;
      }
      return { float32Array, meanValues };
    }
  }

  /**
   * Converts 32-bit float data to 16-bit integers
   */
  floatTo16BitPCM(float32Array) {
    const buffer = new ArrayBuffer(float32Array.length * 2);
    const view = new DataView(buffer);
    let offset = 0;
    for (let i = 0; i < float32Array.length; i++, offset += 2) {
      let s = Math.max(-1, Math.min(1, float32Array[i]));
      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);
    }
    return buffer;
  }

  /**
   * Retrieves the most recent amplitude values from the audio stream
   * @param {number} channel
   */
  getValues(channel = -1) {
    const channels = this.readChannelData(this.chunks, channel);
    const { meanValues } = this.formatAudioData(channels);
    return { meanValues, channels };
  }

  /**
   * Exports chunks as an audio/wav file
   */
  export() {
    const channels = this.readChannelData(this.chunks);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const audioData = this.floatTo16BitPCM(float32Array);
    return {
      meanValues: meanValues,
      audio: {
        bitsPerSample: 16,
        channels: channels,
        data: audioData,
      },
    };
  }

  receive(e) {
    const { event, id } = e.data;
    let receiptData = {};
    switch (event) {
      case 'start':
        this.recording = true;
        break;
      case 'stop':
        this.recording = false;
        break;
      case 'clear':
        this.initialize();
        break;
      case 'export':
        receiptData = this.export();
        break;
      case 'read':
        receiptData = this.getValues();
        break;
      default:
        break;
    }
    // Always send back receipt
    this.port.postMessage({ event: 'receipt', id, data: receiptData });
  }

  sendChunk(chunk) {
    const channels = this.readChannelData([chunk]);
    const { float32Array, meanValues } = this.formatAudioData(channels);
    const rawAudioData = this.floatTo16BitPCM(float32Array);
    const monoAudioData = this.floatTo16BitPCM(meanValues);
    this.port.postMessage({
      event: 'chunk',
      data: {
        mono: monoAudioData,
        raw: rawAudioData,
      },
    });
  }

  process(inputList, outputList, parameters) {
    // Copy input to output (e.g. speakers)
    // Note that this creates choppy sounds with Mac products
    const sourceLimit = Math.min(inputList.length, outputList.length);
    for (let inputNum = 0; inputNum < sourceLimit; inputNum++) {
      const input = inputList[inputNum];
      const output = outputList[inputNum];
      const channelCount = Math.min(input.length, output.length);
      for (let channelNum = 0; channelNum < channelCount; channelNum++) {
        input[channelNum].forEach((sample, i) => {
          output[channelNum][i] = sample;
        });
      }
    }
    const inputs = inputList[0];
    // There's latency at the beginning of a stream before recording starts
    // Make sure we actually receive audio data before we start storing chunks
    let sliceIndex = 0;
    if (!this.foundAudio) {
      for (const channel of inputs) {
        sliceIndex = 0; // reset for each channel
        if (this.foundAudio) {
          break;
        }
        if (channel) {
          for (const value of channel) {
            if (value !== 0) {
              // find only one non-zero entry in any channel
              this.foundAudio = true;
              break;
            } else {
              sliceIndex++;
            }
          }
        }
      }
    }
    if (inputs && inputs[0] && this.foundAudio && this.recording) {
      // We need to copy the TypedArray, because the \`process\`
      // internals will reuse the same buffer to hold each input
      const chunk = inputs.map((input) => input.slice(sliceIndex));
      this.chunks.push(chunk);
      this.sendChunk(chunk);
    }
    return true;
  }
}

registerProcessor('audio_processor', AudioProcessor);
`,oh=new Blob([ah],{type:"application/javascript"}),ch=URL.createObjectURL(oh),Jc=ch;class zc{constructor({sampleRate:e=44100,outputToSpeakers:t=!1,debug:r=!1}={}){this.scriptSrc=Jc,this.sampleRate=e,this.outputToSpeakers=t,this.debug=!!r,this._deviceChangeCallback=null,this._devices=[],this.deviceSelection=null,this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}static async decode(e,t=44100,r=-1){const i=new AudioContext({sampleRate:t});let s,a;if(e instanceof Blob){if(r!==-1)throw new Error('Can not specify "fromSampleRate" when reading from Blob');a=e,s=await a.arrayBuffer()}else if(e instanceof ArrayBuffer){if(r!==-1)throw new Error('Can not specify "fromSampleRate" when reading from ArrayBuffer');s=e,a=new Blob([s],{type:"audio/wav"})}else{let h,m;if(e instanceof Int16Array){m=e,h=new Float32Array(e.length);for(let k=0;k<e.length;k++)h[k]=e[k]/32768}else if(e instanceof Float32Array)h=e;else if(e instanceof Array)h=new Float32Array(e);else throw new Error('"audioData" must be one of: Blob, Float32Arrray, Int16Array, ArrayBuffer, Array<number>');if(r===-1)throw new Error('Must specify "fromSampleRate" when reading from Float32Array, In16Array or Array');if(r<3e3)throw new Error('Minimum "fromSampleRate" is 3000 (3kHz)');m||(m=je.floatTo16BitPCM(h));const v={bitsPerSample:16,channels:[h],data:m};a=new je().pack(r,v).blob,s=await a.arrayBuffer()}const c=await i.decodeAudioData(s),l=c.getChannelData(0),u=URL.createObjectURL(a);return{blob:a,url:u,values:l,audioBuffer:c}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e,t={},r=null){if(r=r||this.processor,!r)throw new Error("Can not send events without recording first");const i={event:e,id:this._lastEventId++,data:t};r.port.postMessage(i);const s=new Date().valueOf();for(;!this.eventReceipts[i.id];){if(new Date().valueOf()-s>this.eventTimeout)throw new Error(`Timeout waiting for "${e}" event`);await new Promise(c=>setTimeout(()=>c(!0),1))}const a=this.eventReceipts[i.id];return delete this.eventReceipts[i.id],a}listenForDeviceChange(e){if(e===null&&this._deviceChangeCallback)navigator.mediaDevices.removeEventListener("devicechange",this._deviceChangeCallback),this._deviceChangeCallback=null;else if(e!==null){let t=0,r=[];const i=a=>a.map(c=>c.deviceId).sort().join(","),s=async()=>{let a=++t;const c=await this.listDevices();a===t&&i(r)!==i(c)&&(r=c,e(c.slice()))};navigator.mediaDevices.addEventListener("devicechange",s),s(),this._deviceChangeCallback=s}return!0}async requestPermission(){const e=await navigator.permissions.query({name:"microphone"});if(e.state==="denied")window.alert("You must grant microphone access to use this feature.");else if(e.state==="prompt")try{(await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(i=>i.stop())}catch{window.alert("You must grant microphone access to use this feature.")}return!0}async listDevices(){if(!navigator.mediaDevices||!("enumerateDevices"in navigator.mediaDevices))throw new Error("Could not request user devices");return await this.requestPermission(),(await navigator.mediaDevices.enumerateDevices()).filter(r=>r.kind==="audioinput")}async begin(e){var c;if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!navigator.mediaDevices||!("getUserMedia"in navigator.mediaDevices))throw new Error("Could not request user media");e=e??((c=this.deviceSelection)==null?void 0:c.deviceId);try{const l={audio:!0};e&&(l.audio={deviceId:{exact:e}}),this.stream=await navigator.mediaDevices.getUserMedia(l)}catch{throw new Error("Could not start media stream")}this.listDevices().then(l=>{e=this.stream.getAudioTracks()[0].getSettings().deviceId,console.log("find current device",l,e,this.stream.getAudioTracks()[0].getSettings()),this.deviceSelection=l.find(u=>u.deviceId===e),console.log("current device",this.deviceSelection)});const t=new AudioContext({sampleRate:this.sampleRate}),r=t.createMediaStreamSource(this.stream);try{await t.audioWorklet.addModule(this.scriptSrc)}catch(l){throw console.error(l),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}const i=new AudioWorkletNode(t,"audio_processor");i.port.onmessage=l=>{const{event:u,id:h,data:m}=l.data;if(u==="receipt")this.eventReceipts[h]=m;else if(u==="chunk")if(this._chunkProcessorSize){const v=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:je.mergeBuffers(v.raw,m.raw),mono:je.mergeBuffers(v.mono,m.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(m)};const s=r.connect(i),a=t.createAnalyser();return a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a),this.outputToSpeakers&&(console.warn(`Warning: Output to speakers may affect sound quality,
especially due to system audio feedback preventative measures.
use only for debugging`),a.connect(t.destination)),this.source=r,this.node=s,this.analyser=a,this.processor=i,console.log("begin completed"),!0}getFrequencies(e="frequency",t=-100,r=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return sn.getFrequencies(this.analyser,this.sampleRate,null,e,t,r)}async pause(){if(this.processor){if(!this.recording)throw new Error("Already paused: please call .record() first")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(e=()=>{},t=8192){if(this.processor){if(this.recording)throw new Error("Already recording: please call .pause() first");if(typeof e!="function")throw new Error("chunkProcessor must be a function")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessor=e,this._chunkProcessorSize=t,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(e=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");const t=await this._event("export");return new je().pack(this.sampleRate,t.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");const e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.stream.getTracks().forEach(a=>a.stop()),this.log("Exporting ...");const r=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,new je().pack(this.sampleRate,r.audio)}async quit(){return this.listenForDeviceChange(null),this.deviceSelection=null,this.processor&&await this.end(),!0}}globalThis.WavRecorder=zc;class lh{constructor({sampleRate:e=44100,outputToSpeakers:t=!1,debug:r=!1}={}){this.scriptSrc=Jc,this.sampleRate=e,this.outputToSpeakers=t,this.debug=!!r,this.stream=null,this.processor=null,this.source=null,this.node=null,this.recording=!1,this._lastEventId=0,this.eventReceipts={},this.eventTimeout=5e3,this._chunkProcessor=()=>{},this._chunkProcessorSize=void 0,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)}}log(){return this.debug&&this.log(...arguments),!0}getSampleRate(){return this.sampleRate}getStatus(){return this.processor?this.recording?"recording":"paused":"ended"}async _event(e,t={},r=null){if(r=r||this.processor,!r)throw new Error("Can not send events without recording first");const i={event:e,id:this._lastEventId++,data:t};r.port.postMessage(i);const s=new Date().valueOf();for(;!this.eventReceipts[i.id];){if(new Date().valueOf()-s>this.eventTimeout)throw new Error(`Timeout waiting for "${e}" event`);await new Promise(c=>setTimeout(()=>c(!0),1))}const a=this.eventReceipts[i.id];return delete this.eventReceipts[i.id],a}async begin(e){if(this.processor)throw new Error("Already connected: please call .end() to start a new session");if(!e||e.kind!=="audio")throw new Error("No audio track provided");this.stream=new MediaStream([e]);const t=new AudioContext({sampleRate:this.sampleRate}),r=t.createMediaStreamSource(this.stream);try{await t.audioWorklet.addModule(this.scriptSrc)}catch(c){throw console.error(c),new Error(`Could not add audioWorklet module: ${this.scriptSrc}`)}const i=new AudioWorkletNode(t,"audio_processor");i.port.onmessage=c=>{const{event:l,id:u,data:h}=c.data;if(l==="receipt")this.eventReceipts[u]=h;else if(l==="chunk")if(this._chunkProcessorSize){const m=this._chunkProcessorBuffer;this._chunkProcessorBuffer={raw:je.mergeBuffers(m.raw,h.raw),mono:je.mergeBuffers(m.mono,h.mono)},this._chunkProcessorBuffer.mono.byteLength>=this._chunkProcessorSize&&(this._chunkProcessor(this._chunkProcessorBuffer),this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)})}else this._chunkProcessor(h)};const s=r.connect(i),a=t.createAnalyser();return a.fftSize=8192,a.smoothingTimeConstant=.1,s.connect(a),this.outputToSpeakers&&(console.warn(`Warning: Output to speakers may affect sound quality,
especially due to system audio feedback preventative measures.
use only for debugging`),a.connect(t.destination)),this.source=r,this.node=s,this.analyser=a,this.processor=i,!0}getFrequencies(e="frequency",t=-100,r=-30){if(!this.processor)throw new Error("Session ended: please call .begin() first");return sn.getFrequencies(this.analyser,this.sampleRate,null,e,t,r)}async pause(){if(this.processor){if(!this.recording)throw new Error("Already paused: please call .record() first")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessorBuffer.raw.byteLength&&this._chunkProcessor(this._chunkProcessorBuffer),this.log("Pausing ..."),await this._event("stop"),this.recording=!1,!0}async record(e=()=>{},t=8192){if(this.processor){if(this.recording)throw new Error("Already recording: HELLO please call .pause() first");if(typeof e!="function")throw new Error("chunkProcessor must be a function")}else throw new Error("Session ended: please call .begin() first");return this._chunkProcessor=e,this._chunkProcessorSize=t,this._chunkProcessorBuffer={raw:new ArrayBuffer(0),mono:new ArrayBuffer(0)},this.log("Recording ..."),await this._event("start"),this.recording=!0,!0}async clear(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return await this._event("clear"),!0}async read(){if(!this.processor)throw new Error("Session ended: please call .begin() first");return this.log("Reading ..."),await this._event("read")}async save(e=!1){if(!this.processor)throw new Error("Session ended: please call .begin() first");if(!e&&this.recording)throw new Error("Currently recording: please call .pause() first, or call .save(true) to force");this.log("Exporting ...");const t=await this._event("export");return new je().pack(this.sampleRate,t.audio)}async end(){if(!this.processor)throw new Error("Session ended: please call .begin() first");const e=this.processor;this.log("Stopping ..."),await this._event("stop"),this.recording=!1,this.log("Exporting ...");const t=await this._event("export",{},e);return this.processor.disconnect(),this.source.disconnect(),this.node.disconnect(),this.analyser.disconnect(),this.stream=null,this.processor=null,this.source=null,this.node=null,new je().pack(this.sampleRate,t.audio)}async quit(){return this.listenForDeviceChange(null),this.processor&&await this.end(),!0}}globalThis.WavRecorder=WavRecorder;var uh=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ct=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function c(h){try{u(r.next(h))}catch(m){a(m)}}function l(h){try{u(r.throw(h))}catch(m){a(m)}}function u(h){h.done?s(h.value):i(h.value).then(c,l)}u((r=r.apply(n,e||[])).next())})},Ot=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(u){return function(h){return l([u,h])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(t=0)),t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(h){u=[6,h],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Gc=function(){function n(){this._callbacks={},this._micEnabled=!0,this._camEnabled=!1}return n.prototype.setUserAudioCallback=function(e){this._userAudioCallback=e},n.prototype.setClientOptions=function(e,t){var r,i,s;t===void 0&&(t=!1),!(this._options&&!t)&&(this._options=e,this._callbacks=(r=e.callbacks)!==null&&r!==void 0?r:{},this._micEnabled=(i=e.enableMic)!==null&&i!==void 0?i:!0,this._camEnabled=(s=e.enableCam)!==null&&s!==void 0?s:!1)},n}();(function(n){uh(e,n);function e(t,r){t===void 0&&(t=void 0),r===void 0&&(r=24e3);var i=n.call(this)||this;return i._initialized=!1,i._recorderChunkSize=void 0,i._recorderChunkSize=t,i._wavRecorder=new zc({sampleRate:r}),i._wavStreamPlayer=new ss({sampleRate:24e3}),i}return e.prototype.initialize=function(){return Ct(this,void 0,Promise,function(){return Ot(this,function(t){switch(t.label){case 0:return[4,this._wavRecorder.begin()];case 1:return t.sent(),this._wavRecorder.listenForDeviceChange(null),this._wavRecorder.listenForDeviceChange(this._handleAvailableDevicesUpdated.bind(this)),[4,this._wavStreamPlayer.connect()];case 2:return t.sent(),this._initialized=!0,[2]}})})},e.prototype.connect=function(){return Ct(this,void 0,Promise,function(){var t;return Ot(this,function(r){switch(r.label){case 0:return this._initialized?[3,2]:[4,this.initialize()];case 1:r.sent(),r.label=2;case 2:return t=this._wavRecorder.getStatus()=="recording",this._micEnabled&&!t?[4,this._startRecording()]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}})})},e.prototype.disconnect=function(){return Ct(this,void 0,Promise,function(){return Ot(this,function(t){switch(t.label){case 0:return this._initialized?[4,this._wavRecorder.end()]:[2];case 1:return t.sent(),[4,this._wavStreamPlayer.interrupt()];case 2:return t.sent(),this._initialized=!1,[2]}})})},e.prototype.userStartedSpeaking=function(){return Ct(this,void 0,Promise,function(){return Ot(this,function(t){return[2,this._wavStreamPlayer.interrupt()]})})},e.prototype.bufferBotAudio=function(t,r){return this._wavStreamPlayer.add16BitPCM(t,r)},e.prototype.getAllMics=function(){return this._wavRecorder.listDevices()},e.prototype.getAllCams=function(){return Promise.resolve([])},e.prototype.getAllSpeakers=function(){return Promise.resolve([])},e.prototype.updateMic=function(t){return Ct(this,void 0,Promise,function(){var r,i,s,a;return Ot(this,function(c){switch(c.label){case 0:return r=this._wavRecorder.deviceSelection,[4,this._wavRecorder.end()];case 1:return c.sent(),[4,this._wavRecorder.begin(t)];case 2:return c.sent(),this._micEnabled?[4,this._startRecording()]:[3,4];case 3:c.sent(),c.label=4;case 4:return i=this._wavRecorder.deviceSelection,i&&r&&r.label!==i.label&&((a=(s=this._callbacks).onMicUpdated)===null||a===void 0||a.call(s,i)),[2]}})})},e.prototype.updateCam=function(t){},e.prototype.updateSpeaker=function(t){},Object.defineProperty(e.prototype,"selectedMic",{get:function(){var t;return(t=this._wavRecorder.deviceSelection)!==null&&t!==void 0?t:{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedCam",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedSpeaker",{get:function(){return{}},enumerable:!1,configurable:!0}),e.prototype.enableMic=function(t){return Ct(this,void 0,Promise,function(){var r=this;return Ot(this,function(i){switch(i.label){case 0:return this._micEnabled=t,this._wavRecorder.stream?(this._wavRecorder.stream.getAudioTracks().forEach(function(s){var a,c;s.enabled=t,t||(c=(a=r._callbacks).onTrackStopped)===null||c===void 0||c.call(a,s,Eo())}),t?[4,this._startRecording()]:[3,2]):[2];case 1:return i.sent(),[3,4];case 2:return[4,this._wavRecorder.pause()];case 3:i.sent(),i.label=4;case 4:return[2]}})})},e.prototype.enableCam=function(t){},Object.defineProperty(e.prototype,"isCamEnabled",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicEnabled",{get:function(){return this._micEnabled},enumerable:!1,configurable:!0}),e.prototype.tracks=function(){var t,r=(t=this._wavRecorder.stream)===null||t===void 0?void 0:t.getTracks()[0];return{local:r?{audio:r}:{}}},e.prototype._startRecording=function(){return Ct(this,void 0,void 0,function(){var t,r=this,i,s,a;return Ot(this,function(c){switch(c.label){case 0:return[4,this._wavRecorder.record(function(l){r._userAudioCallback(l.mono)},this._recorderChunkSize)];case 1:return c.sent(),t=(i=this._wavRecorder.stream)===null||i===void 0?void 0:i.getAudioTracks()[0],t&&((a=(s=this._callbacks).onTrackStarted)===null||a===void 0||a.call(s,t,Eo())),[2]}})})},e.prototype._handleAvailableDevicesUpdated=function(t){var r,i,s,a;(i=(r=this._callbacks).onAvailableCamsUpdated)===null||i===void 0||i.call(r,t.filter(function(u){return u.kind==="videoinput"})),(a=(s=this._callbacks).onAvailableMicsUpdated)===null||a===void 0||a.call(s,t.filter(function(u){return u.kind==="audioinput"}));var c=t.find(function(u){return u.deviceId==="default"}),l=this._wavRecorder.deviceSelection;l&&(!t.some(function(u){return u.deviceId===l.deviceId})||l.deviceId==="default"&&l.label!==(c==null?void 0:c.label))&&this.updateMic("")},e})(Gc);var Eo=function(){return{id:"local",name:"",local:!0}},dh=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Re=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function c(h){try{u(r.next(h))}catch(m){a(m)}}function l(h){try{u(r.throw(h))}catch(m){a(m)}}function u(h){h.done?s(h.value):i(h.value).then(c,l)}u((r=r.apply(n,e||[])).next())})},De=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(u){return function(h){return l([u,h])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(t=0)),t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(h){u=[6,h],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},fh=function(n){dh(e,n);function e(t,r,i,s,a,c,l){t===void 0&&(t=!0),r===void 0&&(r=!0),a===void 0&&(a=void 0),c===void 0&&(c=24e3),l===void 0&&(l=24e3);var u,h=n.call(this)||this;return h._selectedCam={},h._selectedMic={},h._selectedSpeaker={},h._remoteAudioLevelInterval=null,h._recorderChunkSize=void 0,h._initialized=!1,h._connected=!1,h._currentAudioTrack=null,h._connectResolve=null,h.onTrackStartedCallback=i,h.onTrackStoppedCallback=s,h._recorderChunkSize=a,h._daily=(u=oo.getCallInstance())!==null&&u!==void 0?u:oo.createCallObject(),r&&(h._mediaStreamRecorder=new lh({sampleRate:c})),t&&(h._wavStreamPlayer=new ss({sampleRate:l})),h._daily.on("track-started",h.handleTrackStarted.bind(h)),h._daily.on("track-stopped",h.handleTrackStopped.bind(h)),h._daily.on("available-devices-updated",h._handleAvailableDevicesUpdated.bind(h)),h._daily.on("selected-devices-updated",h._handleSelectedDevicesUpdated.bind(h)),h._daily.on("local-audio-level",h._handleLocalAudioLevel.bind(h)),h}return e.prototype.initialize=function(){return Re(this,void 0,Promise,function(){var t,r,i,s,a,c=this,l,u,h,m,v,_,y,k,P,N,B,D;return De(this,function(T){switch(T.label){case 0:return this._initialized?(console.warn("DailyMediaManager already initialized"),[2]):[4,this._daily.startCamera({startVideoOff:!this._camEnabled,startAudioOff:!this._micEnabled})];case 1:return t=T.sent(),[4,this._daily.enumerateDevices()];case 2:return r=T.sent().devices,i=r.filter(function(w){return w.kind==="videoinput"}),s=r.filter(function(w){return w.kind==="audioinput"}),a=r.filter(function(w){return w.kind==="audiooutput"}),(u=(l=this._callbacks).onAvailableCamsUpdated)===null||u===void 0||u.call(l,i),(m=(h=this._callbacks).onAvailableMicsUpdated)===null||m===void 0||m.call(h,s),(_=(v=this._callbacks).onAvailableSpeakersUpdated)===null||_===void 0||_.call(v,a),this._selectedCam=t.camera,(k=(y=this._callbacks).onCamUpdated)===null||k===void 0||k.call(y,t.camera),this._selectedMic=t.mic,(N=(P=this._callbacks).onMicUpdated)===null||N===void 0||N.call(P,t.mic),this._selectedSpeaker=t.speaker,(D=(B=this._callbacks).onSpeakerUpdated)===null||D===void 0||D.call(B,t.speaker),this._daily.isLocalAudioLevelObserverRunning()?[3,4]:[4,this._daily.startLocalAudioLevelObserver(100)];case 3:T.sent(),T.label=4;case 4:return this._wavStreamPlayer?[4,this._wavStreamPlayer.connect()]:[3,6];case 5:T.sent(),this._remoteAudioLevelInterval||(this._remoteAudioLevelInterval=setInterval(function(){var w,C=c._wavStreamPlayer.getFrequencies(),I=0;!((w=C.values)===null||w===void 0)&&w.length&&(I=C.values.reduce(function(x,V){return x+V},0)/C.values.length),c._handleRemoteAudioLevel(I)},100)),T.label=6;case 6:return this._initialized=!0,[2]}})})},e.prototype.connect=function(){return Re(this,void 0,Promise,function(){var t=this;return De(this,function(r){return this._connected?(console.warn("DailyMediaManager already connected"),[2]):(this._connected=!0,this._initialized?(this._micEnabled&&this._startRecording(),[2]):[2,new Promise(function(i){(function(){return Re(t,void 0,void 0,function(){return De(this,function(s){switch(s.label){case 0:return this._connectResolve=i,[4,this.initialize()];case 1:return s.sent(),[2]}})})})()})])})})},e.prototype.disconnect=function(){return Re(this,void 0,Promise,function(){var t,r;return De(this,function(i){switch(i.label){case 0:return this._remoteAudioLevelInterval&&clearInterval(this._remoteAudioLevelInterval),this._remoteAudioLevelInterval=null,this._daily.leave(),this._currentAudioTrack=null,[4,(t=this._mediaStreamRecorder)===null||t===void 0?void 0:t.end()];case 1:return i.sent(),(r=this._wavStreamPlayer)===null||r===void 0||r.interrupt(),this._initialized=!1,this._connected=!1,[2]}})})},e.prototype.userStartedSpeaking=function(){return Re(this,void 0,Promise,function(){var t;return De(this,function(r){return[2,(t=this._wavStreamPlayer)===null||t===void 0?void 0:t.interrupt()]})})},e.prototype.bufferBotAudio=function(t,r){var i;return(i=this._wavStreamPlayer)===null||i===void 0?void 0:i.add16BitPCM(t,r)},e.prototype.getAllMics=function(){return Re(this,void 0,Promise,function(){var t;return De(this,function(r){switch(r.label){case 0:return[4,this._daily.enumerateDevices()];case 1:return t=r.sent().devices,[2,t.filter(function(i){return i.kind==="audioinput"})]}})})},e.prototype.getAllCams=function(){return Re(this,void 0,Promise,function(){var t;return De(this,function(r){switch(r.label){case 0:return[4,this._daily.enumerateDevices()];case 1:return t=r.sent().devices,[2,t.filter(function(i){return i.kind==="videoinput"})]}})})},e.prototype.getAllSpeakers=function(){return Re(this,void 0,Promise,function(){var t;return De(this,function(r){switch(r.label){case 0:return[4,this._daily.enumerateDevices()];case 1:return t=r.sent().devices,[2,t.filter(function(i){return i.kind==="audiooutput"})]}})})},e.prototype.updateMic=function(t){var r=this;this._daily.setInputDevicesAsync({audioDeviceId:t}).then(function(i){r._selectedMic=i.mic})},e.prototype.updateCam=function(t){var r=this;this._daily.setInputDevicesAsync({videoDeviceId:t}).then(function(i){r._selectedCam=i.camera})},e.prototype.updateSpeaker=function(t){return Re(this,void 0,Promise,function(){var r,i,s,a,c=this,l,u;return De(this,function(h){switch(h.label){case 0:return t!=="default"&&this._selectedSpeaker.deviceId===t?[2]:(r=t,r!=="default"?[3,2]:[4,this.getAllSpeakers()]);case 1:if(i=h.sent(),s=i.find(function(m){return m.deviceId==="default"}),!s)return console.warn("No default speaker found"),[2];i.splice(i.indexOf(s),1),a=i.find(function(m){return s.label.includes(m.label)}),r=(l=a==null?void 0:a.deviceId)!==null&&l!==void 0?l:t,h.label=2;case 2:return(u=this._wavStreamPlayer)===null||u===void 0||u.updateSpeaker(r).then(function(){var m,v;c._selectedSpeaker={deviceId:t},(v=(m=c._callbacks).onSpeakerUpdated)===null||v===void 0||v.call(m,c._selectedSpeaker)}),[2]}})})},Object.defineProperty(e.prototype,"selectedMic",{get:function(){return this._selectedMic},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedCam",{get:function(){return this._selectedCam},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectedSpeaker",{get:function(){return this._selectedSpeaker},enumerable:!1,configurable:!0}),e.prototype.enableMic=function(t){return Re(this,void 0,Promise,function(){var r;return De(this,function(i){return this._micEnabled=t,!((r=this._daily.participants())===null||r===void 0)&&r.local?(this._daily.setLocalAudio(t),this._mediaStreamRecorder&&(t?this._mediaStreamRecorder.getStatus()==="paused"&&this._startRecording():this._mediaStreamRecorder.getStatus()==="recording"&&this._mediaStreamRecorder.pause()),[2]):[2]})})},e.prototype.enableCam=function(t){this._camEnabled=t,this._daily.setLocalVideo(t)},Object.defineProperty(e.prototype,"isCamEnabled",{get:function(){return this._daily.localVideo()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicEnabled",{get:function(){return this._daily.localAudio()},enumerable:!1,configurable:!0}),e.prototype.tracks=function(){var t,r,i,s,a,c,l=this._daily.participants();return{local:{audio:(i=(r=(t=l==null?void 0:l.local)===null||t===void 0?void 0:t.tracks)===null||r===void 0?void 0:r.audio)===null||i===void 0?void 0:i.persistentTrack,video:(c=(a=(s=l==null?void 0:l.local)===null||s===void 0?void 0:s.tracks)===null||a===void 0?void 0:a.video)===null||c===void 0?void 0:c.persistentTrack}}},e.prototype._startRecording=function(){var t=this;if(!(!this._connected||!this._mediaStreamRecorder))try{this._mediaStreamRecorder.record(function(i){t._userAudioCallback(i.mono)},this._recorderChunkSize)}catch(i){var r=i;r.message.includes("Already recording")||console.error("Error starting recording",i)}},e.prototype._handleAvailableDevicesUpdated=function(t){var r,i,s,a,c,l;(i=(r=this._callbacks).onAvailableCamsUpdated)===null||i===void 0||i.call(r,t.availableDevices.filter(function(u){return u.kind==="videoinput"})),(a=(s=this._callbacks).onAvailableMicsUpdated)===null||a===void 0||a.call(s,t.availableDevices.filter(function(u){return u.kind==="audioinput"})),(l=(c=this._callbacks).onAvailableSpeakersUpdated)===null||l===void 0||l.call(c,t.availableDevices.filter(function(u){return u.kind==="audiooutput"})),this._selectedSpeaker.deviceId==="default"&&this.updateSpeaker("default")},e.prototype._handleSelectedDevicesUpdated=function(t){var r,i,s,a,c,l;((r=this._selectedCam)===null||r===void 0?void 0:r.deviceId)!==t.devices.camera&&(this._selectedCam=t.devices.camera,(s=(i=this._callbacks).onCamUpdated)===null||s===void 0||s.call(i,t.devices.camera)),((a=this._selectedMic)===null||a===void 0?void 0:a.deviceId)!==t.devices.mic&&(this._selectedMic=t.devices.mic,(l=(c=this._callbacks).onMicUpdated)===null||l===void 0||l.call(c,t.devices.mic))},e.prototype._handleLocalAudioLevel=function(t){var r,i;(i=(r=this._callbacks).onLocalAudioLevel)===null||i===void 0||i.call(r,t.audioLevel)},e.prototype._handleRemoteAudioLevel=function(t){var r,i;(i=(r=this._callbacks).onRemoteAudioLevel)===null||i===void 0||i.call(r,t,hh())},e.prototype.handleTrackStarted=function(t){return Re(this,void 0,void 0,function(){var r,i,s,a,c,l;return De(this,function(u){switch(u.label){case 0:if(!(!((s=t.participant)===null||s===void 0)&&s.local))return[2];if(t.track.kind!=="audio")return[3,10];if(!this._mediaStreamRecorder)return[3,9];switch(r=this._mediaStreamRecorder.getStatus(),i=r,i){case"ended":return[3,1];case"paused":return[3,3];case"recording":return[3,4]}return[3,4];case 1:return[4,this._mediaStreamRecorder.begin(t.track)];case 2:return u.sent(),this._connected&&(this._startRecording(),this._connectResolve&&(this._connectResolve(),this._connectResolve=null)),[3,9];case 3:return this._startRecording(),[3,9];case 4:return this._currentAudioTrack===t.track?[3,7]:[4,this._mediaStreamRecorder.end()];case 5:return u.sent(),[4,this._mediaStreamRecorder.begin(t.track)];case 6:return u.sent(),this._startRecording(),[3,8];case 7:console.warn("track-started event received for current track and already recording"),u.label=8;case 8:return[3,9];case 9:this._currentAudioTrack=t.track,u.label=10;case 10:return(c=(a=this._callbacks).onTrackStarted)===null||c===void 0||c.call(a,t.track,t.participant?Mo(t.participant):void 0),(l=this.onTrackStartedCallback)===null||l===void 0||l.call(this,t),[2]}})})},e.prototype.handleTrackStopped=function(t){var r,i,s,a;!((r=t.participant)===null||r===void 0)&&r.local&&(t.track.kind==="audio"&&this._mediaStreamRecorder&&this._mediaStreamRecorder.getStatus()==="recording"&&this._mediaStreamRecorder.pause(),(s=(i=this._callbacks).onTrackStopped)===null||s===void 0||s.call(i,t.track,t.participant?Mo(t.participant):void 0),(a=this.onTrackStoppedCallback)===null||a===void 0||a.call(this,t))},e}(Gc),Mo=function(n){return{id:n.user_id,local:n.local,name:n.user_name}},hh=function(){return{id:"bot",local:!1,name:"Bot"}},ph=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),st=function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function c(h){try{u(r.next(h))}catch(m){a(m)}}function l(h){try{u(r.throw(h))}catch(m){a(m)}}function u(h){h.done?s(h.value):i(h.value).then(c,l)}u((r=r.apply(n,e||[])).next())})},at=function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=c(0),a.throw=c(1),a.return=c(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(u){return function(h){return l([u,h])}}function l(u){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(t=0)),t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(h){u=[6,h],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Kn=function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Kc=["CONNECTING","OPEN","CLOSING","CLOSED"],mh=5e3,gh=15e3,vh=15e4,To=2,yh=10,bh=1e3,_h=3e4,wh=1.5,kh=4100,Sh="SIG_CONNECTION_CANCELED",Eh="WEBSOCKET_ERROR",ye;(function(n){n[n.DEBUG=0]="DEBUG",n[n.ERROR=1]="ERROR",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN"})(ye||(ye={}));var Mh=function(){function n(e,t){this._closedManually=!1,this._errored=!1,this._rejected=!1,this._timed_out=!1,this._initialConnectionOk=!1,this._ws=new WebSocket(e,t)}return n.prototype.addEventListener=function(e,t){this._ws.addEventListener(e,t)},n.prototype.close=function(e,t){this._ws.close(e,t)},n.prototype.send=function(e){this._ws.send(e)},Object.defineProperty(n.prototype,"url",{get:function(){return this._ws.url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"readyState",{get:function(){return this._ws.readyState},enumerable:!1,configurable:!0}),n}(),Ar=function(n){ph(e,n);function e(t,r,i){i===void 0&&(i={});var s,a=n.call(this)||this;if(!t)throw new Error("Need a valid WebSocket URL");return a._ws=null,a._url=t,a._protocols=r,a._parseBlobToJson=(s=i==null?void 0:i.parseBlobToJson)!==null&&s!==void 0?s:!0,a.init(),a}return e.prototype.init=function(){this._keepAliveTimeout=gh,this._keepAliveInterval=mh,this._disconnected=!1,this._keepIntervalID=null,this._shouldRetryFn=null,this._connectionTimeout=vh,this._reconnectAttempts=0,this._allowedReconnectAttempts=To,this._reconnectInterval=bh,this._maxReconnectInterval=_h,this._reconnectDecay=wh},e.prototype.connect=function(){return st(this,void 0,void 0,function(){var t=this;return at(this,function(r){return[2,new Promise(function(i,s){t._disconnected=!1,t.clearReconnectTimeout();var a=new Mh(t._url,t._protocols);t.setConnectionTimeout(),a.addEventListener("close",function(c){var l=c,u=a._timed_out?kh:l.code,h=a._timed_out?"websocket connection timed out":l.reason;if(a._timed_out=!1,!a._closedManually&&a._initialConnectionOk?(console.warn("signaling socket closed unexpectedly: ".concat(u).concat(h?" "+h:"")),t._closeSocket(),t.emit("close",u,h)):t.log("signaling socket closed"),!a._closedManually&&(a._errored||a._timed_out)&&(console.warn("signaling socket closed on error: ".concat(u).concat(h?" "+h:"")),!a._rejected)){a._rejected=!0;var m=new Error("WebSocket connection error (".concat(u,"): ").concat(h));m.name=Eh,s(m)}}),a.addEventListener("open",function(c){if(t.log("wss connection opened to",ye.DEBUG,t._url),t.clearConnectionTimeout(),!(a._rejected||a._timed_out)){if(a._closedManually||t._ws&&t._ws!==a){a._rejected=!0,a.close();var l=Error("wss connection interrupted by disconnect or newer connection");l.name=Sh,s(l);return}a._initialConnectionOk=t._url,t._lastMsgRecvTime=Date.now(),t._keepAliveInterval&&(t._keepIntervalID=setInterval(function(){return t.checkSocketHealthAndSendKeepAlive()},t._keepAliveInterval)),t._ws=a,t.emit("open"),i(a)}}),a.addEventListener("error",function(c){if(!a._closedManually){var l=c.currentTarget;t.log("websocket error event: ".concat(l==null?void 0:l.url))}a._errored=!0}),a.addEventListener("message",function(c){t._handleMessage(c)})})]})})},e.prototype.setConnectionTimeout=function(){var t=this;this._connectionTimeoutID=setTimeout(function(){return st(t,void 0,void 0,function(){return at(this,function(r){switch(r.label){case 0:return this.log("Connection reconnect attempt timed out."),this.emit("connection-timeout"),this.clearConnectionTimeout(),[4,this._closeSocket()];case 1:return r.sent(),[2]}})})},this._connectionTimeout)},e.prototype.clearConnectionTimeout=function(){clearTimeout(this._connectionTimeoutID),this._connectionTimeoutID=void 0},e.prototype.clearReconnectTimeout=function(){clearTimeout(this._reconnectTimeoutID),this._reconnectTimeoutID=void 0},e.prototype.clearKeepAliveInterval=function(){this._keepIntervalID&&(clearInterval(this._keepIntervalID),this._keepIntervalID=null)},e.prototype.checkSocketHealthAndSendKeepAlive=function(){return st(this,void 0,void 0,function(){return at(this,function(t){switch(t.label){case 0:return this._ws&&this._ws.readyState===WebSocket.OPEN?!this._keepAliveTimeout||!this._keepAliveInterval?[2]:Date.now()-this._lastMsgRecvTime>this._keepAliveTimeout?(this.log("Connection is stale, need to reconnect",ye.WARN),[4,this._closeSocket()]):[3,2]:[2];case 1:return t.sent(),[2];case 2:return Date.now()-this._lastMsgSendTime<this._keepAliveInterval?[2]:(this.log("Emitting keep-alive",ye.DEBUG),this.emit("keep-alive"),[2])}})})},e.prototype._closeSocket=function(){return st(this,void 0,void 0,function(){var t,r,i;return at(this,function(s){switch(s.label){case 0:this.log("Closing"),s.label=1;case 1:return s.trys.push([1,4,,5]),this.clearKeepAliveInterval(),this._lastMsgRecvTime=0,this._ws&&(this._ws._closedManually=!0,this._ws.close()),t=((i=this._ws)===null||i===void 0?void 0:i._initialConnectionOk)&&this._shouldRetryFn&&this._shouldRetryFn(),this._ws=null,t?(this.log("Emitting reconnect",ye.DEBUG),this.emit("reconnecting"),[4,this.retryFailedConnection()]):[3,3];case 2:s.sent(),s.label=3;case 3:return[3,5];case 4:return r=s.sent(),this.log("Error while closing and retrying: ".concat(r),ye.ERROR),[3,5];case 5:return[2]}})})},e.prototype.retryFailedConnection=function(){return st(this,void 0,void 0,function(){var t,r=this;return at(this,function(i){if(this._reconnectAttempts<this._allowedReconnectAttempts){if(this._reconnectTimeoutID)return this.log("Retry already scheduled"),[2];this.log("Retrying failed connection"),t=this._reconnectInterval*Math.pow(this._reconnectDecay,this._reconnectAttempts),t=t>this._maxReconnectInterval?this._maxReconnectInterval:t,this.log("Reconnecting in ".concat(t/1e3," seconds")),this._reconnectAttempts+=1,this._reconnectTimeoutID=setTimeout(function(){return r.connect()},t)}else this.log("Maximum connection retry attempts exceeded",ye.ERROR),this.emit("reconnect-failed");return[2]})})},e.prototype.log=function(t,r){r===void 0&&(r=ye.DEBUG);for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];switch(r){case ye.DEBUG:console.debug.apply(console,Kn(["websocket: ".concat(t)],i,!1));break;case ye.ERROR:console.error.apply(console,Kn(["websocket: ".concat(t)],i,!1));break;case ye.WARN:console.warn.apply(console,Kn(["websocket: ".concat(t)],i,!1));break;case ye.INFO:default:console.log.apply(console,Kn(["websocket: ".concat(t)],i,!1));break}},e.prototype.send=function(t){return st(this,void 0,void 0,function(){return at(this,function(r){try{this._ws&&this._ws.readyState===WebSocket.OPEN?(this._lastMsgSendTime=Date.now(),this._ws.send(t)):this.log("Failed to send data, web socket not open.",ye.ERROR)}catch(i){this.log("Failed to send data. ".concat(i),ye.ERROR)}return[2]})})},e.prototype.close=function(){return st(this,void 0,void 0,function(){return at(this,function(t){try{this.log("Closing websocket"),this._disconnected=!0,this.clearReconnectTimeout(),this._closeSocket()}catch(r){this.log("Failed to close websocket. ".concat(r))}return[2]})})},Object.defineProperty(e.prototype,"readyState",{get:function(){var t,r;return(r=(t=this._ws)===null||t===void 0?void 0:t.readyState)!==null&&r!==void 0?r:WebSocket.CLOSED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keepAliveTimeout",{get:function(){return this._keepAliveTimeout},set:function(t){typeof t=="number"&&(this.log("Setting ACK freshness timeout to ".concat(t)),this._keepAliveTimeout=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keepAliveInterval",{get:function(){return this._keepAliveInterval},set:function(t){typeof t=="number"&&(this.log("Setting keep-alive interval to ".concat(t)),this._keepAliveInterval=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shouldRetryFn",{set:function(t){typeof t=="function"&&(this._shouldRetryFn=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionTimeout",{get:function(){return this._connectionTimeout},set:function(t){typeof t=="number"&&(this._connectionTimeout=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxReconnectAttempts",{get:function(){return this._allowedReconnectAttempts},set:function(t){t>0&&t<yh?(this.log("Setting maximum connection retry attempts to ".concat(t)),this._allowedReconnectAttempts=t):this._allowedReconnectAttempts=To},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"reconnectInterval",{get:function(){return this._reconnectInterval},set:function(t){typeof t=="number"&&(this._reconnectInterval=t<this._maxReconnectInterval?t:this._maxReconnectInterval)},enumerable:!1,configurable:!0}),e.prototype._handleMessage=function(t){return st(this,void 0,void 0,function(){var r,i,s,a=this;return at(this,function(c){switch(c.label){case 0:return this._lastMsgRecvTime=Date.now(),r=t.data,i=new Promise(function(l,u){if(typeof r=="string")l(r);else if(r instanceof ArrayBuffer){var h=r;l(new Uint8Array(h))}else if(r instanceof Blob){if(!a._parseBlobToJson){l(r);return}var m=r,v=new FileReader;v.onload=function(){var _=v.result;try{var y=JSON.parse(_);l(y)}catch(k){console.error("Failed to parse JSON from Blob:",k)}},v.readAsText(m)}}),[4,i];case 1:return s=c.sent(),this.emit("message",s),[2]}})})},e}(Co.EventEmitter);["binaryType","bufferedAmount","extensions","protocol","readyState","url","keepAliveTimeout","keepAliveInterval","shouldRetryFn","connectionTimeout","maxReconnectAttempts","reconnectInterval"].forEach(function(n){Object.defineProperty(Ar.prototype,n,{enumerable:!0})});["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(Ar.prototype,n,{enumerable:!0,value:Kc.indexOf(n)})});["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(n){Object.defineProperty(Ar,n,{enumerable:!0,value:Kc.indexOf(n)})});class Th extends On{constructor(){super("pipecat.TextFrame",[{no:1,name:"id",kind:"scalar",T:4,L:0},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"text",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id=0n,t.name="",t.text="",e!==void 0&&dt(this,t,e),t}internalBinaryRead(e,t,r,i){let s=i??this.create(),a=e.pos+t;for(;e.pos<a;){let[c,l]=e.tag();switch(c){case 1:s.id=e.uint64().toBigInt();break;case 2:s.name=e.string();break;case 3:s.text=e.string();break;default:let u=r.readUnknownField;if(u==="throw")throw new globalThis.Error(`Unknown field ${c} (wire type ${l}) for ${this.typeName}`);let h=e.skip(l);u!==!1&&(u===!0?Se.onRead:u)(this.typeName,s,c,l,h)}}return s}internalBinaryWrite(e,t,r){e.id!==0n&&t.tag(1,W.Varint).uint64(e.id),e.name!==""&&t.tag(2,W.LengthDelimited).string(e.name),e.text!==""&&t.tag(3,W.LengthDelimited).string(e.text);let i=r.writeUnknownFields;return i!==!1&&(i==!0?Se.onWrite:i)(this.typeName,e,t),t}}const Xr=new Th;class Ch extends On{constructor(){super("pipecat.AudioRawFrame",[{no:1,name:"id",kind:"scalar",T:4,L:0},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"audio",kind:"scalar",T:12},{no:4,name:"sample_rate",kind:"scalar",T:13},{no:5,name:"num_channels",kind:"scalar",T:13},{no:6,name:"pts",kind:"scalar",opt:!0,T:4,L:0}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id=0n,t.name="",t.audio=new Uint8Array(0),t.sampleRate=0,t.numChannels=0,e!==void 0&&dt(this,t,e),t}internalBinaryRead(e,t,r,i){let s=i??this.create(),a=e.pos+t;for(;e.pos<a;){let[c,l]=e.tag();switch(c){case 1:s.id=e.uint64().toBigInt();break;case 2:s.name=e.string();break;case 3:s.audio=e.bytes();break;case 4:s.sampleRate=e.uint32();break;case 5:s.numChannels=e.uint32();break;case 6:s.pts=e.uint64().toBigInt();break;default:let u=r.readUnknownField;if(u==="throw")throw new globalThis.Error(`Unknown field ${c} (wire type ${l}) for ${this.typeName}`);let h=e.skip(l);u!==!1&&(u===!0?Se.onRead:u)(this.typeName,s,c,l,h)}}return s}internalBinaryWrite(e,t,r){e.id!==0n&&t.tag(1,W.Varint).uint64(e.id),e.name!==""&&t.tag(2,W.LengthDelimited).string(e.name),e.audio.length&&t.tag(3,W.LengthDelimited).bytes(e.audio),e.sampleRate!==0&&t.tag(4,W.Varint).uint32(e.sampleRate),e.numChannels!==0&&t.tag(5,W.Varint).uint32(e.numChannels),e.pts!==void 0&&t.tag(6,W.Varint).uint64(e.pts);let i=r.writeUnknownFields;return i!==!1&&(i==!0?Se.onWrite:i)(this.typeName,e,t),t}}const Yr=new Ch;class Oh extends On{constructor(){super("pipecat.TranscriptionFrame",[{no:1,name:"id",kind:"scalar",T:4,L:0},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"text",kind:"scalar",T:9},{no:4,name:"user_id",kind:"scalar",T:9},{no:5,name:"timestamp",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.id=0n,t.name="",t.text="",t.userId="",t.timestamp="",e!==void 0&&dt(this,t,e),t}internalBinaryRead(e,t,r,i){let s=i??this.create(),a=e.pos+t;for(;e.pos<a;){let[c,l]=e.tag();switch(c){case 1:s.id=e.uint64().toBigInt();break;case 2:s.name=e.string();break;case 3:s.text=e.string();break;case 4:s.userId=e.string();break;case 5:s.timestamp=e.string();break;default:let u=r.readUnknownField;if(u==="throw")throw new globalThis.Error(`Unknown field ${c} (wire type ${l}) for ${this.typeName}`);let h=e.skip(l);u!==!1&&(u===!0?Se.onRead:u)(this.typeName,s,c,l,h)}}return s}internalBinaryWrite(e,t,r){e.id!==0n&&t.tag(1,W.Varint).uint64(e.id),e.name!==""&&t.tag(2,W.LengthDelimited).string(e.name),e.text!==""&&t.tag(3,W.LengthDelimited).string(e.text),e.userId!==""&&t.tag(4,W.LengthDelimited).string(e.userId),e.timestamp!==""&&t.tag(5,W.LengthDelimited).string(e.timestamp);let i=r.writeUnknownFields;return i!==!1&&(i==!0?Se.onWrite:i)(this.typeName,e,t),t}}const Zr=new Oh;class Ah extends On{constructor(){super("pipecat.MessageFrame",[{no:1,name:"data",kind:"scalar",T:9}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.data="",e!==void 0&&dt(this,t,e),t}internalBinaryRead(e,t,r,i){let s=i??this.create(),a=e.pos+t;for(;e.pos<a;){let[c,l]=e.tag();switch(c){case 1:s.data=e.string();break;default:let u=r.readUnknownField;if(u==="throw")throw new globalThis.Error(`Unknown field ${c} (wire type ${l}) for ${this.typeName}`);let h=e.skip(l);u!==!1&&(u===!0?Se.onRead:u)(this.typeName,s,c,l,h)}}return s}internalBinaryWrite(e,t,r){e.data!==""&&t.tag(1,W.LengthDelimited).string(e.data);let i=r.writeUnknownFields;return i!==!1&&(i==!0?Se.onWrite:i)(this.typeName,e,t),t}}const ei=new Ah;class Ph extends On{constructor(){super("pipecat.Frame",[{no:1,name:"text",kind:"message",oneof:"frame",T:()=>Xr},{no:2,name:"audio",kind:"message",oneof:"frame",T:()=>Yr},{no:3,name:"transcription",kind:"message",oneof:"frame",T:()=>Zr},{no:4,name:"message",kind:"message",oneof:"frame",T:()=>ei}])}create(e){const t=globalThis.Object.create(this.messagePrototype);return t.frame={oneofKind:void 0},e!==void 0&&dt(this,t,e),t}internalBinaryRead(e,t,r,i){let s=i??this.create(),a=e.pos+t;for(;e.pos<a;){let[c,l]=e.tag();switch(c){case 1:s.frame={oneofKind:"text",text:Xr.internalBinaryRead(e,e.uint32(),r,s.frame.text)};break;case 2:s.frame={oneofKind:"audio",audio:Yr.internalBinaryRead(e,e.uint32(),r,s.frame.audio)};break;case 3:s.frame={oneofKind:"transcription",transcription:Zr.internalBinaryRead(e,e.uint32(),r,s.frame.transcription)};break;case 4:s.frame={oneofKind:"message",message:ei.internalBinaryRead(e,e.uint32(),r,s.frame.message)};break;default:let u=r.readUnknownField;if(u==="throw")throw new globalThis.Error(`Unknown field ${c} (wire type ${l}) for ${this.typeName}`);let h=e.skip(l);u!==!1&&(u===!0?Se.onRead:u)(this.typeName,s,c,l,h)}}return s}internalBinaryWrite(e,t,r){e.frame.oneofKind==="text"&&Xr.internalBinaryWrite(e.frame.text,t.tag(1,W.LengthDelimited).fork(),r).join(),e.frame.oneofKind==="audio"&&Yr.internalBinaryWrite(e.frame.audio,t.tag(2,W.LengthDelimited).fork(),r).join(),e.frame.oneofKind==="transcription"&&Zr.internalBinaryWrite(e.frame.transcription,t.tag(3,W.LengthDelimited).fork(),r).join(),e.frame.oneofKind==="message"&&ei.internalBinaryWrite(e.frame.message,t.tag(4,W.LengthDelimited).fork(),r).join();let i=r.writeUnknownFields;return i!==!1&&(i==!0?Se.onWrite:i)(this.typeName,e,t),t}}const gn=new Ph;class Ih{serialize(e){}serializeAudio(e,t,r){const i=new Uint8Array(e),s=gn.create({frame:{oneofKind:"audio",audio:{id:0n,name:"audio",audio:i,sampleRate:t,numChannels:r}}});return new Uint8Array(gn.toBinary(s))}serializeMessage(e){const t=gn.create({frame:{oneofKind:"message",message:{data:JSON.stringify(e)}}});return new Uint8Array(gn.toBinary(t))}async deserialize(e){if(!(e instanceof Blob))throw new Error("Unknown data type");const t=await e.arrayBuffer(),r=gn.fromBinary(new Uint8Array(t)).frame;if(r.oneofKind==="audio"){const i=Array.from(r.audio.audio),s=new Uint8Array(i);return{type:"audio",audio:new Int16Array(s.buffer)}}else{if(r.oneofKind==="message")return{type:"message",message:JSON.parse(r.message.data)};throw new Error("Unknown frame kind")}}}class en extends Bo{constructor(e={}){super(),this._wsUrl=null,this.audioQueue=[],this._wsUrl=e.ws_url||null,this._recorderSampleRate=e.recorderSampleRate||en.RECORDER_SAMPLE_RATE,this._mediaManager=new fh(!0,!0,void 0,void 0,512,this._recorderSampleRate,e.playerSampleRate||en.PLAYER_SAMPLE_RATE),this._mediaManager.setUserAudioCallback(this.handleUserAudioStream.bind(this)),this._ws=null,this._serializer=e.serializer||new Ih}initialize(e,t){this._options=e,this._callbacks=e.callbacks??{},this._onMessage=t,this._mediaManager.setClientOptions(e),this.state="disconnected"}async initDevices(){this.state="initializing",await this._mediaManager.initialize(),this.state="initialized"}_validateConnectionParams(e){if(e==null)return;if(typeof e!="object")throw new $e("Invalid connection parameters");const t={};for(const[r,i]of Object.entries(e))if(r==="ws_url"||r==="connectionUrl"){if(typeof i!="string")throw new $e(`Invalid type for connectionUrl: expected string, got ${typeof i}`);t.ws_url=i}else throw new $e(`Unrecognized connection parameter: ${r}. Only 'connectionUrl' is allowed.`);return t}async _connect(e){var t,r,i,s;if(!((t=this._abortController)!=null&&t.signal.aborted)){if(this.state="connecting",this._wsUrl=(e==null?void 0:e.ws_url)||this._wsUrl,!this._wsUrl)throw Q.error("No url provided for connection"),this.state="error",new ni;try{if(this._ws=this.initializeWebsocket(),await this._ws.connect(),await this._mediaManager.connect(),(r=this._abortController)!=null&&r.signal.aborted)return;this.state="connected",(s=(i=this._callbacks).onConnected)==null||s.call(i)}catch(a){const c=`Failed to connect to websocket: ${a}`;throw Q.error(c),this.state="error",new ni(c)}}}async _disconnect(){var e,t,r;this.state="disconnecting",await this._mediaManager.disconnect(),await((e=this._ws)==null?void 0:e.close()),this.state="disconnected",(r=(t=this._callbacks).onDisconnected)==null||r.call(t)}getAllMics(){return this._mediaManager.getAllMics()}getAllCams(){return this._mediaManager.getAllCams()}getAllSpeakers(){return this._mediaManager.getAllSpeakers()}async updateMic(e){return this._mediaManager.updateMic(e)}updateCam(e){return this._mediaManager.updateCam(e)}updateSpeaker(e){return this._mediaManager.updateSpeaker(e)}get selectedMic(){return this._mediaManager.selectedMic}get selectedSpeaker(){return this._mediaManager.selectedSpeaker}enableMic(e){this._mediaManager.enableMic(e)}get isMicEnabled(){return this._mediaManager.isMicEnabled}get state(){return this._state}set state(e){var t,r;this._state!==e&&(this._state=e,(r=(t=this._callbacks).onTransportStateChanged)==null||r.call(t,e))}tracks(){return this._mediaManager.tracks()}initializeWebsocket(){const e=new Ar(this._wsUrl,void 0,{parseBlobToJson:!1});return e.keepAliveInterval=0,e.on("open",()=>{Q.debug("Websocket connection opened")}),e.on("message",async t=>{try{const r=await this._serializer.deserialize(t);r.type==="audio"?this._mediaManager.bufferBotAudio(r.audio):r.type==="message"&&r.message.label==="rtvi-ai"&&this._onMessage(r.message)}catch(r){Q.error("Failed to deserialize incoming message",r)}}),e.on("error",t=>{this.connectionError(`websocket error: ${t}`)}),e.on("connection-timeout",()=>{this.connectionError("websocket connection timed out")}),e.on("close",t=>{this.connectionError(`websocket connection closed. Code: ${t}`)}),e.on("reconnect-failed",()=>{this.connectionError("websocket reconnect failed")}),e}sendReadyMessage(){this.state="ready",this.sendMessage(Ue.clientReady())}handleUserAudioStream(e){if(this.state==="ready")try{this.flushAudioQueue(),this._sendAudioInput(e)}catch(t){Q.error("Error sending audio stream to websocket:",t),this.state="error"}else this.audioQueue.push(e)}flushAudioQueue(){if(!(this.audioQueue.length<=0))for(Q.info("Will flush audio queue",this.audioQueue.length);this.audioQueue.length>0;){const e=this.audioQueue.shift();e&&this._sendAudioInput(e)}}sendRawMessage(e){const t=this._serializer.serialize(e);this._sendMsg(t)}sendMessage(e){const t=this._serializer.serializeMessage(e);this._sendMsg(t)}async _sendAudioInput(e){try{const t=this._serializer.serializeAudio(e,this._recorderSampleRate,1);await this._sendMsg(t)}catch(t){Q.error("Error sending audio frame",t)}}async _sendMsg(e){if(!this._ws){Q.error("sendMsg called but WS is null");return}if(this._ws.readyState!==WebSocket.OPEN){Q.error("attempt to send to closed socket");return}if(e)try{await this._ws.send(e)}catch(t){Q.error("sendMsg error",t)}}connectionError(e){console.error(e),this.state="error",this.disconnect()}enableScreenShare(e){throw Q.error("enableScreenShare not implemented for WebSocketTransport"),new Qn("enableScreenShare","webSocketTransport","This feature has not been implemented")}get isSharingScreen(){return Q.error("isSharingScreen not implemented for WebSocketTransport"),!1}enableCam(e){throw Q.error("enableCam not implemented for WebSocketTransport"),new Qn("enableCam","webSocketTransport","This feature has not been implemented")}get isCamEnabled(){return Q.error("isCamEnabled not implemented for WebSocketTransport"),!1}get selectedCam(){throw Q.error("selectedCam not implemented for WebSocketTransport"),new Qn("selectedCam","webSocketTransport","This feature has not been implemented")}}en.RECORDER_SAMPLE_RATE=16e3;en.PLAYER_SAMPLE_RATE=24e3;class Nh{serialize(e){return JSON.stringify(e)}serializeAudio(e,t,r){const i=new Int16Array(e),s=Pi.encode(i),c={event:"media",media:{payload:this.arrayToBase64(s)}};return JSON.stringify(c)}serializeMessage(e){return null}arrayToBase64(e){let t="";for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return btoa(t)}base64ToUint8Array(e){const t=atob(e),r=t.length,i=new Uint8Array(r);for(let s=0;s<r;s++)i[s]=t.charCodeAt(s);return i}async deserialize(e){const t=JSON.parse(e);if(t.event==="clear")return{type:"raw",message:t};if(t.event==="media"){const r=t.media.payload,i=this.base64ToUint8Array(r);return{type:"audio",audio:Pi.decode(i)}}else return{type:"message",message:t.message}}}const qt=class qt{constructor(){ze(this,"rtviClient",null);ze(this,"connectBtn",null);ze(this,"disconnectBtn",null);ze(this,"statusSpan",null);ze(this,"debugLog",null);ze(this,"wsUrlInput",null);ze(this,"botAudio");this.botAudio=document.createElement("audio"),this.botAudio.autoplay=!0,document.body.appendChild(this.botAudio),this.setupDOMElements(),this.setupEventListeners()}setupDOMElements(){this.connectBtn=document.getElementById("connect-btn"),this.disconnectBtn=document.getElementById("disconnect-btn"),this.statusSpan=document.getElementById("connection-status"),this.debugLog=document.getElementById("debug-log"),this.wsUrlInput=document.getElementById("ws-url-input")}setupEventListeners(){var e,t;(e=this.connectBtn)==null||e.addEventListener("click",()=>this.connect()),(t=this.disconnectBtn)==null||t.addEventListener("click",()=>this.disconnect())}log(e){if(!this.debugLog)return;const t=document.createElement("div");t.textContent=`${new Date().toISOString()} - ${e}`,e.startsWith("User: ")?t.style.color="#2196F3":e.startsWith("Bot: ")&&(t.style.color="#4CAF50"),this.debugLog.appendChild(t),this.debugLog.scrollTop=this.debugLog.scrollHeight,console.log(e)}updateStatus(e){this.statusSpan&&(this.statusSpan.textContent=e),this.log(`Status: ${e}`)}async emulateTwilioMessages(){var i;const e={event:"connected",protocol:"Call",version:"1.0.0"},t=(i=this.rtviClient)==null?void 0:i.transport;t==null||t.sendRawMessage(e);const r={event:"start",start:{streamSid:qt.STREAM_SID,callSid:qt.CALL_SID}};t==null||t.sendRawMessage(r)}setupMediaTracks(){var t;if(!this.rtviClient)return;const e=this.rtviClient.tracks();(t=e.bot)!=null&&t.audio&&this.setupAudioTrack(e.bot.audio)}setupTrackListeners(){this.rtviClient&&(this.rtviClient.on(U.TrackStarted,(e,t)=>{!(t!=null&&t.local)&&e.kind==="audio"&&this.setupAudioTrack(e)}),this.rtviClient.on(U.TrackStopped,(e,t)=>{this.log(`Track stopped: ${e.kind} from ${(t==null?void 0:t.name)||"unknown"}`)}))}setupAudioTrack(e){if(this.log("Setting up audio track"),this.botAudio.srcObject&&"getAudioTracks"in this.botAudio.srcObject){const t=this.botAudio.srcObject.getAudioTracks()[0];if((t==null?void 0:t.id)===e.id)return}this.botAudio.srcObject=new MediaStream([e])}async connect(){try{if(!this.wsUrlInput||!this.wsUrlInput.value){this.log("Error: WebSocket URL cannot be empty."),this.updateStatus("Error");return}const e=this.wsUrlInput.value.trim();this.log(`Attempting to connect to: ${e}`);const t=Date.now(),r={serializer:new Nh,recorderSampleRate:8e3,playerSampleRate:8e3,ws_url:e},i={transport:new en(r),enableMic:!0,enableCam:!1,callbacks:{onConnected:()=>{this.emulateTwilioMessages(),this.updateStatus("Connected"),this.connectBtn&&(this.connectBtn.disabled=!0),this.disconnectBtn&&(this.disconnectBtn.disabled=!1)},onDisconnected:()=>{this.updateStatus("Disconnected"),this.connectBtn&&(this.connectBtn.disabled=!1),this.disconnectBtn&&(this.disconnectBtn.disabled=!0),this.log("Client disconnected")},onBotReady:a=>{this.log(`Bot ready: ${JSON.stringify(a)}`),this.setupMediaTracks()},onUserTranscript:a=>{a.final&&this.log(`User: ${a.text}`)},onBotTranscript:a=>this.log(`Bot: ${a.text}`),onMessageError:a=>console.error("Message error:",a),onError:a=>console.error("Error:",a)}};this.rtviClient=new nn(i),this.setupTrackListeners(),this.log("Initializing devices..."),await this.rtviClient.initDevices(),this.log("Connecting to bot..."),await this.rtviClient.connect();const s=Date.now()-t;this.log(`Connection complete, timeTaken: ${s}`)}catch(e){if(this.log(`Error connecting: ${e.message}`),this.updateStatus("Error"),this.rtviClient)try{await this.rtviClient.disconnect()}catch(t){this.log(`Error during disconnect: ${t}`)}}}async disconnect(){if(this.rtviClient)try{await this.rtviClient.disconnect(),this.rtviClient=null,this.botAudio.srcObject&&"getAudioTracks"in this.botAudio.srcObject&&(this.botAudio.srcObject.getAudioTracks().forEach(e=>e.stop()),this.botAudio.srcObject=null)}catch(e){this.log(`Error disconnecting: ${e.message}`)}}};ze(qt,"STREAM_SID","ws_mock_stream_sid"),ze(qt,"CALL_SID","ws_mock_stream_sid");let mr=qt;window.addEventListener("DOMContentLoaded",()=>{window.WebsocketClientApp=mr,new mr});
